{"version":3,"file":"main.js","mappings":"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","sources":["webpack://app/./src/utils/platform.ts","webpack://app/./src/graph-view/svg-text.ts","webpack://app/./src/graph-view/svg-create.ts","webpack://app/./src/graph-view/intersect.ts","webpack://app/./src/graph-view/shapes.ts","webpack://app/./src/graph-view/layout.ts","webpack://app/./src/graph-view/undo.ts","webpack://app/./src/graph-view/constants.ts","webpack://app/./src/graph-view/graph.ts","webpack://app/./src/graph-view/defs.ts","webpack://app/./src/graph-view/edge-utils.ts","webpack://app/./src/style.css","webpack://app/./src/shortcuts.tsx","webpack://app/./src/style.css?760f","webpack://app/./src/websocket.ts","webpack://app/./src/index.tsx","webpack://app/./src/parseModel.ts","webpack://app/./src/hooks.ts","webpack://app/./src/utils.ts","webpack://app/./src/components/Toolbar.tsx","webpack://app/./src/Root.tsx"],"sourcesContent":["/**\n * Robust platform detection utilities\n */\n\n/**\n * Detects if the user is on a Mac platform using multiple detection methods\n * for maximum compatibility across browsers and future-proofing.\n */\nexport const isMac = (): boolean => {\n  if (typeof navigator === 'undefined') return false;\n  \n  // Method 1: Check userAgentData (modern browsers, most reliable)\n  if ('userAgentData' in navigator && (navigator as any).userAgentData) {\n    const platform = (navigator as any).userAgentData.platform;\n    if (platform && platform.toLowerCase().includes('mac')) {\n      return true;\n    }\n  }\n  \n  // Method 2: Check userAgent string (widely supported)\n  const userAgent = navigator.userAgent.toLowerCase();\n  if (userAgent.includes('mac os') || userAgent.includes('macintosh')) {\n    return true;\n  }\n  \n  // Method 3: Check platform (fallback, deprecated but still widely supported)\n  if (navigator.platform) {\n    const platform = navigator.platform.toLowerCase();\n    if (platform.includes('mac') || platform.includes('darwin')) {\n      return true;\n    }\n  }\n  \n  // Method 4: Check for Mac-specific features as additional validation\n  try {\n    const testEvent = new KeyboardEvent('keydown', { metaKey: true });\n    if (testEvent.metaKey !== undefined) {\n      // Additional heuristic: Mac typically has different key layouts\n      return /mac|darwin|os x/i.test(navigator.userAgent);\n    }\n  } catch (e) {\n    // Ignore errors in older browsers\n  }\n  \n  return false;\n};\n\n/**\n * Gets the appropriate modifier key name for the current platform\n */\nexport const getModifierKeyName = (): string => {\n  return isMac() ? 'Cmd' : 'Ctrl';\n};\n\n/**\n * Gets the appropriate modifier key property for keyboard events\n */\nexport const getModifierKeyProperty = (event: KeyboardEvent): boolean => {\n  return isMac() ? event.metaKey : event.ctrlKey;\n};\n\n/**\n * Gets the appropriate Alt key name for the current platform\n */\nexport const getAltKeyName = (): string => {\n  return isMac() ? 'Option' : 'Alt';\n}; ","const textMeasure = () => {\n\tconst svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\tdocument.body.appendChild(svg);\n\n\treturn {\n\t\tmeasure: (text: string, attrs: { [key: string]: string }) => {\n\t\t\tconst node = document.createElementNS('http://www.w3.org/2000/svg', 'text')\n\t\t\tnode.setAttribute('x', '0');\n\t\t\tnode.setAttribute('y', '0');\n\t\t\tfor (let attr in attrs) {\n\t\t\t\tnode.setAttribute(attr, attrs[attr]);\n\t\t\t}\n\t\t\tnode.appendChild(document.createTextNode(text));\n\n\t\t\tsvg.appendChild(node);\n\t\t\tconst {width, height} = node.getBBox();\n\t\t\tsvg.removeChild(node);\n\t\t\treturn {width, height};\n\t\t},\n\t\tclean: () => {\n\t\t\tdocument.body.removeChild(svg);\n\t\t}\n\t}\n}\n\n// Helper function to break long words that exceed width\nconst breakLongWord = (word: string, maxWidth: number, attrs: { [key: string]: string }, mt: any): string[] => {\n\tconst parts: string[] = [];\n\tlet currentPart = '';\n\t\n\tfor (let i = 0; i < word.length; i++) {\n\t\tconst testPart = currentPart + word[i];\n\t\tconst size = mt.measure(testPart, attrs);\n\t\t\n\t\tif (size.width > maxWidth && currentPart.length > 0) {\n\t\t\tparts.push(currentPart);\n\t\t\tcurrentPart = word[i];\n\t\t} else {\n\t\t\tcurrentPart = testPart;\n\t\t}\n\t}\n\t\n\tif (currentPart.length > 0) {\n\t\tparts.push(currentPart);\n\t}\n\t\n\treturn parts;\n}\n\n// split a text in lines wrapped at a certain width\nexport const svgTextWrap = (text: string, width: number, attrs: { [key: string]: string }) => {\n\tconst mt = textMeasure()\n\tlet maxW = 0;\n\t\n\tconst ret = text.trim().split('\\n').map(text => { //split paragraphs\n\t\t//do one paragraph\n\t\tconst words = text.trim().split(/\\s+/);\n\t\tlet lines: string[] = [];\n\t\tlet currentLine: string[] = [];\n\t\t\n\t\twords.forEach(word => {\n\t\t\t// First check if the single word exceeds the width\n\t\t\tconst wordSize = mt.measure(word, attrs);\n\t\t\tif (wordSize.width > width) {\n\t\t\t\t// If we have content in current line, finish it first\n\t\t\t\tif (currentLine.length > 0) {\n\t\t\t\t\tlines.push(currentLine.join(' '));\n\t\t\t\t\tcurrentLine = [];\n\t\t\t\t}\n\t\t\t\t// Break the long word into smaller parts\n\t\t\t\tconst brokenParts = breakLongWord(word, width, attrs, mt);\n\t\t\t\t// Add all but the last part as complete lines\n\t\t\t\tfor (let i = 0; i < brokenParts.length - 1; i++) {\n\t\t\t\t\tlines.push(brokenParts[i]);\n\t\t\t\t\tmaxW = Math.max(maxW, mt.measure(brokenParts[i], attrs).width);\n\t\t\t\t}\n\t\t\t\t// Start new line with the last part\n\t\t\t\tif (brokenParts.length > 0) {\n\t\t\t\t\tcurrentLine = [brokenParts[brokenParts.length - 1]];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Normal word processing\n\t\t\t\tconst newLine = [...currentLine, word];\n\t\t\t\tconst size = mt.measure(newLine.join(' '), attrs);\n\t\t\t\tif (size.width > width && currentLine.length > 0) {\n\t\t\t\t\tlines.push(currentLine.join(' '));\n\t\t\t\t\tcurrentLine = [word];\n\t\t\t\t} else {\n\t\t\t\t\tmaxW = Math.max(maxW, size.width)\n\t\t\t\t\tcurrentLine = newLine;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (currentLine.length > 0) {\n\t\t\tlines.push(currentLine.join(' '));\n\t\t}\n\t\treturn lines;\n\t}).reduce((a, v) => a.concat(v), []) //flatten\n\n\tmt.clean()\n\treturn {lines: ret, maxW};\n};\n\n\n","import {svgTextWrap} from \"./svg-text\";\n\nexport const create = {\n\telement(type: string, attrs: Record<string, string | number> = {}, className?: string) {\n\t\tconst el = document.createElementNS('http://www.w3.org/2000/svg', type);\n\t\tObject.entries(attrs).forEach(([k, v]) => el.setAttribute(k, String(v)));\n\t\tif (className) el.classList.add(className);\n\t\treturn el;\n\t},\n\n\tuse(id: string, attrs: Record<string, string | number> = {}) {\n\t\tconst el = this.element('use', attrs);\n\t\tel.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', '#' + id);\n\t\treturn el;\n\t},\n\n\tpath(path: string, attrs: Record<string, string | number> = {}, className?: string) {\n\t\tconst p = this.element(\"path\", {...attrs, d: path}, className);\n\t\treturn p;\n\t},\n\n\ttext(text: string, attrs: Record<string, string | number> = {}) {\n\t\tconst t = this.element('text', attrs) as SVGTextElement;\n\t\tif (text) t.textContent = text;\n\t\treturn t;\n\t},\n\n\ttextArea(text: string, width: number, fontSize: number, bold: boolean, x = 0, y = 0, anchor = '') {\n\t\tconst attrs: Record<string, string> = {\n\t\t\t'font-size': `${fontSize}px`,\n\t\t\t'font-weight': bold ? 'bold' : 'normal'\n\t\t};\n\t\tconst {lines, maxW} = svgTextWrap(text, width, attrs);\n\t\tconst txt = this.text('', {x: 0, y, 'text-anchor': anchor || undefined});\n\t\t\n\t\tlines.forEach((line, i) => {\n\t\t\tconst span = this.element('tspan', {x, dy: `${fontSize + 2}px`, ...attrs});\n\t\t\tspan.textContent = line;\n\t\t\ttxt.append(span);\n\t\t});\n\t\t\n\t\treturn {txt, dy: (lines.length + 1) * (fontSize + 2), maxW};\n\t},\n\n\trect(width: number, height: number, x = 0, y = 0, r = 0, className?: string) {\n\t\treturn this.element('rect', {x, y, rx: r, ry: r, width, height}, className) as SVGRectElement;\n\t},\n\n\ticon(icon: string, x = 0, y = 0) {\n\t\treturn this.use(icon, {x, y});\n\t},\n\n\texpand(x: number, y: number, expanded: boolean) {\n\t\tconst g = this.element('g', {transform: `translate(${x},${y})`}, 'expand') as SVGGElement;\n\t\tg.append(\n\t\t\tthis.rect(19, 19, 0, 0, 1),\n\t\t\tthis.text(expanded ? '-' : '+', {x: 10, y: 14, 'text-anchor': 'middle'})\n\t\t);\n\t\treturn g;\n\t}\n};\n\nexport function setPosition(g: SVGGElement, x: number, y: number) {\n\tg.setAttribute('transform', `translate(${x},${y})`);\n}","interface Point {\n\tx: number;\n\ty: number;\n}\n\ninterface BBox extends Point {\n\twidth: number;\n\theight: number;\n}\n\n\nexport function insideBox(p: Point, b: BBox, centeredBox = true): boolean {\n\treturn centeredBox ?\n\t\t(p.x > b.x - b.width / 2 && p.x < b.x + b.width / 2 && p.y > b.y - b.height / 2 && p.y < b.y + b.height / 2) :\n\t\t(p.x > b.x && p.x < b.x + b.width && p.y > b.y && p.y < b.y + b.height)\n}\n\nexport function boxesOverlap(b1: BBox, b2: BBox): boolean {\n\treturn b1.x < b2.x + b2.width && b1.y < b2.y + b2.height && b1.x + b1.width > b2.x && b1.y + b1.height > b2.y\n}\n\nexport function uncenterBox(b: BBox): BBox {\n\treturn {x: b.x - b.width / 2, y: b.y - b.height / 2, width: b.width, height: b.height}\n}\n\nexport function scaleBox(b: BBox, sc: number): BBox {\n\treturn {x: b.x * sc, y: b.y * sc, width: b.width * sc, height: b.height * sc}\n}\n\n// intersect 2 segments (p1->q1) with (p2, q2)\n// if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite)\n// and booleans for whether line segment 1 or line segment 2 contain the point\nfunction segmentIntersection(p1: Point, q1: Point, p2: Point, q2: Point) {\n\tlet denominator, a, b, numerator1, numerator2,\n\t\tresult: { x: number, y: number, onLine1: boolean, onLine2: boolean } = {\n\t\t\tx: null,\n\t\t\ty: null,\n\t\t\tonLine1: false,\n\t\t\tonLine2: false\n\t\t};\n\tdenominator = (q2.y - p2.y) * (q1.x - p1.x) - (q2.x - p2.x) * (q1.y - p1.y);\n\tif (denominator == 0) {\n\t\treturn result;\n\t}\n\ta = p1.y - p2.y;\n\tb = p1.x - p2.x;\n\tnumerator1 = ((q2.x - p2.x) * a) - ((q2.y - p2.y) * b);\n\tnumerator2 = ((q1.x - p1.x) * a) - ((q1.y - p1.y) * b);\n\ta = numerator1 / denominator;\n\tb = numerator2 / denominator;\n\n\t// if we cast these lines infinitely in both directions, they intersect here:\n\tresult.x = p1.x + (a * (q1.x - p1.x));\n\tresult.y = p1.y + (a * (q1.y - p1.y));\n\n\t// if line1 is a segment and line2 is infinite, they intersect if:\n\tif (a > 0 && a < 1) {\n\t\tresult.onLine1 = true;\n\t}\n\t// if line2 is a segment and line1 is infinite, they intersect if:\n\tif (b >= 0 && b <= 1) {\n\t\tresult.onLine2 = true;\n\t}\n\t// if line1 and line2 are segments, they intersect if both of the above are true\n\treturn result;\n}\n\n// intersects a segment (p1->p2) with a box\nexport function intersectRectFull(p1: Point, p2: Point, box: BBox): Point[] {\n\tconst w = box.width / 2\n\tconst h = box.height / 2\n\tconst segs: { p: Point; q: Point }[] = [\n\t\t{p: {x: box.x - w, y: box.y - h}, q: {x: box.x - w, y: box.y + h}},\n\t\t{p: {x: box.x - w, y: box.y - h}, q: {x: box.x + w, y: box.y - h}},\n\t\t{p: {x: box.x + w, y: box.y - h}, q: {x: box.x + w, y: box.y + h}},\n\t\t{p: {x: box.x - w, y: box.y + h}, q: {x: box.x + w, y: box.y + h}},\n\t]\n\treturn segs.map(s => segmentIntersection(p1, p2, s.p, s.q)).filter(ret => ret.onLine1 && ret.onLine2)\n}\n\n// intersects a line that goes from p to the center of the box\nexport function intersectRect(box: BBox, p: Point): Point {\n\tif (insideBox(p, box)) return {x: box.x, y: box.y}\n\treturn intersectRectFull(box, p, box)[0] || {x: box.x, y: box.y}\n}\n\nexport function intersectEllipse(ellCenter: Point, rx: number, ry: number, nodeCenter: Point, point: Point) {\n\n\t//translate all to center ellipse\n\tconst p1 = {x: point.x - ellCenter.x, y: point.y - ellCenter.y}\n\tconst p2 = {x: nodeCenter.x - ellCenter.x, y: nodeCenter.y - ellCenter.y}\n\n\tif (p2.x == p1.x) { //hack to avoid singularity\n\t\tp1.x += .0000001\n\t}\n\n\tconst s = (p2.y - p1.y) / (p2.x - p1.x);\n\tconst si = p2.y - (s * p2.x);\n\tconst a = (ry * ry) + (rx * rx * s * s);\n\tconst b = 2 * rx * rx * si * s;\n\tconst c = rx * rx * si * si - rx * rx * ry * ry;\n\n\tconst radicand_sqrt = Math.sqrt((b * b) - (4 * a * c));\n\tconst x = p1.x > p2.x ?\n\t\t(-b + radicand_sqrt) / (2 * a) :\n\t\t(-b - radicand_sqrt) / (2 * a)\n\tconst pos = {\n\t\tx: x,\n\t\ty: s * x + si\n\t}\n\t//translate back\n\tpos.x += ellCenter.x;\n\tpos.y += ellCenter.y\n\n\treturn pos;\n}\n\nexport interface Segment {\n\tp: Point;\n\tq: Point;\n}\n\n// given a polyline as a list of segments, interrupt it over the box so no line is inside the box\nexport function intersectPolylineBox(segments: Segment[], box: BBox) {\n\tfor (let i = 0; i < segments.length; i++) {\n\t\tconst s = segments[i]\n\t\tif (insideBox(s.p, box)) {\n\t\t\tif (insideBox(s.q, box)) { // segment both ends inside box\n\t\t\t\tsegments.splice(i, 1)\n\t\t\t\ti -= 1\n\t\t\t} else { // segment start inside box\n\t\t\t\ts.p = intersectRectFull(s.p, s.q, box)[0]\n\t\t\t}\n\t\t} else {\n\t\t\tif (insideBox(s.q, box)) { // segment end inside box\n\t\t\t\ts.q = intersectRectFull(s.p, s.q, box)[0]\n\t\t\t} else { // both ends outside\n\t\t\t\tconst ret = intersectRectFull(s.p, s.q, box)\n\t\t\t\tif (ret.length == 2) {  // intersects the box, splice segment\n\t\t\t\t\t// order the intersection points, closest first\n\t\t\t\t\tconst dst1 = Math.abs(ret[0].x - s.p.x) + Math.abs(ret[0].y - s.p.y)\n\t\t\t\t\tconst dst2 = Math.abs(ret[1].x - s.p.x) + Math.abs(ret[1].y - s.p.y)\n\t\t\t\t\tif (dst1 > dst2) ret.reverse()\n\t\t\t\t\t// split the segment in 2\n\t\t\t\t\tconst s2 = {p: ret[1], q: s.q}\n\t\t\t\t\ts.q = ret[0]\n\t\t\t\t\tsegments.splice(i + 1, 0, s2)\n\t\t\t\t\ti += 1\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function project(p: Point, a: Point, b: Point): Point {\n\tlet atob = {x: b.x - a.x, y: b.y - a.y};\n\tlet atop = {x: p.x - a.x, y: p.y - a.y};\n\tlet len = atob.x * atob.x + atob.y * atob.y;\n\tlet dot = atop.x * atob.x + atop.y * atob.y;\n\tlet t = Math.min(1, Math.max(0, dot / len));\n\treturn {\n\t\tx: a.x + atob.x * t,\n\t\ty: a.y + atob.y * t\n\t};\n}\n\nexport function cabDistance(p1: Point, p2: Point): number {\n\treturn Math.abs(p2.x - p1.x) + Math.abs(p2.y - p1.y)\n}","import {intersectEllipse, intersectRect} from \"./intersect\";\n\ninterface Point {\n\tx: number;\n\ty: number;\n}\n\ninterface BBox extends Point {\n\twidth: number;\n\theight: number;\n}\n\ninterface D3Node extends BBox {\n\tintersect: (p: Point) => Point\n}\n\nclass D3Element {\n\tprivate readonly _el: SVGElement\n\n\tconstructor(el: SVGElement) {\n\t\tthis._el = el;\n\t}\n\n\tnode() {\n\t\treturn this._el;\n\t}\n\n\tattr(name: string, value: string | number) {\n\t\tthis._el.setAttribute(name, String(value))\n\t\treturn this;\n\t}\n\n\tinsert(type: string, pos: string) {\n\t\tconst el = document.createElementNS('http://www.w3.org/2000/svg', type)\n\t\tconst el2 = this._el.insertBefore(el, this._el.querySelector(pos))\n\t\treturn new D3Element(el2)\n\t}\n}\n\n\nfunction rect(parent: D3Element, bbox: BBox, node: D3Node, rounded = false) {\n\tconst shapeSvg = parent.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", rounded ? node.width / 8 : 3)\n\t\t.attr(\"ry\", rounded ? node.width / 8 : 3)\n\t\t.attr(\"x\", -bbox.width / 2)\n\t\t.attr(\"y\", -bbox.height / 2)\n\t\t.attr(\"width\", bbox.width)\n\t\t.attr(\"height\", bbox.height);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect(node, point);\n\t};\n\n\treturn shapeSvg;\n}\n\n\nfunction cylinder(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst w = bbox.width;\n\tconst rx = w / 2;\n\tconst ry = rx / (5.5 + w / 70); // Make ellipse even flatter - increased to 5.5\n\tconst h = bbox.height;\n\n\tconst shape =\n\t\t`M 0,${ry} a${rx},${ry} 0,0,0 ${w} 0 a ${rx},${ry} 0,0,0 ${-w} 0 l 0,${h - 2 * ry} a ${rx},${ry} 0,0,0 ${w} 0 l 0,${-h + 2 * ry}`;\n\n\tconst shapeSvg = parent\n\t\t.attr('label-offset-y', 2 * ry)\n\t\t.insert('path', ':first-child')\n\t\t.attr('d', shape)\n\t\t.attr('transform', 'translate(' + -w / 2 + ',' + -(h / 2) + ')');\n\n\tnode.intersect = function (point: Point) {\n\t\tconst pos = intersectRect(node, point)\n\t\tlet cy = node.y + node.height / 2 - ry\n\t\tif (pos.y > cy)\n\t\t\treturn intersectEllipse({x: node.x, y: cy}, rx, ry, node, point)\n\n\t\tcy = node.y - node.height / 2 + ry\n\t\tif (pos.y < cy)\n\t\t\treturn intersectEllipse({x: node.x, y: cy}, rx, ry, node, point)\n\n\t\treturn pos;\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction person(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst w = bbox.width;\n\tconst h = bbox.height;\n\n\tconst shape =\n\t\t`M ${.38 * w},${h / 3} A${w / 2},${h / 2} 0,0,0 0 ${h / 2}\n\t\tL${w / 11},${h} L${w - w / 11},${h} L${w},${h / 2}\n\t\tA${w / 2},${h / 2} 0,0,0 ${w - .38 * w} ${h / 3} \n\t\tA${w / 6},${w / 6} 0,1,0 ${.38 * w} ${h / 3}`;\n\n\tconst shapeSvg = parent\n\t\t.attr('label-offset-y', h * .4)\n\t\t.insert('path', ':first-child')\n\t\t.attr('d', shape)\n\t\t.attr('transform', 'translate(' + -w / 2 + ',' + -(h / 2) + ')');\n\n\tnode.intersect = function (point: Point) {\n\t\tconst pos = intersectRect(node, point)\n\t\treturn pos;\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction _ellipse(parent: D3Element, bbox: BBox, node: D3Node, rx: number, ry: number) {\n\tconst shapeSvg = parent.insert(\"ellipse\", \":first-child\")\n\t\t.attr(\"cx\", 0)\n\t\t.attr(\"cy\", 0)\n\t\t.attr('rx', rx)\n\t\t.attr('ry', ry)\n\t\t.attr(\"width\", node.width)\n\t\t.attr(\"height\", node.height);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectEllipse(node, rx, ry, node, point)\n\t};\n\treturn shapeSvg;\n}\n\nfunction circle(parent: D3Element, bbox: BBox, node: D3Node) {\n\treturn _ellipse(parent, bbox, node, node.width / 2, node.width / 2)\n}\n\nfunction ellipse(parent: D3Element, bbox: BBox, node: D3Node) {\n\treturn _ellipse(parent, bbox, node, node.width * .55, node.width * .45)\n}\n\nfunction hexagon(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst sz = node.width / 2\n\t// drawing a hexagon from polar coords\n\t// [0,1,2,3,4,5,6].map(i=>`${Math.sin(Math.PI/3*i+Math.PI/6).toFixed(4)},${Math.cos(Math.PI/3*i+Math.PI/6).toFixed(4)}`).join(',')\n\tconst shapeSvg = parent.insert(\"polygon\", \":first-child\")\n\t\t.attr(\"points\",\n\t\t\t[0.5000, 0.8660, 1.0000, 0.0000, 0.5000, -0.8660, -0.5000, -0.8660, -1.0000, -0.0000, -0.5000, 0.8660, 0.5000, 0.8660].map(n => n * sz).join(','))\n\t\t.attr(\"width\", node.width)\n\t\t.attr(\"height\", node.height);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectEllipse(node, node.width / 2, node.width / 2, node, point)\n\t};\n\treturn shapeSvg;\n}\n\nfunction component(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst dx = node.width / 10\n\tconst shapeSvg = parent.insert('g', ':first-child')\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", 3).attr(\"ry\", 3)\n\t\t.attr(\"x\", -node.width / 2 - dx)\n\t\t.attr(\"y\", -node.height / 2 + dx)\n\t\t.attr(\"width\", dx * 2)\n\t\t.attr(\"height\", dx);\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", 3).attr(\"ry\", 3)\n\t\t.attr(\"x\", -node.width / 2 - dx)\n\t\t.attr(\"y\", -node.height / 2 + dx * 2.5)\n\t\t.attr(\"width\", dx * 2)\n\t\t.attr(\"height\", dx);\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", 3).attr(\"ry\", 3)\n\t\t.attr(\"x\", -node.width / 2)\n\t\t.attr(\"y\", -node.height / 2)\n\t\t.attr(\"width\", node.width)\n\t\t.attr(\"height\", node.height);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect({x: node.x - dx / 2, y: node.y, width: node.width + dx, height: node.height}, point);\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction folder(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst dy = node.width / 20\n\tconst shapeSvg = parent\n\t\t.attr('label-offset-y', dy * 2)\n\t\t.insert('g', ':first-child')\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", 3).attr(\"ry\", 3)\n\t\t.attr(\"x\", -node.width / 2)\n\t\t.attr(\"y\", -node.height / 2 + dy * 2)\n\t\t.attr(\"width\", node.width)\n\t\t.attr(\"height\", node.height - dy * 2);\n\tshapeSvg.insert(\"path\", \":first-child\")\n\t\t.attr('d', `M0,${-node.height / 2 + 2 * dy} l${dy},${-2 * dy} h${node.width / 2 - dy * 2} v${dy * 2}`)\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect({x: node.x, y: node.y + dy / 2, width: node.width, height: node.height + dy}, point);\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction mobiledevicelandscape(parent: D3Element, bbox: BBox, node: D3Node, rounded = false) {\n\tconst dx = node.width / 8\n\tconst r = node.width / 14\n\tconst shapeSvg = parent.insert('g', ':first-child')\n\tshapeSvg.insert('path', ':first-child')\n\t\t.attr('d', `M${-node.width / 2},${-node.height / 2} l0,${node.height} M${node.width / 2},${-node.height / 2} l0,${node.height}`)\n\tshapeSvg.insert('circle', ':first-child')\n\t\t.attr('cx', -node.width / 2 - dx / 2)\n\t\t.attr('cy', 0)\n\t\t.attr('r', r * .4)\n\tshapeSvg.insert('rect', ':first-child')\n\t\t.attr('x', node.width / 2 + dx / 2 - r * .2)\n\t\t.attr('y', -r)\n\t\t.attr('width', r * .4)\n\t\t.attr('height', r * 2)\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", r)\n\t\t.attr(\"ry\", r)\n\t\t.attr(\"x\", -bbox.width / 2 - dx)\n\t\t.attr(\"y\", -bbox.height / 2)\n\t\t.attr(\"width\", bbox.width + 2 * dx)\n\t\t.attr(\"height\", bbox.height);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect({x: node.x, y: node.y, width: node.width + 2 * dx, height: node.height}, point);\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction mobiledeviceportrait(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst dy = node.width / 8\n\tconst r = node.width / 14\n\tconst shapeSvg = parent.insert('g', ':first-child')\n\tshapeSvg.insert('path', ':first-child')\n\t\t.attr('d', `M${-node.width / 2},${-node.height / 2} l${node.width},0 M${-node.width / 2},${node.height / 2} l${node.width},0`)\n\tshapeSvg.insert('circle', ':first-child')\n\t\t.attr('cx', 0)\n\t\t.attr('cy', node.height / 2 + dy / 2)\n\t\t.attr('r', r * .4)\n\tshapeSvg.insert('rect', ':first-child')\n\t\t.attr('x', -r)\n\t\t.attr('y', -node.height / 2 - dy / 2 - r * .2)\n\t\t.attr('width', r * 2)\n\t\t.attr('height', r * .4)\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", r)\n\t\t.attr(\"ry\", r)\n\t\t.attr(\"x\", -bbox.width / 2)\n\t\t.attr(\"y\", -bbox.height / 2 - dy)\n\t\t.attr(\"width\", bbox.width)\n\t\t.attr(\"height\", bbox.height + 2 * dy);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect({x: node.x, y: node.y, width: node.width, height: node.height + 2 * dy}, point);\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction pipe(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst w = node.width;\n\tconst h = node.height;\n\tconst ry = h / 2;\n\tconst rx = ry / (2.5 + w / 70);\n\n\tconst shape =\n\t\t`M${-rx},0\n\t\ta${rx},${ry} 0,0,1 0,${h}\n\t\ta${rx},${ry} 0,0,1 0,${-h}\n\t\tl${w},0\n\t\ta${rx},${ry} 0,0,1 0,${h}\n\t\tl${-w},0`;\n\n\tconst shapeSvg = parent\n\t\t.insert('path', ':first-child')\n\t\t.attr('d', shape)\n\t\t.attr('transform', 'translate(' + -w / 2 + ',' + -(h / 2) + ')');\n\n\tnode.intersect = function (point: Point) {\n\t\treturn intersectRect({x: node.x - rx, y: node.y, width: node.width + 2 * rx, height: node.height}, point)\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction robot(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst w = node.width\n\tconst h = node.height\n\t\n\t// Small head at top (like person shape but robot-styled)\n\tconst headSize = Math.min(w * 0.28, h * 0.25)\n\tconst headR = headSize * 0.2\n\tconst antennaH = headSize * 0.25\n\tconst antennaR = headSize * 0.08\n\t\n\t// Eye dimensions\n\tconst eyeR = headSize * 0.12\n\tconst eyeSpacing = headSize * 0.22\n\t\n\t// Ear dimensions  \n\tconst earW = headSize * 0.12\n\tconst earH = headSize * 0.3\n\t\n\t// Body fills most of the space for text\n\tconst bodyW = w\n\tconst bodyTop = -h / 2 + antennaH + headSize\n\tconst bodyH = h - antennaH - headSize\n\tconst bodyR = 3\n\t\n\t// Label offset - similar to person shape (h * 0.4)\n\tconst labelOffsetY = h * 0.35\n\t\n\tconst shapeSvg = parent\n\t\t.attr('label-offset-y', labelOffsetY)\n\t\t.insert('g', ':first-child')\n\t\n\t// Body - main rectangle for text (draw first so it's behind)\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", bodyR)\n\t\t.attr(\"ry\", bodyR)\n\t\t.attr('x', -bodyW / 2)\n\t\t.attr('y', bodyTop)\n\t\t.attr('width', bodyW)\n\t\t.attr('height', bodyH)\n\t\n\t// Head\n\tconst headTop = -h / 2 + antennaH\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", headR)\n\t\t.attr(\"ry\", headR)\n\t\t.attr('x', -headSize / 2)\n\t\t.attr('y', headTop)\n\t\t.attr('width', headSize)\n\t\t.attr('height', headSize)\n\t\n\t// Antenna\n\tshapeSvg.insert(\"line\", \":first-child\")\n\t\t.attr('class', 'robot-antenna')\n\t\t.attr('x1', 0)\n\t\t.attr('y1', headTop)\n\t\t.attr('x2', 0)\n\t\t.attr('y2', -h / 2 + antennaR * 2)\n\t\t.attr('stroke-width', antennaR * 0.6)\n\t\t.attr('stroke-linecap', 'round')\n\t\n\t// Antenna ball\n\tshapeSvg.insert(\"circle\", \":first-child\")\n\t\t.attr('class', 'robot-antenna-ball')\n\t\t.attr('cx', 0)\n\t\t.attr('cy', -h / 2 + antennaR * 2)\n\t\t.attr('r', antennaR * 1.2)\n\t\n\t// Eyes\n\tconst eyeY = headTop + headSize * 0.4\n\tshapeSvg.insert(\"circle\", \":first-child\")\n\t\t.attr('class', 'robot-eye')\n\t\t.attr('cx', -eyeSpacing)\n\t\t.attr('cy', eyeY)\n\t\t.attr('r', eyeR)\n\tshapeSvg.insert(\"circle\", \":first-child\")\n\t\t.attr('class', 'robot-eye')\n\t\t.attr('cx', eyeSpacing)\n\t\t.attr('cy', eyeY)\n\t\t.attr('r', eyeR)\n\t\n\t// Mouth - simple smile\n\tconst mouthY = headTop + headSize * 0.7\n\tconst mouthW = headSize * 0.28\n\tshapeSvg.insert(\"path\", \":first-child\")\n\t\t.attr('class', 'robot-mouth')\n\t\t.attr('d', `M${-mouthW / 2},${mouthY} Q0,${mouthY + mouthW * 0.3} ${mouthW / 2},${mouthY}`)\n\t\t.attr('fill', 'none')\n\t\t.attr('stroke-width', antennaR * 0.5)\n\t\t.attr('stroke-linecap', 'round')\n\t\n\t// Ears\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", earW * 0.25)\n\t\t.attr(\"ry\", earW * 0.25)\n\t\t.attr('x', -headSize / 2 - earW - 1)\n\t\t.attr('y', eyeY - earH / 2)\n\t\t.attr('width', earW)\n\t\t.attr('height', earH)\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", earW * 0.25)\n\t\t.attr(\"ry\", earW * 0.25)\n\t\t.attr('x', headSize / 2 + 1)\n\t\t.attr('y', eyeY - earH / 2)\n\t\t.attr('width', earW)\n\t\t.attr('height', earH)\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect(node, point);\n\t};\n\n\treturn shapeSvg;\n}\n\nfunction webbrowser(parent: D3Element, bbox: BBox, node: D3Node) {\n\tconst dy = node.height / 8\n\tconst shapeSvg = parent\n\t\t.attr('label-offset-y', dy)\n\t\t.insert('g', ':first-child')\n\tshapeSvg.insert(\"path\", \":first-child\")\n\t\t.attr('d', `\n\t\t\tM${-node.width / 2},${-node.height / 2 + dy} h${node.width}\n\t\t\tM${-node.width / 2 + dy / 4},${-node.height / 2 + dy / 4} h${dy / 2} v${dy / 2} h${-dy / 2} z\n\t\t\tM${-node.width / 2 + dy},${-node.height / 2 + dy / 4} h${node.width - dy - dy / 4} v${dy / 2} h${-node.width + dy + dy / 4} z\n\t\t`)\n\tshapeSvg.insert(\"rect\", \":first-child\")\n\t\t.attr(\"rx\", 3).attr(\"ry\", 3)\n\t\t.attr(\"x\", -node.width / 2)\n\t\t.attr(\"y\", -node.height / 2)\n\t\t.attr(\"width\", node.width)\n\t\t.attr(\"height\", node.height);\n\n\tnode.intersect = function (point) {\n\t\treturn intersectRect(node, point);\n\t};\n\n\treturn shapeSvg;\n}\n\nexport const shapes: { [key: string]: (parent: SVGElement, node: D3Node) => SVGElement } = {\n\tbox: (parent: SVGElement, node: D3Node) => rect(new D3Element(parent), node, node).node(),\n\troundedbox: (parent: SVGElement, node: D3Node) => rect(new D3Element(parent), node, node, true).node(),\n\tcomponent: (parent: SVGElement, node: D3Node) => component(new D3Element(parent), node, node).node(),\n\tcylinder: (parent: SVGElement, node: D3Node) => cylinder(new D3Element(parent), node, node).node(),\n\tperson: (parent: SVGElement, node: D3Node) => person(new D3Element(parent), node, node).node(),\n\tcircle: (parent: SVGElement, node: D3Node) => circle(new D3Element(parent), node, node).node(),\n\tellipse: (parent: SVGElement, node: D3Node) => ellipse(new D3Element(parent), node, node).node(),\n\thexagon: (parent: SVGElement, node: D3Node) => hexagon(new D3Element(parent), node, node).node(),\n\tfolder: (parent: SVGElement, node: D3Node) => folder(new D3Element(parent), node, node).node(),\n\tmobiledevicelandscape: (parent: SVGElement, node: D3Node) => mobiledevicelandscape(new D3Element(parent), node, node).node(),\n\tmobiledeviceportrait: (parent: SVGElement, node: D3Node) => mobiledeviceportrait(new D3Element(parent), node, node).node(),\n\tmobiledevice: (parent: SVGElement, node: D3Node) => mobiledeviceportrait(new D3Element(parent), node, node).node(),\n\tpipe: (parent: SVGElement, node: D3Node) => pipe(new D3Element(parent), node, node).node(),\n\trobot: (parent: SVGElement, node: D3Node) => robot(new D3Element(parent), node, node).node(),\n\twebbrowser: (parent: SVGElement, node: D3Node) => webbrowser(new D3Element(parent), node, node).node(),\n}\n","import {GraphData, Node, Group} from \"./graph\";\n\nexport interface LayoutOptions {\n\tdirection?: 'UP' | 'DOWN' | 'LEFT' | 'RIGHT';\n\tnodeSpacing?: number;\n\tlayerSpacing?: number;\n\tcompactLayout?: boolean;\n}\n\n// Simplified spacing configuration\ninterface SpacingConfig {\n\tnodeSpacing: number;\n\tlayerSpacing: number;\n\tcomponentSpacing: number;\n\tpadding: number;\n\tgroupMultiplier: number;\n}\n\n// Spacing configuration - balanced for readability\nconst DEFAULT_SPACING: SpacingConfig = {\n\tnodeSpacing: 80,      // Comfortable vertical spacing between nodes in same layer\n\tlayerSpacing: 60,     // Layer spacing (between nodes in flow direction)\n\tcomponentSpacing: 80, // Separation between disconnected components\n\tpadding: 40,          // Padding around the entire layout (for group labels)\n\tgroupMultiplier: 0.65, // Moderate compaction within groups\n};\n\n// Helper function to get effective spacing for a context\nfunction getEffectiveSpacing(\n\tuserOptions: LayoutOptions = {},\n\tisGroup: boolean = false\n): SpacingConfig {\n\t// Apply user overrides to base config\n\tconst effectiveConfig: SpacingConfig = {\n\t\tnodeSpacing: userOptions.nodeSpacing ?? DEFAULT_SPACING.nodeSpacing,\n\t\tlayerSpacing: userOptions.layerSpacing ?? DEFAULT_SPACING.layerSpacing,\n\t\tcomponentSpacing: DEFAULT_SPACING.componentSpacing,\n\t\tpadding: DEFAULT_SPACING.padding,\n\t\tgroupMultiplier: DEFAULT_SPACING.groupMultiplier,\n\t};\n\t\n\t// Apply group multiplier if in group context\n\tif (isGroup) {\n\t\teffectiveConfig.nodeSpacing = Math.max(\n\t\t\teffectiveConfig.nodeSpacing * effectiveConfig.groupMultiplier,\n\t\t\t30  // Minimum 30px spacing within groups\n\t\t);\n\t\teffectiveConfig.layerSpacing = Math.max(\n\t\t\teffectiveConfig.layerSpacing * effectiveConfig.groupMultiplier,\n\t\t\t35  // Minimum 35px layer spacing within groups\n\t\t);\n\t\teffectiveConfig.componentSpacing = Math.max(\n\t\t\teffectiveConfig.componentSpacing * effectiveConfig.groupMultiplier,\n\t\t\t25  // Minimum 25px component spacing within groups\n\t\t);\n\t\teffectiveConfig.padding = Math.max(\n\t\t\teffectiveConfig.padding * effectiveConfig.groupMultiplier,\n\t\t\t15  // Minimum 15px padding within groups\n\t\t);\n\t}\n\t\n\treturn effectiveConfig;\n}\n\n// Simplified ELK layout options builder\nfunction getELKOptions(\n\tspacing: SpacingConfig,\n\tuserOptions: LayoutOptions\n): Record<string, string> {\n\tconst {\n\t\tdirection = 'DOWN',\n\t\tcompactLayout = false\n\t} = userOptions;\n\t\n\tconst baseOptions: Record<string, string> = {\n\t\t'elk.algorithm': 'layered', // Back to layered for better orthogonal routing\n\t\t'elk.direction': direction,\n\t\t'elk.spacing.nodeNode': spacing.nodeSpacing.toString(),\n\t\t'elk.spacing.componentComponent': spacing.componentSpacing.toString(),\n\t\t'elk.padding': `[top=${spacing.padding},left=${spacing.padding},bottom=${spacing.padding},right=${spacing.padding}]`,\n\t\t\n\t\t// Layer spacing for compact layout\n\t\t'elk.layered.spacing.nodeNodeBetweenLayers': spacing.layerSpacing.toString(),\n\t\t'elk.layered.spacing.edgeNodeBetweenLayers': '10', // Minimal spacing around nodes\n\t\t'elk.layered.spacing.edgeEdgeBetweenLayers': '10',  // Minimal space between edges\n\t\t\n\t\t// ORTHOGONAL edge routing for cleaner layout\n\t\t'elk.edgeRouting': 'POLYLINE',\n\t\t'elk.layered.unnecessaryBendpoints': 'false',\n\t\t\n\t\t// Minimal edge routing - straight lines where possible\n\t\t'elk.layered.edgeRouting.orthogonal.mode': 'DIRECTION_BASED',\n\t\t'elk.layered.edgeRouting.orthogonal.spacing': '5', // Minimal edge spacing\n\t\t'elk.layered.edgeRouting.orthogonal.nodeOverlapRatio': '0.1',\n\t\t\n\t\t// Compaction options\n\t\t'elk.layered.compaction.connectedComponents': 'true',\n\t\t'elk.layered.compaction.postCompaction.strategy': 'LEFT_RIGHT',\n\t\t\n\t\t// Separate components to reduce complexity\n\t\t'elk.separateConnectedComponents': 'true',\n\t\t\n\t\t// Node placement strategy for consistent vertical spacing\n\t\t'elk.layered.nodePlacement.strategy': 'NETWORK_SIMPLEX',\n\t\t'elk.layered.nodePlacement.favorStraightEdges': 'true',\n\t\t\n\t\t// Crossing minimization - respect model order for consistent layout\n\t\t'elk.layered.crossingMinimization.strategy': 'LAYER_SWEEP',\n\t\t'elk.layered.crossingMinimization.semiInteractive': 'true',\n\t\t\n\t\t// Flatten hierarchy for better edge routing\n\t\t'elk.hierarchyHandling': 'SEPARATE_CHILDREN',\n\t\t'elk.layered.considerModelOrder.strategy': 'NONE', // Ignore model ordering constraints\n\t\t\n\t\t// Edge label handling - minimal space, labels positioned above edges\n\t\t'elk.edgeLabels.placement': 'CENTER',\n\t\t'elk.edgeLabels.inline': 'true',\n\t\t'elk.spacing.edgeLabel': '5', // Minimal spacing for labels\n\t\t'elk.edgeLabels.avoidOverlap': 'false', // Disable collision avoidance\n\t\t'elk.edgeLabels.considerModelOrder': 'false',\n\t\t'elk.layered.edgeLabels.sideSelection': 'ALWAYS_UP', // Labels above edges\n\t};\n\t\n\t// Additional compact layout options if requested\n\tif (compactLayout) {\n\t\tbaseOptions['elk.spacing.nodeNode'] = Math.max(spacing.nodeSpacing * 0.7, 30).toString();\n\t\tbaseOptions['elk.layered.spacing.nodeNodeBetweenLayers'] = Math.max(spacing.layerSpacing * 0.7, 30).toString();\n\t}\n\t\n\treturn baseOptions;\n}\n\nexport async function autoLayout(graph: GraphData, options: LayoutOptions = {}): Promise<{\n\tnodes: Array<{id: string, x: number, y: number}>,\n\tedges: Array<{id: string, vertices: Array<{x: number, y: number}>, label?: {x: number, y: number}}>\n}> {\n\t// Dynamically import ELK only when auto-layout is used\n\tconst ELK = await import('elkjs/lib/elk.bundled.js').then(module => module.default);\n\tconst elk = new ELK();\n\t// Get systematic spacing configuration\n\tconst rootSpacing = getEffectiveSpacing(options, false);\n\t\n\t// Build ELK graph structure\n\tconst elkGraph = {\n\t\tid: \"root\",\n\t\tlayoutOptions: getELKOptions(rootSpacing, options),\n\t\tchildren: [] as any[],\n\t\tedges: [] as any[]\n\t};\n\n\t// Add ONLY actual nodes to ELK graph (exclude edge vertices)\n\tconst nodeMap = new Map<string, Node>();\n\tgraph.nodesMap.forEach(node => {\n\t\tif (!node.id) return; // Skip nodes without IDs\n\t\t\n\t\tnodeMap.set(node.id, node);\n\t\t\n\t\t// Ensure minimum dimensions and validate node size data\n\t\t// Use larger height to account for shapes like Robot that extend above the center\n\t\tconst nodeWidth = Math.max(node.width || 200, 150); // Min width 150px\n\t\tconst nodeHeight = Math.max(node.height || 100, 250); // Min height 250px to account for robot shape\n\t\t\n\t\t// Add padding to node dimensions for ELK to account for arrow size\n\t\t// This makes ELK route edges to a slightly larger boundary so arrow tips stay outside\n\t\tconst arrowPadding = 25; // Padding for arrow clearance\n\t\t\n\t\telkGraph.children.push({\n\t\t\tid: node.id,\n\t\t\t// Provide current position as hint to ELK\n\t\t\tx: node.x,\n\t\t\ty: node.y,\n\t\t\twidth: nodeWidth + (arrowPadding * 2),\n\t\t\theight: nodeHeight + (arrowPadding * 2),\n\t\t\tlayoutOptions: {\n\t\t\t\t// Allow ELK to move nodes but consider current positions\n\t\t\t\t'elk.position': '',\n\t\t\t\t// Force ELK to use our exact dimensions\n\t\t\t\t'elk.nodeSize.constraints': '[FIXED_SIZE]'\n\t\t\t}\n\t\t});\n\t});\n\n\t// EXPERIMENTAL: Skip group processing - treat all nodes as flat\n\t// This should eliminate group-based routing detours\n\n\t// Add all edges to root level for optimal ELK routing visibility\n\tlet addedEdges = 0;\n\tgraph.edges.forEach(edge => {\n\t\t// Skip edges without proper IDs\n\t\tif (!edge.id || !edge.from?.id || !edge.to?.id) return;\n\t\t\n\t\t// Verify source and target nodes exist in our node map\n\t\tif (!nodeMap.has(edge.from.id) || !nodeMap.has(edge.to.id)) {\n\t\t\tconsole.warn(`Skipping edge ${edge.id}: source ${edge.from.id} or target ${edge.to.id} not found in nodes`);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\taddedEdges++;\n\t\t\n\t\t// Calculate more accurate label dimensions for ELK\n\t\tconst labelWidth = edge.label && edge.label.trim() ? \n\t\t\tMath.min(edge.label.length * 7, 200) : 0; // More realistic width estimate\n\t\t\n\t\t\n\t\tconst elkEdge = {\n\t\t\tid: edge.id,\n\t\t\tsources: [edge.from.id],\n\t\t\ttargets: [edge.to.id],\n\t\t\t// Include label information with much smaller dimensions\n\t\t\tlabels: edge.label && edge.label.trim() ? [{\n\t\t\t\tid: `${edge.id}-label`,\n\t\t\t\ttext: edge.label,\n\t\t\t\t// Much more conservative label size estimates\n\t\t\t\twidth: labelWidth,\n\t\t\t\theight: 20, // More realistic label height\n\t\t\t\tlayoutOptions: {\n\t\t\t\t\t'elk.edgeLabels.placement': 'CENTER',\n\t\t\t\t\t'elk.edgeLabels.inline': 'true'\n\t\t\t\t\t// Remove the FIXED_SIZE constraint that might be forcing detours\n\t\t\t\t}\n\t\t\t}] : []\n\t\t};\n\n\t\t// All edges at root level for maximum ELK visibility and routing\n\t\telkGraph.edges.push(elkEdge);\n\t});\n\n\t// Enhanced validation - ensure ELK gets complete data\n\tif (!elkGraph.id || !elkGraph.children) {\n\t\tthrow new Error('Invalid ELK graph structure');\n\t}\n\t\n\n\ttry {\n\t\tconst layoutedGraph = await elk.layout(elkGraph);\n\t\t\n\t\t// Extract results\n\t\tconst nodes: Array<{id: string, x: number, y: number}> = [];\n\t\tconst edges: Array<{id: string, vertices: Array<{x: number, y: number}>, label?: {x: number, y: number}}> = [];\n\n\n\t\t// Extract nodes from layout result\n\t\tconst extractNodes = (container: any, offsetX = 0, offsetY = 0) => {\n\t\t\tcontainer.children?.forEach((child: any) => {\n\t\t\t\tif (child.children) {\n\t\t\t\t\t// This is a group, recurse\n\t\t\t\t\textractNodes(child, offsetX + (child.x || 0), offsetY + (child.y || 0));\n\t\t\t\t} else {\n\t\t\t\t\t// This is a node\n\t\t\t\t\t// Adjust for the padding we added - ELK positioned based on padded size\n\t\t\t\t\t// So we need to shift by the padding amount to get the real center\n\t\t\t\t\tnodes.push({\n\t\t\t\t\t\tid: child.id,\n\t\t\t\t\t\tx: offsetX + (child.x || 0) + (child.width || 0) / 2,\n\t\t\t\t\t\ty: offsetY + (child.y || 0) + (child.height || 0) / 2\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// Process edges from ELK layout result to get routing information\n\t\tconst processEdgesFromELK = (container: any, offsetX = 0, offsetY = 0) => {\n\t\t\tcontainer.edges?.forEach((elkEdge: any) => {\n\t\t\t\tconst vertices: Array<{x: number, y: number}> = [];\n\t\t\t\tlet label: {x: number, y: number} | undefined;\n\n\t\t\t\t// Process edge sections to get bend points\n\t\t\t\tif (elkEdge.sections && elkEdge.sections.length > 0) {\n\t\t\t\t\telkEdge.sections.forEach((section: any) => {\n\t\t\t\t\t\t// Add start point if it exists\n\t\t\t\t\t\tif (section.startPoint) {\n\t\t\t\t\t\t\tvertices.push({\n\t\t\t\t\t\t\t\tx: offsetX + section.startPoint.x, \n\t\t\t\t\t\t\t\ty: offsetY + section.startPoint.y\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Add bend points (this is where ELK puts the routing vertices!)\n\t\t\t\t\t\tif (section.bendPoints && section.bendPoints.length > 0) {\n\t\t\t\t\t\t\tsection.bendPoints.forEach((bp: any) => {\n\t\t\t\t\t\t\t\tvertices.push({\n\t\t\t\t\t\t\t\t\tx: offsetX + bp.x, \n\t\t\t\t\t\t\t\t\ty: offsetY + bp.y\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Add end point if it exists\n\t\t\t\t\t\tif (section.endPoint) {\n\t\t\t\t\t\t\tvertices.push({\n\t\t\t\t\t\t\t\tx: offsetX + section.endPoint.x, \n\t\t\t\t\t\t\t\ty: offsetY + section.endPoint.y\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Extract ELK's calculated label positions (respect collision avoidance!)\n\t\t\t\tconst originalEdge = graph.edges.find(e => e.id === elkEdge.id);\n\t\t\t\tif (originalEdge?.label && originalEdge.label.trim()) {\n\t\t\t\t\tif (elkEdge.labels && elkEdge.labels.length > 0) {\n\t\t\t\t\t\tconst elkLabel = elkEdge.labels[0]; // Get first label\n\t\t\t\t\t\tif (elkLabel.x !== undefined && elkLabel.y !== undefined) {\n\t\t\t\t\t\t\tlabel = {\n\t\t\t\t\t\t\t\tx: offsetX + elkLabel.x + (elkLabel.width || 0) / 2, // Center of label\n\t\t\t\t\t\t\t\ty: offsetY + elkLabel.y + (elkLabel.height || 0) / 2\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (vertices.length >= 2) {\n\t\t\t\t\t\t// Fallback: use middle of edge if ELK didn't provide label position\n\t\t\t\t\t\tconst midIndex = Math.floor(vertices.length / 2);\n\t\t\t\t\t\tif (vertices.length % 2 === 0) {\n\t\t\t\t\t\t\tconst v1 = vertices[midIndex - 1];\n\t\t\t\t\t\t\tconst v2 = vertices[midIndex];\n\t\t\t\t\t\t\tlabel = { x: (v1.x + v2.x) / 2, y: (v1.y + v2.y) / 2 };\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlabel = vertices[midIndex];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t\t\t\tedges.push({\n\t\t\t\t\tid: elkEdge.id,\n\t\t\t\t\tvertices,\n\t\t\t\t\tlabel\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\t// Also process edges in child containers (groups)\n\t\t\tcontainer.children?.forEach((child: any) => {\n\t\t\t\tif (child.edges && child.edges.length > 0) {\n\t\t\t\t\tprocessEdgesFromELK(child, offsetX + (child.x || 0), offsetY + (child.y || 0));\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\n\t\textractNodes(layoutedGraph);\n\t\tprocessEdgesFromELK(layoutedGraph);\n\n\t\t// Normalize coordinates to start near (0,0) to prevent huge canvas sizes\n\t\t// while preserving relative positioning between elements\n\t\tif (nodes.length > 0) {\n\t\t\t// Find the minimum coordinates across all elements\n\t\t\tconst minX = Math.min(...nodes.map(n => n.x));\n\t\t\tconst minY = Math.min(...nodes.map(n => n.y));\n\t\t\t\n\t\t\t// Add some padding so content doesn't start at exact (0,0)\n\t\t\tconst padding = 50;\n\t\t\tconst offsetX = -minX + padding;\n\t\t\tconst offsetY = -minY + padding;\n\t\t\t\n\t\t\t// Normalize all node positions\n\t\t\tnodes.forEach(node => {\n\t\t\t\tnode.x += offsetX;\n\t\t\t\tnode.y += offsetY;\n\t\t\t});\n\t\t\t\n\t\t\t// Normalize all edge positions\n\t\t\tedges.forEach(edge => {\n\t\t\t\tedge.vertices.forEach(vertex => {\n\t\t\t\t\tvertex.x += offsetX;\n\t\t\t\t\tvertex.y += offsetY;\n\t\t\t\t});\n\t\t\t\tif (edge.label) {\n\t\t\t\t\tedge.label.x += offsetX;\n\t\t\t\t\tedge.label.y += offsetY;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn { nodes, edges };\n\n\t} catch (error) {\n\t\tconsole.warn('ELK layout failed, using fallback layout. Error:', error);\n\t\treturn createFallbackLayout(graph);\n\t}\n}\n\n// Simplified fallback layout\nfunction createFallbackLayout(graph: GraphData): {\n\tnodes: Array<{id: string, x: number, y: number}>,\n\tedges: Array<{id: string, vertices: Array<{x: number, y: number}>}>\n} {\n\tconst nodes: Array<{id: string, x: number, y: number}> = [];\n\tconst edges: Array<{id: string, vertices: Array<{x: number, y: number}>}> = [];\n\n\t// Simple grid layout for nodes\n\tlet x = 0, y = 0;\n\tconst spacing = 300;\n\tconst maxCols = Math.ceil(Math.sqrt(graph.nodesMap.size));\n\n\tlet col = 0;\n\tgraph.nodesMap.forEach(node => {\n\t\tnodes.push({\n\t\t\tid: node.id,\n\t\t\tx: x,\n\t\t\ty: y\n\t\t});\n\n\t\tcol++;\n\t\tif (col >= maxCols) {\n\t\t\tcol = 0;\n\t\t\tx = 0;\n\t\t\ty += spacing;\n\t\t} else {\n\t\t\tx += spacing;\n\t\t}\n\t});\n\n\t// Simple straight line edges\n\tgraph.edges.forEach(edge => {\n\t\tedges.push({\n\t\t\tid: edge.id,\n\t\t\tvertices: []\n\t\t});\n\t});\n\n\treturn { nodes, edges };\n}\n\n// Removed unused isGroup function since we skip group processing","/**\n * Undo functionality\n * at every change in the document, Undo can save a new version\n * so the user can \"undo\" and \"redo\" changes by reverting to an\n * older version of the document\n */\n\nexport class Undo<Doc> {\n\tprivate readonly versions: Doc[] = [];\n\tprivate pos: number = 0;\n\tprivate lastSavedPos: number = 0;\n\tprivate readonly exportDoc: () => Doc;\n\tprivate readonly importDoc: (d: Doc) => void;\n\tchange: () => void;\n\tprivate tmpPreviousState: Doc | null = null;\n\n\tconstructor(id: string, exportDoc: () => Doc, importDoc: (d: Doc) => void) {\n\t\tthis.exportDoc = exportDoc;\n\t\tthis.importDoc = importDoc;\n\t\tthis.change = debounce(() => this.saveNow(), 300);\n\t}\n\n\t// Store the state previous to the changes collected in the debounce period\n\tbeforeChange() {\n\t\tif (!this.tmpPreviousState) {\n\t\t\tthis.tmpPreviousState = this.deepClone(this.exportDoc());\n\t\t}\n\t}\n\n\tlength() {\n\t\treturn this.versions.length;\n\t}\n\n\tcurrentState() {\n\t\treturn this.deepClone(this.versions[this.pos - 1]);\n\t}\n\n\tprivate saveNow() {\n\t\tif (!this.tmpPreviousState) {\n\t\t\tthrow Error(\"undo.change() was called without previously calling undo.beforeChange()!\");\n\t\t}\n\t\t\n\t\tthis.versions[this.pos] = this.deepClone(this.exportDoc());\n\t\tthis.versions[this.pos - 1] = this.tmpPreviousState;\n\t\tthis.tmpPreviousState = null;\n\t\tthis.pos += 1;\n\t\t\n\t\t// Remove anything that might be on top of this version\n\t\tthis.versions.splice(this.pos);\n\t}\n\n\tprivate deepClone(doc: Doc): Doc {\n\t\t// Use modern structuredClone if available, fallback to JSON\n\t\tif (typeof structuredClone !== 'undefined') {\n\t\t\treturn structuredClone(doc);\n\t\t}\n\t\treturn JSON.parse(JSON.stringify(doc));\n\t}\n\n\tundo() {\n\t\tif (this.pos < 2) return;\n\t\tthis.pos -= 1;\n\t\tconst doc = this.versions[this.pos - 1];\n\t\tthis.importDoc(this.deepClone(doc));\n\t}\n\n\tredo() {\n\t\tif (this.pos > this.versions.length - 1) return;\n\t\tconst doc = this.versions[this.pos];\n\t\tthis.importDoc(this.deepClone(doc));\n\t\tthis.pos += 1;\n\t}\n\n\tchanged() {\n\t\treturn this.pos !== this.lastSavedPos;\n\t}\n\n\tsetSaved() {\n\t\tthis.lastSavedPos = this.pos;\n\t}\n}\n\nfunction debounce(func: () => void, wait: number) {\n\tlet timeout: ReturnType<typeof setTimeout>;\n\treturn function () {\n\t\tconst context = this;\n\t\tconst later = function () {\n\t\t\ttimeout = null;\n\t\t\tfunc.apply(context);\n\t\t};\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t};\n}","// Constants and default configurations for the graph view\n\nexport interface Point {\n\tx: number;\n\ty: number;\n}\n\nexport interface BBox extends Point {\n\twidth: number;\n\theight: number;\n}\n\nexport interface NodeStyle {\n\t// Width of element, in pixels.\n\twidth?: number\n\t// Height of element, in pixels.\n\theight?: number\n\t// Background color of element as HTML RGB hex string (e.g. \"#ffffff\")\n\tbackground?: string\n\t// Stroke color of element as HTML RGB hex string (e.g. \"#000000\")\n\tstroke?: string\n\t// Foreground (text) color of element as HTML RGB hex string (e.g. \"#ffffff\")\n\tcolor?: string\n\t// Standard font size used to render text, in pixels.\n\tfontSize?: number\n\t// Shape used to render element.\n\tshape?: string\n\t// URL of PNG/JPG/GIF file or Base64 data URI representation.\n\ticon?: string\n\t// Type of border used to render element.\n\tborder?: string\n\t// Opacity used to render element; 0-100.\n\topacity?: number\n\t// Whether element metadata should be shown.\n\tmetadata?: boolean\n\t// Whether element description should be shown.\n\tdescription?: boolean\n}\n\nexport interface EdgeStyle {\n\t// Thickness of line, in pixels.\n\tthickness?: number\n\t// Color of line as HTML RGB hex string (e.g. \"#ffffff\").\n\tcolor?: string\n\t// Standard font size used to render relationship annotation, in pixels.\n\tfontSize?: number\n\t// Width of relationship annotation, in pixels.\n\twidth?: number\n\t// Whether line is dashed.\n\tdashed?: boolean\n\t// Position of label along edge (0-100).\n\tposition?: number\n\t// Opacity used to render relationship; 0-100.\n\topacity?: number\n\t// Arrow style for the edge.\n\tarrowStyle?: 'normal' | 'large' | 'small' | 'none'\n}\n\n// Default styles\nexport const DEFAULT_EDGE_STYLE: EdgeStyle = {\n\tthickness: 3,\n\tcolor: '#999',\n\topacity: 1,\n\tfontSize: 22,\n\tdashed: true,\n};\n\nexport const DEFAULT_NODE_STYLE: NodeStyle = {\n\twidth: 280,\n\theight: 180,\n\tbackground: 'rgba(255, 255, 255, .9)',\n\tcolor: '#666',\n\topacity: .9,\n\tstroke: '#999',\n\tfontSize: 22,\n\tshape: 'Box'\n};\n\n// SVG styles\nexport const SVG_STYLES = {\n\tnodeBorder: {\n\t\tfill: \"rgba(255, 255, 255, 0.86)\",\n\t\tstroke: \"#aaa\",\n\t\tfilter: 'url(#shadow)',\n\t},\n\tnodeText: {\n\t\t'font-family': 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n\t\tstroke: \"none\"\n\t},\n\tedgeText: {\n\t\t'font-family': 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n\t\tstroke: \"none\"\n\t},\n\tedgeRect: {\n\t\tfill: \"none\",\n\t\tstroke: \"none\",\n\t},\n\tgroupRect: {\n\t\tfill: \"rgba(0, 0, 0, 0.02)\",\n\t\tstroke: \"#666\",\n\t\t'stroke-width': 3,\n\t\t\"stroke-dasharray\": 4,\n\t},\n\tgroupText: {\n\t\tfill: \"#666\",\n\t\t\"font-size\": 22,\n\t\t\"font-weight\": \"500\",\n\t\t'font-family': 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',\n\t\tcursor: \"default\"\n\t}\n};\n\n// Configuration constants\nexport const SVG_PADDING = 20;\nexport const DEFAULT_GRID_SIZE = 25;\nexport const EDGE_SPREAD_DISTANCE = 70;\nexport const EDGE_SPREAD_DISTANCE_X = 200;\n\n// Utility function to apply styles to SVG elements\nexport const applyStyle = (el: SVGElement, style: { [key: string]: string | number }) => {\n\tObject.keys(style).forEach(key => {\n\t\tconst value = style[key];\n\t\tif (typeof value === 'number') {\n\t\t\tel.style.setProperty(key, value.toString());\n\t\t} else {\n\t\t\tel.style.setProperty(key, value);\n\t\t}\n\t});\n};\n\n// Utility function to calculate distance between two points\nexport const calculateDistance = (p1: Point, p2: Point): number => {\n\treturn Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));\n};","import {defs} from \"./defs\";\nimport {create, setPosition} from \"./svg-create\";\nimport {cursorInteraction} from \"svg-editor-tools/lib/cursor-interaction\";\nimport {shapes} from \"./shapes\";\nimport {\n\tboxesOverlap,\n\tcabDistance,\n\tinsideBox,\n\tintersectPolylineBox,\n\tproject,\n\tscaleBox,\n\tSegment,\n\tuncenterBox\n} from \"./intersect\";\nimport {autoLayout} from \"./layout\";\nimport {Undo} from \"./undo\";\nimport {\n\tADD_LABEL_VERTEX,\n\tADD_VERTEX,\n\tDEL_VERTEX,\n\tDESELECT,\n\tfindShortcut,\n\tREDO,\n\tSELECT_ALL,\n\tUNDO,\n\tZOOM_100,\n\tZOOM_FIT,\n\tZOOM_IN,\n\tZOOM_OUT\n} from \"../shortcuts\";\nimport {\n\tPoint,\n\tBBox,\n\tNodeStyle,\n\tEdgeStyle,\n\tDEFAULT_EDGE_STYLE,\n\tDEFAULT_NODE_STYLE,\n\tSVG_STYLES,\n\tSVG_PADDING,\n\tDEFAULT_GRID_SIZE,\n\tapplyStyle,\n\tcalculateDistance\n} from \"./constants\";\nimport {\n\tcalculateEdgeVertices,\n\tcalculateLabelPosition,\n\tcreateEdgeSegments\n} from \"./edge-utils\";\n\n\n// Point and BBox interfaces are now imported from constants\n\nexport interface Group extends BBox {\n\tid: string;\n\tname: string;\n\tnodes: (Node | Group)[];\n\tref?: SVGGElement;\n\tstyle: NodeStyle;\n}\n\nexport interface Node extends BBox {\n\tid: string;\n\ttitle: string;\n\tsub: string;\n\tdescription: string;\n\n\tref?: SVGGElement;\n\tselected?: boolean;\n\n\tintersect: (p: Point) => Point\n\n\tstyle: NodeStyle\n}\n\n// NodeStyle interface is now imported from constants\n\n// EdgeStyle interface is now imported from constants\n\n// Default styles are now imported from constants\nconst defaultEdgeStyle = DEFAULT_EDGE_STYLE;\nconst defaultNodeStyle = DEFAULT_NODE_STYLE;\n\n// Edge and EdgeVertex interfaces are now defined in edge-utils.ts\n// Using local interfaces for compatibility with existing code\ninterface Edge {\n\tid: string;\n\tlabel: string;\n\tfrom: Node;\n\tto: Node;\n\tvertices?: EdgeVertex[];\n\tref?: SVGGElement;\n\tstyle: EdgeStyle;\n\tinitVertex: (p: Point) => EdgeVertex;\n\tuserDeletedVertices?: boolean; // Track if user explicitly deleted vertices\n\tlabelVertex?: EdgeVertex; // ELK-calculated label position (separate from routing vertices)\n}\n\ninterface EdgeVertex extends Point {\n\tid: string\n\tselected?: boolean\n\tedge: Edge\n\tref?: SVGElement\n\tlabel?: boolean\n\tauto?: boolean\n}\n\ninterface Layout {\n\t[k: string]: Point | (Point & { label: boolean })[] | boolean\n}\n\nexport class GraphData {\n\tid: string;\n\tname: string;\n\tnodesMap: Map<string, Node>;\n\tedges: Edge[];\n\tedgeVertices: Map<string, EdgeVertex>\n\tgroupsMap: Map<string, Group>;\n\tmetadata: any;\n\tcolorToVarMap: Map<string, string> = new Map(); // For CSS custom properties theming\n\tprivate _undo: Undo<Layout>;\n\tprivate _gridVisible: boolean = false;\n\tprivate _snapToGrid: boolean = true;\n\tprivate _gridSize: number = 25;\n\tprivate _skipAutoFit: boolean = false;\n\n\tconstructor(id?: string, name?: string) {\n\t\tthis.id = id;\n\t\tthis.name = name;\n\n\t\tthis.edges = [];\n\t\tthis.edgeVertices = new Map;\n\t\tthis.nodesMap = new Map;\n\t\tthis.groupsMap = new Map;\n\n\t\tthis._undo = new Undo<Layout>(\n\t\t\tthis.id,\n\t\t\t() => this.exportLayout(true),\n\t\t\t(lo) => this.importLayout(lo, true)\n\t\t)\n\n\t\t// @ts-ignore\n\t\twindow.graph = this\n\t}\n\n\t// after the graph model is build using addNode, addEdge etc, initialize\n\tinit(layout?: Layout) {\n\t\tlayout && this.importLayout(layout)\n\t\tthis._undo = new Undo<Layout>(\n\t\t\tthis.id,\n\t\t\t() => this.exportLayout(true),\n\t\t\t(lo) => this.importLayout(lo, true)\n\t\t)\n\t\tif (this._undo.length()) {\n\t\t\tthis.importLayout(this._undo.currentState())\n\t\t}\n\t\t\n\t\t// Save initial state so first action is undoable\n\t\tthis._undo.beforeChange()\n\t\tthis._undo.change()\n\t}\n\n\taddNode(id: string, label: string, sub: string, description: string, style: NodeStyle) {\n\t\tif (this.nodesMap.has(id)) throw Error('duplicate node: ' + id)\n\t\t\n\t\t// ALWAYS use fixed dimensions - ignore any width/height from incoming styles\n\t\t// This ensures visual consistency regardless of model data\n\t\tconst shape = style.shape || 'Box';\n\t\tconst isPersonShape = shape.toLowerCase() === 'person';\n\t\tconst isCylinderShape = shape.toLowerCase() === 'cylinder';\n\t\t\n\t\t// Fixed dimensions based only on shape type - completely ignore style.width/height\n\t\tlet width: number;\n\t\tlet height: number;\n\t\t\n\t\tif (isPersonShape) {\n\t\t\twidth = 280;\n\t\t\theight = 240;\n\t\t} else if (isCylinderShape) {\n\t\t\t// Make cylinders wider to better accommodate text content\n\t\t\twidth = 280; // Same width as boxes for consistency\n\t\t\theight = 180; // Same height as boxes for consistency\n\t\t} else {\n\t\t\t// Standard rectangular shapes\n\t\t\twidth = 280;\n\t\t\theight = 180;\n\t\t}\n\t\t\n\t\t// Remove any width/height from style to prevent conflicts\n\t\tconst cleanStyle = {...style};\n\t\tdelete cleanStyle.width;\n\t\tdelete cleanStyle.height;\n\t\t\n\t\tconst n: Node = {\n\t\t\tid, title: label, sub, description, style: {...defaultNodeStyle, ...cleanStyle},\n\t\t\tx: 0, y: 0, width, height, intersect: null\n\t\t}\n\t\tthis.nodesMap.set(n.id, n)\n\t}\n\n\tnodes() {\n\t\treturn Array.from(this.nodesMap.values())\n\t}\n\n\taddEdge(id: string, fromNode: string, toNode: string, label: string, vertices: Point[], style: EdgeStyle) {\n\t\tvertices && vertices.forEach((p, i) => {\n\t\t\tconst v = p as EdgeVertex\n\t\t\tv.id = `v-${id}-${i}`\n\t\t\tthis.edgeVertices.set(v.id, v)\n\t\t})\n\t\tconst randomID = () => Math.round(Math.random() * 1e10).toString(36)\n\t\tconst initVertex = (p: Point) => {\n\t\t\tconst v = p as EdgeVertex\n\t\t\tif (!v.id) {\n\t\t\t\tv.id = `v-${randomID()}`\n\t\t\t\tthis.edgeVertices.set(v.id, v)\n\t\t\t}\n\t\t\tv.edge = edge\n\t\t\treturn p as EdgeVertex\n\t\t}\n\t\tconst edge = {\n\t\t\tid,\n\t\t\tfrom: this.nodesMap.get(fromNode),\n\t\t\tto: this.nodesMap.get(toNode),\n\t\t\tlabel,\n\t\t\tvertices: null as EdgeVertex[],\n\t\t\tstyle: {...defaultEdgeStyle, ...style},\n\t\t\tinitVertex,\n\t\t\tuserDeletedVertices: false\n\t\t}\n\t\tthis.edges.push(edge)\n\t\tif (vertices) {\n\t\t\tedge.vertices = vertices.map(p => edge.initVertex(p))\n\t\t}\n\t}\n\n\taddGroup(id: string, name: string, nodesOrGroups: string[], style: NodeStyle) {\n\t\tif (this.groupsMap.has(id)) {\n\t\t\tconsole.error(`Group exists: ${id} ${name}`)\n\t\t\treturn\n\t\t}\n\t\tconst group: Group = {\n\t\t\tid, name, x: null, y: null, width: null, height: null,\n\t\t\tnodes: nodesOrGroups.map(k => {\n\t\t\t\tconst n = this.nodesMap.get(k) || this.groupsMap.get(k)\n\t\t\t\tif (!n) console.error(`Node or group ${k} not found for group ${id} \"${name}\"`)\n\t\t\t\treturn n\n\t\t\t}).filter(Boolean),\n\t\t\tstyle\n\t\t}\n\t\tthis.groupsMap.set(id, group)\n\t}\n\n\t// private rebuildNode(node: Node) {\n\t// \tconst p = node.ref.parentElement;\n\t// \tp.removeChild(node.ref)\n\t// \tnode.ref = buildNode(node, this)\n\t// \tp.appendChild(node.ref)\n\t// \tthis.redrawEdges(node)\n\t// \tthis.redrawGroups(node)\n\t// }\n\n\tsetNodeSelected(node: Node, selected: boolean) {\n\t\tnode.selected = selected\n\t\tselected ?\n\t\t\tnode.ref.classList.add('selected') :\n\t\t\tnode.ref.classList.remove('selected')\n\t\tthis.updateEdgesSel()\n\t}\n\n\tprivate updateEdgesSel() {\n\t\tthis.edges.forEach(e => {\n\t\t\tif (e.to.selected || e.from.selected) {\n\t\t\t\te.ref.classList.add('selected')\n\t\t\t} else {\n\t\t\t\te.ref.classList.remove('selected')\n\t\t\t}\n\t\t})\n\t}\n\n\tmoveNode(n: Node, x: number, y: number, disableSnap: boolean = false, skipUndo: boolean = false) {\n\t\tif (!n) return\n\t\t\n\t\t// Apply snap-to-grid if enabled and not explicitly disabled\n\t\tif (this._snapToGrid && !disableSnap) {\n\t\t\tconst snapped = this.snapToGrid(x, y);\n\t\t\tx = snapped.x;\n\t\t\ty = snapped.y;\n\t\t}\n\t\t\n\t\tif (n.x == x && n.y == y) return\n\t\t\n\t\tif (!skipUndo) {\n\t\t\tthis._undo.beforeChange()\n\t\t}\n\t\tn.x = x;\n\t\tn.y = y;\n\t\tsetPosition(n.ref, x, y)\n\t\tthis.redrawEdges(n);\n\t\tthis.redrawGroups(n)\n\t\tif (!skipUndo) {\n\t\t\tthis._undo.change()\n\t\t}\n\t}\n\n\tmoveEdgeVertex(v: EdgeVertex, x: number, y: number, disableSnap: boolean = false, skipUndo: boolean = false) {\n\t\t\n\t\tif (this._snapToGrid && !disableSnap) {\n\t\t\tconst snapped = this.snapToGrid(x, y);\n\t\t\tx = snapped.x;\n\t\t\ty = snapped.y;\n\t\t}\n\t\t// Use exact coordinates (no rounding needed with modern grid system)\n\t\t\n\t\tif (v.x == x && v.y == y) return\n\t\tif (!skipUndo) {\n\t\t\tthis._undo.beforeChange()\n\t\t}\n\t\tv.x = x;\n\t\tv.y = y;\n\t\tthis.redrawEdge(v.edge)\n\t\tif (!skipUndo) {\n\t\t\tthis._undo.change()\n\t\t}\n\t}\n\n\tmoveSelected(dx: number, dy: number, disableSnap: boolean = false) {\n\t\tthis.nodes().forEach(n => n.selected && this.moveNode(n, n.x + dx, n.y + dy, disableSnap, false))\n\t\tthis.edgeVertices.forEach(v => v.selected && this.moveEdgeVertex(v, v.x + dx, v.y + dy, disableSnap, false))\n\t}\n\n\tinsertEdgeVertex(edge: Edge, p: Point, pos: number, isLabel: boolean) {\n\t\tthis._undo.beforeChange()\n\t\tconst v = edge.initVertex(p)\n\t\tv.selected = true\n\t\tif (isLabel) { // when shift down, make it label position\n\t\t\tedge.vertices.forEach(v => v.label = false)\n\t\t\tv.label = true\n\t\t}\n\t\tedge.vertices.splice(pos - 1, 0, v)\n\t\tthis.redrawEdge(edge)\n\t\tthis._undo.change()\n\t}\n\n\tdeleteEdgeVertex(v: EdgeVertex) {\n\t\tthis._undo.beforeChange()\n\t\t\n\t\tconst index = v.edge.vertices.indexOf(v)\n\t\tif (index >= 0) {\n\t\t\tv.edge.vertices.splice(index, 1)\n\t\t\tthis.edgeVertices.delete(v.id)\n\t\t\t\n\t\t\t// Mark that user explicitly deleted vertices from this edge\n\t\t\tv.edge.userDeletedVertices = true\n\t\t}\n\t\t\n\t\tthis.redrawEdge(v.edge)\n\t\tthis._undo.change()\n\t}\n\n\tchanged() {\n\t\treturn this._undo.changed()\n\t}\n\n\tundo() {\n\t\tthis._undo.undo()\n\t}\n\n\tredo() {\n\t\tthis._undo.redo()\n\t}\n\n\t// moves the entire graph to be aligned top-left of the drawing area\n\t// used to bring back to visible the nodes that end up at negative coordinates\n\talignTopLeft() {\n\t\tconst contentBounds = this.calculateContentBounds()\n\t\tconst padding = 100 // Reasonable padding for viewport\n\t\t\n\t\tconst offsetX = -contentBounds.x + padding\n\t\tconst offsetY = -contentBounds.y + padding\n\t\t\n\t\t// Set flag to prevent React useEffect from calling fitToView during this operation\n\t\tthis._skipAutoFit = true\n\t\t\n\t\tthis._undo.beforeChange()\n\t\t\n\t\tthis.nodesMap.forEach(node => {\n\t\t\tthis.moveNode(node, node.x + offsetX, node.y + offsetY, true, true) // Disable snap and undo during reset\n\t\t})\n\t\t\n\t\tthis.edgeVertices.forEach(vertex => {\n\t\t\tthis.moveEdgeVertex(vertex, vertex.x + offsetX, vertex.y + offsetY, true, true) // Disable snap and undo during reset\n\t\t})\n\t\t\n\t\tthis._undo.change()\n\t\t\n\t\t// DON'T clear view state here - let resetPanTransform handle it to avoid React useEffect recursion\n\t}\n\t\n\t// Reset pan transform to (0,0) while preserving zoom\n\tresetPanTransform() {\n\t\tconst currentZoom = getZoom()\n\t\tconst zoomGroup = svg.querySelector('g.zoom') as SVGGElement\n\t\tif (zoomGroup) {\n\t\t\tzoomGroup.setAttribute('transform', `scale(${currentZoom}) translate(0, 0)`)\n\t\t\tupdatePanningOptimized(this)\n\t\t}\n\t\t\n\t\t// Clear view state so this reset is not overridden\n\t\tclearViewState(this.id)\n\t\t\n\t\t// Reset the skip auto fit flag after reset is complete\n\t\tthis._skipAutoFit = false\n\t}\n\t\n\t// Check if auto-fit should be skipped (used by React useEffect)\n\tshouldSkipAutoFit(): boolean {\n\t\treturn this._skipAutoFit\n\t}\n\n\t// Reset view to default state: 100% zoom, centered at origin\n\tresetView() {\n\t\tconst zoomGroup = svg.querySelector('g.zoom') as SVGGElement\n\t\tif (zoomGroup) {\n\t\t\t// Reset to 100% zoom, centered at origin\n\t\t\tzoomGroup.setAttribute('transform', 'scale(1) translate(0, 0)')\n\t\t\tupdatePanning()\n\t\t}\n\t\t\n\t\t// Clear any saved view state so this reset position is not overridden\n\t\tclearViewState(this.id)\n\t}\n\n\t//redraw connected edges\n\tprivate redrawEdges(n: Node) {\n\t\tthis.edges.forEach(e => (n == e.from || n == e.to) && this.redrawEdge(e))\n\t\tthis.updateEdgesSel()\n\t}\n\n\tredrawEdge(e: Edge) {\n\t\tconst p = e.ref.parentElement;\n\t\tp.removeChild(e.ref)\n\t\te.ref = buildEdge(this, e)\n\t\tp.append(e.ref)\n\t}\n\n\tprivate redrawGroups(node: Node) {\n\t\tthis.groupsMap.forEach(group => {\n\t\t\t//if (group.nodes.indexOf(node) == -1) return\n\t\t\tconst p = group.ref.parentElement\n\t\t\tp.removeChild(group.ref)\n\t\t\tbuildGroup(group)\n\t\t\tp.append(group.ref)\n\t\t})\n\t}\n\n\texportSVG() {\n\t\t// Get the original SVG\n\t\tconst originalSvg: SVGSVGElement = document.querySelector('svg#graph')\n\t\tconst elastic = originalSvg.querySelector('rect.elastic')\n\t\t\n\t\t// Clone the SVG for export (completely separate from the live one)\n\t\tconst exportSvg = originalSvg.cloneNode(true) as SVGSVGElement\n\t\t\n\t\t// Remove elastic element from export\n\t\tconst exportElastic = exportSvg.querySelector('rect.elastic')\n\t\tif (exportElastic) {\n\t\t\texportElastic.remove()\n\t\t}\n\t\t\n\t\t// Calculate actual content bounds including all elements\n\t\tconst contentBounds = this.calculateContentBounds()\n\t\t\n\t\t// Add padding around content\n\t\tconst padding = 50\n\t\t\n\t\t// Calculate final export dimensions (always positive)\n\t\tconst exportWidth = contentBounds.width + (padding * 2)\n\t\tconst exportHeight = contentBounds.height + (padding * 2)\n\t\t\n\t\t// Calculate offset to move content to start at (padding, padding) within the export area\n\t\tconst offsetX = -contentBounds.x + padding\n\t\tconst offsetY = -contentBounds.y + padding\n\t\t\n\t\t// Apply export positioning to the cloned SVG elements\n\t\tconst exportZoomGroup = exportSvg.querySelector('g.zoom') as SVGGElement\n\t\tif (exportZoomGroup) {\n\t\t\t// Reset zoom to 1 and apply offset transform to position content properly\n\t\t\texportZoomGroup.setAttribute('transform', `scale(1) translate(${offsetX}, ${offsetY})`)\n\t\t}\n\t\t\n\t\t// Set proper viewBox and dimensions for export - viewBox always starts at (0,0)\n\t\texportSvg.setAttribute('viewBox', `0 0 ${exportWidth} ${exportHeight}`)\n\t\texportSvg.setAttribute('width', String(exportWidth))\n\t\texportSvg.setAttribute('height', String(exportHeight))\n\t\t\n\t\t// Add required SVG namespace for browser compatibility\n\t\texportSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg')\n\t\t\n\t\t// Convert inline styles to CSS custom properties for theming support\n\t\tthis.convertStylesToCustomProperties(exportSvg)\n\t\t\n\t\t// Inject metadata with current layout\n\t\tconst script = document.createElement('script')\n\t\tscript.setAttribute('type', 'application/json')\n\t\tthis.metadata.layout = this.exportLayout()\n\t\tscript.append('<![CDATA[' + escapeCdata(JSON.stringify(this.metadata, null, 2)) + ']]>')\n\t\texportSvg.insertBefore(script, exportSvg.firstChild)\n\t\t\n\t\t// Get the export SVG as string\n\t\tconst src = exportSvg.outerHTML\n\t\t\n\t\t// No restoration needed since we never touched the original SVG!\n\t\treturn src\n\t}\n\n\t// Convert inline fill/stroke attributes to CSS custom properties with fallbacks.\n\t// This enables theming: container pages can override colors via CSS variables.\n\tprivate convertStylesToCustomProperties(svg: SVGSVGElement) {\n\t\tif (this.colorToVarMap.size === 0) return\n\n\t\t// Process all elements with fill attribute\n\t\tsvg.querySelectorAll('[fill]').forEach(el => {\n\t\t\tconst fill = el.getAttribute('fill')\n\t\t\tif (fill && this.colorToVarMap.has(fill)) {\n\t\t\t\tel.setAttribute('fill', `var(${this.colorToVarMap.get(fill)}, ${fill})`)\n\t\t\t}\n\t\t})\n\n\t\t// Process all elements with stroke attribute\n\t\tsvg.querySelectorAll('[stroke]').forEach(el => {\n\t\t\tconst stroke = el.getAttribute('stroke')\n\t\t\tif (stroke && this.colorToVarMap.has(stroke)) {\n\t\t\t\tel.setAttribute('stroke', `var(${this.colorToVarMap.get(stroke)}, ${stroke})`)\n\t\t\t}\n\t\t})\n\t}\n\n\t// Calculate the actual bounds of all content including nodes, edges, and groups\n\tcalculateContentBounds(): BBox {\n\t\tlet minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity\n\t\t\n\t\t// Process nodes (including their actual dimensions)\n\t\tthis.nodes().forEach(node => {\n\t\t\tconst left = node.x - node.width / 2\n\t\t\tconst right = node.x + node.width / 2\n\t\t\tconst top = node.y - node.height / 2\n\t\t\tconst bottom = node.y + node.height / 2\n\t\t\t\n\t\t\tminX = Math.min(minX, left)\n\t\t\tmaxX = Math.max(maxX, right)\n\t\t\tminY = Math.min(minY, top)\n\t\t\tmaxY = Math.max(maxY, bottom)\n\t\t})\n\t\t\n\t\t// Process edge vertices (much faster than complex label calculations)\n\t\tthis.edgeVertices.forEach(vertex => {\n\t\t\tminX = Math.min(minX, vertex.x - 5)\n\t\t\tmaxX = Math.max(maxX, vertex.x + 5)\n\t\t\tminY = Math.min(minY, vertex.y - 5)\n\t\t\tmaxY = Math.max(maxY, vertex.y + 5)\n\t\t})\n\t\t\n\t\t// Process groups\n\t\tthis.groupsMap.forEach(group => {\n\t\t\tconst left = group.x - group.width / 2\n\t\t\tconst right = group.x + group.width / 2\n\t\t\tconst top = group.y - group.height / 2\n\t\t\tconst bottom = group.y + group.height / 2\n\t\t\t\n\t\t\tminX = Math.min(minX, left)\n\t\t\tmaxX = Math.max(maxX, right)\n\t\t\tminY = Math.min(minY, top)\n\t\t\tmaxY = Math.max(maxY, bottom)\n\t\t})\n\t\t\n\t\t// Process edges (simplified - just endpoints and vertices, skip complex label calculations)\n\t\tthis.edges.forEach(edge => {\n\t\t\t// Edge endpoints\n\t\t\tminX = Math.min(minX, edge.from.x - 10, edge.to.x - 10)\n\t\t\tmaxX = Math.max(maxX, edge.from.x + 10, edge.to.x + 10)\n\t\t\tminY = Math.min(minY, edge.from.y - 10, edge.to.y - 10)\n\t\t\tmaxY = Math.max(maxY, edge.from.y + 10, edge.to.y + 10)\n\t\t\t\n\t\t\t// Edge vertices (if any)\n\t\t\tif (edge.vertices) {\n\t\t\t\tedge.vertices.forEach(vertex => {\n\t\t\t\t\tminX = Math.min(minX, vertex.x - 10)\n\t\t\t\t\tmaxX = Math.max(maxX, vertex.x + 10)\n\t\t\t\t\tminY = Math.min(minY, vertex.y - 10)\n\t\t\t\t\tmaxY = Math.max(maxY, vertex.y + 10)\n\t\t\t\t})\n\t\t\t}\n\t\t\t\n\t\t\t// Simplified label bounds (avoid expensive path calculations)\n\t\t\tif (edge.label && edge.label.trim()) {\n\t\t\t\t// Just use approximate center between from and to nodes\n\t\t\t\tconst centerX = (edge.from.x + edge.to.x) / 2\n\t\t\t\tconst centerY = (edge.from.y + edge.to.y) / 2\n\t\t\t\tconst approxLabelSize = edge.label.length * 10 + 50 // Rough estimate\n\t\t\t\t\n\t\t\t\tminX = Math.min(minX, centerX - approxLabelSize)\n\t\t\t\tmaxX = Math.max(maxX, centerX + approxLabelSize)\n\t\t\t\tminY = Math.min(minY, centerY - 25)\n\t\t\t\tmaxY = Math.max(maxY, centerY + 25)\n\t\t\t}\n\t\t})\n\t\t\n\t\t// Handle empty graph\n\t\tif (minX === Infinity) {\n\t\t\treturn { x: 0, y: 0, width: 100, height: 100 }\n\t\t}\n\t\t\n\t\treturn {\n\t\t\tx: minX,\n\t\t\ty: minY,\n\t\t\twidth: maxX - minX,\n\t\t\theight: maxY - minY\n\t\t}\n\t}\n\n\n\n\t/**\n\t * @param full when true, the edges without vertices are saved too, used for undo buffer\n\t *        for saving, full is false\n\t */\n\texportLayout(full = false) {\n\t\tconst ret: Layout = {}\n\t\tthis.nodes().forEach(n => ret[n.id] = {x: n.x, y: n.y})\n\t\tthis.edges.forEach(e => {\n\t\t\tif (!e.vertices) return\n\t\t\t// Save all vertices (both user and auto-generated), preserving their properties\n\t\t\tconst lst = e.vertices.map(v => ({\n\t\t\t\tx: v.x, \n\t\t\t\ty: v.y, \n\t\t\t\tlabel: v.label,\n\t\t\t\tauto: v.auto // Preserve auto flag so we know which are ELK-generated\n\t\t\t}));\n\t\t\tif (lst.length || full) {\n\t\t\t\tret[`e-${e.id}`] = lst\n\t\t\t}\n\t\t\t// Also save the userDeletedVertices flag as metadata\n\t\t\tif (e.userDeletedVertices) {\n\t\t\t\tret[`e-${e.id}-deleted`] = true\n\t\t\t}\n\t\t})\n\t\treturn ret\n\t}\n\n\tsetSaved() {\n\t\tthis._undo.setSaved()\n\t}\n\n\timportLayout(layout: { [key: string]: any }, rerender = false) {\n\t\t// First pass: collect all coordinate values to find bounds\n\t\tconst coordinates: Array<{x: number, y: number}> = [];\n\t\t\n\t\tObject.entries(layout).forEach(([k, v]) => {\n\t\t\tif (!k.startsWith('e-') && v.x !== undefined && v.y !== undefined) {\n\t\t\t\t// Node coordinates\n\t\t\t\tcoordinates.push({x: v.x, y: v.y});\n\t\t\t} else if (k.startsWith('e-') && Array.isArray(v)) {\n\t\t\t\t// Edge vertex coordinates\n\t\t\t\tv.forEach((vertex: any) => {\n\t\t\t\t\tif (vertex.x !== undefined && vertex.y !== undefined) {\n\t\t\t\t\t\tcoordinates.push({x: vertex.x, y: vertex.y});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Calculate normalization offset if we have coordinates\n\t\tlet offsetX = 0;\n\t\tlet offsetY = 0;\n\t\t\n\t\tif (coordinates.length > 0) {\n\t\t\tconst minX = Math.min(...coordinates.map(c => c.x));\n\t\t\tconst minY = Math.min(...coordinates.map(c => c.y));\n\t\t\t\n\t\t\t// Only normalize if coordinates are problematic (negative or very large)\n\t\t\tif (minX < -100 || minY < -100 || Math.max(...coordinates.map(c => c.x)) > 3000 || Math.max(...coordinates.map(c => c.y)) > 2000) {\n\t\t\t\tconst padding = 50;\n\t\t\t\toffsetX = -minX + padding;\n\t\t\t\toffsetY = -minY + padding;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Second pass: apply coordinates with normalization\n\t\tObject.entries(layout).forEach(([k, v]) => {\n\t\t\t// nodes\n\t\t\tconst n = this.nodesMap.get(k)\n\t\t\tif (n) {\n\t\t\t\tn.x = v.x + offsetX\n\t\t\t\tn.y = v.y + offsetY\n\t\t\t} else\n\t\t\t\t// edge vertices\n\t\t\tif (k.startsWith('e-') && !k.endsWith('-deleted')) {\n\t\t\t\tconst edge = this.edges.find(e => e.id == k.slice(2))\n\t\t\t\tif (!edge) return;\n\t\t\t\tedge.vertices && edge.vertices.forEach(v => this.edgeVertices.delete(v.id))\n\t\t\t\tedge.vertices = v.map((p: Point) => {\n\t\t\t\t\tconst normalizedPoint = { \n\t\t\t\t\t\tx: p.x + offsetX, \n\t\t\t\t\t\ty: p.y + offsetY \n\t\t\t\t\t} as Point;\n\t\t\t\t\t// Preserve any additional properties like 'label' and 'auto'\n\t\t\t\t\tObject.assign(normalizedPoint, p, { x: p.x + offsetX, y: p.y + offsetY });\n\t\t\t\t\tconst vertex = edge.initVertex(normalizedPoint);\n\t\t\t\t\t// Ensure auto flag is preserved after initVertex\n\t\t\t\t\tif ((p as any).auto) {\n\t\t\t\t\t\tvertex.auto = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn vertex;\n\t\t\t\t})\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (k.endsWith('-deleted')) {\n\t\t\t\tconst edgeId = k.slice(2, -8); // Remove 'e-' prefix and '-deleted' suffix\n\t\t\t\tconst edge = this.edges.find(e => e.id == edgeId)\n\t\t\t\tif (edge && v === true) {\n\t\t\t\t\tedge.userDeletedVertices = true\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t})\n\t\tif (rerender) {\n\t\t\tthis.nodes().forEach(n => setPosition(n.ref, n.x, n.y))\n\t\t\tthis.edges.forEach(e => this.redrawEdge(e))\n\t\t\tthis.updateEdgesSel()\n\t\t\tthis.redrawGroups(null)\n\t\t}\n\t}\n\n\tasync autoLayout(options?: import('./layout').LayoutOptions) {\n\t\ttry {\n\t\t\tconst auto = await autoLayout(this, options)\n\t\t\t\n\t\t\tthis._undo.beforeChange()\n\t\t\t\n\t\t\t// Apply node positions\n\t\t\tauto.nodes.forEach(an => {\n\t\t\t\tconst n = this.nodesMap.get(an.id)\n\t\t\t\tif (n) {\n\t\t\t\t\tthis.moveNode(n, an.x, an.y, false, true) // Skip undo for individual moves\n\t\t\t\t}\n\t\t\t})\n\t\t\t\n\t\t\t// Apply edge routing from ELK layout\n\t\t\tauto.edges.forEach(ae => {\n\t\t\t\tconst edge = this.edges.find(e => e.id == ae.id)\n\t\t\t\tif (edge) {\n\t\t\t\t\t// Clear existing vertices for this edge only\n\t\t\t\t\tif (edge.vertices) {\n\t\t\t\t\t\tedge.vertices.forEach(v => {\n\t\t\t\t\t\t\tif (v.id) {\n\t\t\t\t\t\t\t\tthis.edgeVertices.delete(v.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tedge.vertices = []\n\t\t\t\t\tedge.userDeletedVertices = false\n\t\t\t\t\t\n\t\t\t\t\t// Add routing vertices from ELK (these are proper bend points, not nodes)\n\t\t\t\t\tif (ae.vertices && ae.vertices.length > 0) {\n\t\t\t\t\t\tedge.vertices = ae.vertices.map(p => {\n\t\t\t\t\t\t\tconst vertex = edge.initVertex(p)\n\t\t\t\t\t\t\tvertex.auto = true // Mark as auto-generated\n\t\t\t\t\t\t\treturn vertex\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Handle edge label positioning - create proper interactive label vertices\n\t\t\t\t\tif (ae.label) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Remove any existing label vertices (ELK or user-created)\n\t\t\t\t\t\tif (edge.vertices) {\n\t\t\t\t\t\t\tedge.vertices.forEach(v => {\n\t\t\t\t\t\t\t\tif (v.label) {\n\t\t\t\t\t\t\t\t\tthis.edgeVertices.delete(v.id)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tedge.vertices = edge.vertices.filter(v => !v.label)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Create a proper label vertex that behaves like a user-created vertex\n\t\t\t\t\t\tconst labelVertex = edge.initVertex(ae.label)\n\t\t\t\t\t\tlabelVertex.label = true\n\t\t\t\t\t\tlabelVertex.auto = true // Mark as auto-generated so it can be cleaned up\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Insert label vertex at the optimal position in the routing path\n\t\t\t\t\t\t// Find the best position to insert it and project it onto that line segment\n\t\t\t\t\t\tedge.vertices = edge.vertices || []\n\t\t\t\t\t\tconst insertPos = findOptimalLabelPosition(edge.vertices, ae.label, edge.from, edge.to)\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Project the label position onto the line segment where it will be inserted\n\t\t\t\t\t\tconst projectedPos = projectLabelOntoSegment(edge.vertices, ae.label, insertPos, edge.from, edge.to)\n\t\t\t\t\t\tlabelVertex.x = projectedPos.x\n\t\t\t\t\t\tlabelVertex.y = projectedPos.y\n\t\t\t\t\t\t\n\t\t\t\t\t\tedge.vertices.splice(insertPos, 0, labelVertex)\n\t\t\t\t\t\tthis.edgeVertices.set(labelVertex.id, labelVertex)\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Redraw the edge with new routing\n\t\t\t\t\tthis.redrawEdge(edge)\n\t\t\t\t}\n\t\t\t})\n\t\t\t\n\t\t\t// Fit the layout to the viewport with optimal positioning\n\t\t\tthis.fitToView()\n\t\t\t\n\t\t\tthis._undo.change()\n\t\t\t\n\t\t} catch (error) {\n\t\t\tconsole.error('Auto layout failed:', error)\n\t\t\t// Could show user notification here\n\t\t}\n\t}\n\n\talignSelectionV() {\n\t\tconst lst: Point[] = this.nodes().filter(n => n.selected)\n\t\tlst.push(...Array.from(this.edgeVertices.values()).filter(v => v.selected))\n\t\tlet minY = Math.min(...lst.map(p => p.y))\n\t\tthis.nodesMap.forEach(n => n.selected && this.moveNode(n, n.x, minY, false, false))\n\t\tthis.edgeVertices.forEach(v => v.selected && this.moveEdgeVertex(v, v.x, minY, false, false))\n\t}\n\n\talignSelectionH() {\n\t\tconst lst: Point[] = this.nodes().filter(n => n.selected)\n\t\tlst.push(...Array.from(this.edgeVertices.values()).filter(v => v.selected))\n\t\tlet minX = Math.min(...lst.map(p => p.x))\n\t\tthis.nodesMap.forEach(n => n.selected && this.moveNode(n, minX, n.y, false, false))\n\t\tthis.edgeVertices.forEach(v => v.selected && this.moveEdgeVertex(v, minX, v.y, false, false))\n\t}\n\n\tdistributeSelectionH() {\n\t\tconst selectedNodes = this.nodes().filter(n => n.selected)\n\t\tconst selectedVertices = Array.from(this.edgeVertices.values()).filter(v => v.selected)\n\t\t\n\t\tif (selectedNodes.length + selectedVertices.length < 3) return // Need at least 3 elements to distribute\n\t\t\n\t\tthis._undo.beforeChange()\n\t\t\n\t\t// Combine and sort by X coordinate\n\t\tconst allElements = [...selectedNodes, ...selectedVertices]\n\t\tallElements.sort((a, b) => a.x - b.x)\n\t\t\n\t\tconst minX = allElements[0].x\n\t\tconst maxX = allElements[allElements.length - 1].x\n\t\tconst spacing = (maxX - minX) / (allElements.length - 1)\n\t\t\n\t\t// Distribute elements evenly between leftmost and rightmost\n\t\tallElements.forEach((element, index) => {\n\t\t\tconst newX = minX + (index * spacing)\n\t\t\tif ('title' in element) {\n\t\t\t\t// It's a Node\n\t\t\t\tthis.moveNode(element as Node, newX, element.y, false, true)\n\t\t\t} else {\n\t\t\t\t// It's an EdgeVertex\n\t\t\t\tthis.moveEdgeVertex(element as EdgeVertex, newX, element.y, false, true)\n\t\t\t}\n\t\t})\n\t\t\n\t\tthis._undo.change()\n\t}\n\n\tdistributeSelectionV() {\n\t\tconst selectedNodes = this.nodes().filter(n => n.selected)\n\t\tconst selectedVertices = Array.from(this.edgeVertices.values()).filter(v => v.selected)\n\t\t\n\t\tif (selectedNodes.length + selectedVertices.length < 3) return // Need at least 3 elements to distribute\n\t\t\n\t\tthis._undo.beforeChange()\n\t\t\n\t\t// Combine and sort by Y coordinate\n\t\tconst allElements = [...selectedNodes, ...selectedVertices]\n\t\tallElements.sort((a, b) => a.y - b.y)\n\t\t\n\t\tconst minY = allElements[0].y\n\t\tconst maxY = allElements[allElements.length - 1].y\n\t\tconst spacing = (maxY - minY) / (allElements.length - 1)\n\t\t\n\t\t// Distribute elements evenly between topmost and bottommost\n\t\tallElements.forEach((element, index) => {\n\t\t\tconst newY = minY + (index * spacing)\n\t\t\tif ('title' in element) {\n\t\t\t\t// It's a Node\n\t\t\t\tthis.moveNode(element as Node, element.x, newY, false, true)\n\t\t\t} else {\n\t\t\t\t// It's an EdgeVertex\n\t\t\t\tthis.moveEdgeVertex(element as EdgeVertex, element.x, newY, false, true)\n\t\t\t}\n\t\t})\n\t\t\n\t\tthis._undo.change()\n\t}\n\n\t// Set edge selection state\n\tsetEdgeSelected(edge: Edge, selected: boolean) {\n\t\t// Mark the edge as selected by selecting its connected nodes\n\t\tif (selected) {\n\t\t\tthis.setNodeSelected(edge.from, true)\n\t\t\tthis.setNodeSelected(edge.to, true)\n\t\t}\n\t\t// Update visual selection\n\t\tthis.updateEdgesSel()\n\t}\n\n\t// Fit the entire graph to the current viewport\n\tfitToView() {\n\t\tconst contentBounds = this.calculateContentBounds()\n\t\t\n\t\t// Handle edge case where there's no content\n\t\tif (contentBounds.width === 0 || contentBounds.height === 0) {\n\t\t\treturn\n\t\t}\n\t\t\n\t\t// Get viewport dimensions\n\t\tconst viewportWidth = svg.parentElement?.clientWidth || 800\n\t\tconst viewportHeight = svg.parentElement?.clientHeight || 600\n\t\t\n\t\t// Add padding around content\n\t\tconst padding = 40\n\t\t\n\t\t// Calculate zoom to fit content with padding\n\t\tconst zoomX = (viewportWidth - padding * 2) / contentBounds.width\n\t\tconst zoomY = (viewportHeight - padding * 2) / contentBounds.height\n\t\tconst optimalZoom = Math.min(zoomX, zoomY)\n\t\t\n\t\t// Clamp zoom between reasonable bounds\n\t\tconst finalZoom = Math.max(Math.min(optimalZoom, 2), 0.1)\n\t\t\n\t\t// Calculate content center in drawing coordinates\n\t\tconst contentCenterX = contentBounds.x + contentBounds.width / 2\n\t\tconst contentCenterY = contentBounds.y + contentBounds.height / 2\n\t\t\n\t\t// Calculate viewport center in screen coordinates\n\t\tconst viewportCenterX = viewportWidth / 2\n\t\tconst viewportCenterY = viewportHeight / 2\n\t\t\n\t\t// Calculate translation needed to center content in viewport\n\t\t// With translate(x,y) scale(zoom), translation is in screen coordinates\n\t\tconst translateX = viewportCenterX - (contentCenterX * finalZoom)\n\t\tconst translateY = viewportCenterY - (contentCenterY * finalZoom)\n\t\t\n\t\t// Apply zoom and translation transform\n\t\tconst zoomGroup = svg.querySelector('g.zoom') as SVGGElement\n\t\tif (zoomGroup) {\n\t\t\tzoomGroup.setAttribute('transform', `translate(${translateX}, ${translateY}) scale(${finalZoom})`)\n\t\t}\n\t\t\n\t\t// Update panning\n\t\tupdatePanning()\n\t\t\n\t\t// Save view state so this fit position is preserved after reload\n\t\tsaveViewState(this.id)\n\t}\n\n\t// Save current layout state for restoration\n\tprivate saveLayoutState(): Layout {\n\t\treturn this.exportLayout(true) // Include all vertices for complete state\n\t}\n\n\t// Restore layout state\n\tprivate restoreLayoutState(state: Layout) {\n\t\tthis.importLayout(state, true) // Rerender after restoring\n\t}\n\n\t// Grid functionality\n\tisGridVisible(): boolean {\n\t\treturn this._gridVisible;\n\t}\n\n\tisSnapToGrid(): boolean {\n\t\treturn this._snapToGrid;\n\t}\n\n\tgetGridSize(): number {\n\t\treturn this._gridSize;\n\t}\n\n\ttoggleGrid() {\n\t\tthis._gridVisible = !this._gridVisible;\n\t\tthis.updateGridDisplay();\n\t\t// Force toolbar update by dispatching a custom event\n\t\twindow.dispatchEvent(new CustomEvent('gridStateChanged'));\n\t}\n\n\ttoggleSnapToGrid() {\n\t\tthis._snapToGrid = !this._snapToGrid;\n\t\t// Force toolbar update by dispatching a custom event\n\t\twindow.dispatchEvent(new CustomEvent('gridStateChanged'));\n\t}\n\n\tsnapAllToGrid() {\n\t\tif (!this._snapToGrid) return;\n\t\t\n\t\tthis._undo.beforeChange();\n\t\tthis.nodes().forEach(node => {\n\t\t\tconst snappedX = Math.round(node.x / this._gridSize) * this._gridSize;\n\t\t\tconst snappedY = Math.round(node.y / this._gridSize) * this._gridSize;\n\t\t\tthis.moveNode(node, snappedX, snappedY, false, true);\n\t\t});\n\t\tthis._undo.change();\n\t}\n\n\t// Helper method to snap a point to grid\n\tprivate snapToGrid(x: number, y: number): { x: number, y: number } {\n\t\treturn {\n\t\t\tx: Math.round(x / this._gridSize) * this._gridSize,\n\t\t\ty: Math.round(y / this._gridSize) * this._gridSize\n\t\t};\n\t}\n\n\tupdateGridDisplay() {\n\t\tif (!svg) return;\n\n\t\t// Remove existing grid pattern and background\n\t\tconst existingGrid = svg.querySelector('#grid-pattern');\n\t\tif (existingGrid) {\n\t\t\texistingGrid.remove();\n\t\t}\n\n\t\tconst existingGridRect = svg.querySelector('#grid-background');\n\t\tif (existingGridRect) {\n\t\t\texistingGridRect.remove();\n\t\t}\n\n\t\tif (!this._gridVisible) return;\n\n\t\t// Create grid pattern in defs\n\t\tlet defs = svg.querySelector('defs');\n\t\tif (!defs) {\n\t\t\tdefs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n\t\t\tsvg.insertBefore(defs, svg.firstChild);\n\t\t}\n\n\t\tconst pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');\n\t\tpattern.id = 'grid-pattern';\n\t\tpattern.setAttribute('width', this._gridSize.toString());\n\t\tpattern.setAttribute('height', this._gridSize.toString());\n\t\tpattern.setAttribute('patternUnits', 'userSpaceOnUse');\n\n\t\tconst path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\t\tpath.setAttribute('d', `M ${this._gridSize} 0 L 0 0 0 ${this._gridSize}`);\n\t\tpath.setAttribute('fill', 'none');\n\t\tpath.setAttribute('stroke', '#d0d0d0');\n\t\tpath.setAttribute('stroke-width', '1');\n\t\tpath.setAttribute('opacity', '0.8');\n\n\t\tpattern.appendChild(path);\n\t\tdefs.appendChild(pattern);\n\n\t\t// Create grid background rectangle\n\t\tconst rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\t\trect.id = 'grid-background';\n\t\trect.setAttribute('x', '-10000');\n\t\trect.setAttribute('y', '-10000');\n\t\trect.setAttribute('width', '20000');\n\t\trect.setAttribute('height', '20000');\n\t\trect.setAttribute('fill', 'url(#grid-pattern)');\n\t\trect.setAttribute('pointer-events', 'none');\n\n\t\t// Insert grid as first child of zoom group so it transforms with content\n\t\tconst zoomGroup = svg.querySelector('g.zoom');\n\t\tif (zoomGroup) {\n\t\t\tzoomGroup.insertBefore(rect, zoomGroup.firstChild);\n\t\t}\n\t}\n}\n\nfunction escapeCdata(code: string) {\n\treturn code.replace(/]]>/g, ']]]>]><![CDATA[')\n}\n\n\n\nlet svg: SVGSVGElement = document.querySelector('svg#graph')\nif (!svg) {\n\tsvg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\tsvg.setAttribute('id', 'graph')\n\tsvg.addEventListener('click', e => clickListener(e))\n\t// addCursorInteraction(svg) // Call will be updated in buildGraph\n}\nsvg.setAttribute('width', '100%')\nsvg.setAttribute('height', '100%')\n\nlet clickListener: (e: MouseEvent) => void\nlet dragging = false;\nlet selectListener: (n: Node) => void\n\n\nexport const buildGraph = (data: GraphData, onNodeSelect: (n: Node) => void, dragMode: 'pan' | 'select') => {\n\t// empty svg\n\tsvg.innerHTML = defs\n\tdocument.body.append(svg) // make sure svg element is connected, we will measure texts sizes\n\t// @ts-ignore\n\tsvg.__data = data\n\n\tselectListener = onNodeSelect\n\n\t//use event delegation\n\tclickListener = e => {\n\t\tif (dragging) {\n\t\t\treturn;\n\t\t}\n\t\t// const el = (e.target as any).closest('.node > .expand');\n\t}\n\n\t_buildGraph(data)\n\tconst elasticEl = create.rect(300, 300, 50, 50, 0, 'elastic')\n\tsvg.append(elasticEl)\n\n\t// Initialize grid display now that the zoom group exists\n\tdata.updateGridDisplay()\n\n\t// Call addCursorInteraction with dragMode\n\taddCursorInteraction(svg, dragMode)\n\n\treturn {\n\t\tsvg,\n\t\tsetZoom,\n\t}\n}\n\nexport const buildGraphView = (data: GraphData) => {\n\tsvg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\tsvg.setAttribute('id', 'graph')\n\t_buildGraph(data)\n\treturn svg\n}\n\nconst _buildGraph = (data: GraphData) => {\n\t//toplevel groups\n\tconst zoomG = create.element('g', {}, 'zoom') as SVGGElement\n\tconst nodesG = create.element('g', {}, 'nodes') as SVGGElement\n\tconst edgesG = create.element('g', {}, 'edges') as SVGGElement\n\tconst groupsG = create.element('g', {}, 'groups') as SVGGElement\n\tzoomG.append(groupsG, edgesG, nodesG)\n\n\n\tdata.nodesMap.forEach((n) => {\n\t\tbuildNode(n, data)\n\t\tnodesG.append(n.ref)\n\t})\n\n\tdata.edges.forEach(e => {\n\t\tbuildEdge(data, e)\n\t\tedgesG.append(e.ref)\n\t})\n\n\tdata.groupsMap.forEach((group) => {\n\t\tbuildGroup(group)\n\t\tgroupsG.append(group.ref)\n\t})\n\n\tsvg.append(zoomG)\n}\n\nfunction buildEdge(data: GraphData, edge: Edge) {\n\tconst n1 = edge.from, n2 = edge.to;\n\n\tconst g = create.element('g', {}, 'edge') as SVGGElement\n\tg.setAttribute('id', edge.id)\n\tg.setAttribute('data-from', edge.from.id)\n\tg.setAttribute('data-to', edge.to.id)\n\n\tconst position = (edge.style.position || 50) / 100\n\n\t// Calculate edge vertices using utility function\n\tconst vertices = calculateEdgeVertices(edge, data)\n\n\t// Calculate label position using utility function - pass edge for ELK label lookup\n\tconst pLabel = calculateLabelPosition(vertices, position, n1, edge)\n\n\tconst {bg, txt, bbox} = buildEdgeLabel(pLabel, edge)\n\tg.append(bg, txt)\n\n\t// Create edge segments and path using utility function\n\tconst {segments, path} = createEdgeSegments(vertices, bbox, n1, n2)\n\n\tconst p = create.path(path, {'marker-end': 'url(#arrow)'}, 'edge')\n\tp.setAttribute('fill', 'none')\n\tp.setAttribute('stroke', edge.style.color)\n\tp.setAttribute('stroke-width', String(edge.style.thickness))\n\tp.setAttribute('stroke-linecap', 'round')\n\tedge.style.dashed && p.setAttribute('stroke-dasharray', '8')\n\tg.append(p)\n\t\n\t// Debug visualization removed - arrow issue fixed\n\n\t// drag handlers\n\tedge.vertices = vertices.slice(1, -1).map(p => {\n\t\t// Preserve existing EdgeVertex objects to maintain IDs and selection state\n\t\tif ('id' in p && 'edge' in p) {\n\t\t\t// This is already an EdgeVertex, preserve it\n\t\t\tconst v = p as EdgeVertex;\n\t\t\tv.edge = edge; // Ensure edge reference is correct\n\t\t\treturn v;\n\t\t} else {\n\t\t\t// This is a new Point, convert to EdgeVertex\n\t\t\treturn edge.initVertex(p);\n\t\t}\n\t})\n\tedge.vertices.forEach((p, i) => {\n\t\tconst v = p as EdgeVertex\n\t\tv.ref = create.element('circle', {id: v.id, cx: p.x, cy: p.y, r: 7, fill: 'none'}, 'v-dot')\n\t\tv.selected && v.ref.classList.add('selected')\n\t\tv.auto && v.ref.classList.add('auto')\n\t\tg.append(v.ref)\n\t})\n\n\tedge.ref = g\n\treturn g\n}\n\nfunction buildEdgeLabel(pLabel: Point, edge: Edge) {\n\t// Offset label above the edge line\n\tconst labelOffset = 20; // pixels above the edge\n\tconst offsetY = pLabel.y - labelOffset;\n\t\n\t// label\n\tconst fontSize = edge.style.fontSize\n\tlet {txt, dy, maxW} = create.textArea(edge.label, 200, fontSize, false, pLabel.x, offsetY, 'middle')\n\t//move text up to center relative to the edge\n\tdy -= fontSize / 2\n\ttxt.setAttribute('y', String(offsetY - dy / 2))\n\n\tmaxW += fontSize\n\tapplyStyle(txt, styles.edgeText)\n\ttxt.setAttribute('stroke', 'none')\n\ttxt.setAttribute('font-size', String(edge.style.fontSize))\n\ttxt.setAttribute('fill', edge.style.color)\n\n\tconst bbox = {x: pLabel.x - maxW / 2, y: offsetY - dy / 2, width: maxW, height: dy}\n\tconst bg = create.rect(bbox.width, bbox.height, bbox.x, bbox.y)\n\tapplyStyle(bg, styles.edgeRect)\n\ttxt.setAttribute('data-field', 'label')\n\n\tbbox.x += bbox.width / 2\n\tbbox.y += bbox.height / 2\n\treturn {bg, txt, bbox}\n}\n\n\nfunction buildNode(n: Node, data: GraphData) {\n\t// @ts-ignore\n\twindow.gdata = data\n\n\t// Use the pre-calculated dimensions from addNode\n\tconst w = n.width;\n\tconst h = n.height;\n\n\tconst g = create.element('g', {}, 'node') as SVGGElement\n\tg.setAttribute('id', n.id)\n\tn.selected && g.classList.add('selected')\n\tsetPosition(g, n.x, n.y)\n\n\t// Ensure we use the correct shape from style, defaulting to Box\n\tconst shapeType = n.style.shape || 'Box';\n\tconst shapeFn = shapes[shapeType.toLowerCase()] || shapes.box\n\tconst shape: SVGElement = shapeFn(g, n);\n\n\tshape.classList.add('nodeBorder')\n\n\t// Apply generic styles first\n\tapplyStyle(shape, styles.nodeBorder)\n\t// Then apply tag-specific styles to override generic ones\n\tshape.setAttribute('fill', n.style.background)\n\tshape.setAttribute('stroke', n.style.stroke)\n\t// Consistent border width for all elements\n\tshape.setAttribute('stroke-width', '3')\n\tshape.setAttribute('opacity', String(n.style.opacity))\n\tsetBorderStyle(shape, n.style.border)\n\n\tconst tg = create.element('g') as SVGGElement\n\tlet cy = Number(g.getAttribute('label-offset-y')) || 0\n\t\n\t// Consistent text width calculation for all shapes\n\tconst textPadding = 12; // Standard padding\n\tconst maxTextWidth = Math.max(w - (textPadding * 2), 80); // Ensure reasonable minimum width\n\t\n\t{\n\t\tconst fontSize = n.style.fontSize\n\t\t// Use 95% of available width for titles - much more aggressive\n\t\tconst {txt, dy} = create.textArea(n.title, maxTextWidth * 0.95, fontSize, true, 0, cy, 'middle')\n\t\tapplyStyle(txt, styles.nodeText)\n\t\ttxt.setAttribute('fill', n.style.color)\n\t\ttxt.setAttribute('data-field', 'name')\n\n\t\ttg.append(txt)\n\t\tcy += dy + 6 // Reduced spacing after title\n\t}\n\t{\n\t\tconst txt = create.text(`[${n.sub}]`, {x: 0, y: cy, 'text-anchor': 'middle'})\n\t\tapplyStyle(txt, styles.nodeText)\n\t\ttxt.setAttribute('fill', n.style.color)\n\t\ttxt.setAttribute('font-size', String(0.75 * n.style.fontSize))\n\t\ttg.append(txt)\n\t\tcy += 12 // Reduced spacing\n\t}\n\t{\n\t\tcy += 6 // Reduced spacing before description\n\t\tconst fontSize = Math.min(n.style.fontSize * 0.8, 16) // Keep smaller description text\n\t\t// Use 95% of available width for descriptions too - much more aggressive\n\t\tconst {txt, dy} = create.textArea(n.description, maxTextWidth * 0.95, fontSize, false, 0, cy, 'middle')\n\t\tapplyStyle(txt, styles.nodeText)\n\t\ttxt.setAttribute('fill', n.style.color)\n\t\ttxt.setAttribute('data-field', 'description')\n\t\ttg.append(txt)\n\t\tcy += dy\n\t}\n\n\t// Better vertical centering with improved padding\n\tsetPosition(tg, 0, -cy / 2)\n\tg.append(tg)\n\n\t// @ts-ignore\n\tg.__data = n;\n\tn.ref = g;\n\n\treturn g\n}\n\n\nfunction buildGroup(group: Group) {\n\tif (group.nodes.length == 0) {\n\t\treturn\n\t}\n\tconst g = create.element('g', {}, 'group') as SVGGElement\n\n\tlet p0: Point = {x: 1e100, y: 1e100}, p1: Point = {x: 0, y: 0}\n\tgroup.nodes.forEach(n => {\n\t\t// Calculate visual bounds accounting for shapes that extend beyond center\n\t\tconst shape = (n as Node).style?.shape?.toLowerCase() || 'box'\n\t\t\n\t\tlet topExtension = n.height / 2\n\t\tlet bottomExtension = n.height / 2\n\t\t\n\t\tif (shape === 'robot') {\n\t\t\t// Robot shape extends above with antenna\n\t\t\t// Account for antenna height (h * 0.08) plus some margin\n\t\t\tconst antennaH = n.height * 0.12\n\t\t\ttopExtension = n.height / 2 + antennaH\n\t\t\tbottomExtension = n.height / 2\n\t\t} else if (shape === 'hexagon') {\n\t\t\t// Hexagon extends to 0.866 * (width/2) vertically\n\t\t\t// For width=280, that's 121.24px from center\n\t\t\tconst hexHeight = n.width / 2 * 0.866\n\t\t\ttopExtension = hexHeight\n\t\t\tbottomExtension = hexHeight\n\t\t}\n\t\t\n\t\tconst b = {\n\t\t\tx: n.x - n.width / 2,\n\t\t\ty: n.y - topExtension,\n\t\t\twidth: n.width,\n\t\t\theight: topExtension + bottomExtension\n\t\t}\n\t\tp0.x = Math.min(p0.x, b.x)\n\t\tp0.y = Math.min(p0.y, b.y)\n\t\tp1.x = Math.max(p1.x, b.x + b.width)\n\t\tp1.y = Math.max(p1.y, b.y + b.height)\n\t})\n\tconst pad = 25  // Padding around content\n\tconst labelHeight = 30  // Space for the group label at bottom\n\tconst w = Math.max(p1.x - p0.x, 200)\n\tconst h = p1.y - p0.y\n\tconst bb = {\n\t\tx: p0.x - pad,\n\t\ty: p0.y - pad,\n\t\twidth: w + pad * 2,\n\t\theight: h + pad * 2 + labelHeight,\n\t}\n\tconst r = create.rect(bb.width, bb.height, bb.x, bb.y)\n\tgroup.x = bb.x + bb.width / 2\n\tgroup.y = bb.y + bb.height / 2\n\tgroup.width = bb.width\n\tgroup.height = bb.height\n\tapplyStyle(r, styles.groupRect)\n\tgroup.style.stroke && r.setAttribute('stroke', group.style.stroke)\n\tgroup.style.background && r.setAttribute('fill', group.style.background)\n\n\tconst txt = create.text(group.name, {x: p0.x, y: bb.y + bb.height - styles.groupText[\"font-size\"]})\n\tapplyStyle(txt, styles.groupText)\n\tgroup.style.color && txt.setAttribute('fill', group.style.color)\n\n\tg.append(r, txt)\n\tgroup.ref = g\n}\n\nfunction findClosestSegment(graph: GraphData, p: Point) {\n\t// find the closest point on a segment\n\tlet fnd = {dst: Number.POSITIVE_INFINITY, pos: -1, edge: null as Edge, prj: null as Point}\n\tgraph.edges.forEach(edge => {\n\t\tconst vertices = edge.vertices || []\n\t\tconst pts = [edge.from, ...vertices, edge.to]\n\t\tfor (let i = 1; i < pts.length; i++) {\n\t\t\tconst prj = project(p, pts[i - 1], pts[i])\n\t\t\tconst dst = cabDistance(p, prj)\n\t\t\tif (dst > 50) continue\n\t\t\tif (dst < fnd.dst) {\n\t\t\t\tfnd = {dst, pos: i, prj, edge}\n\t\t\t}\n\t\t}\n\t})\n\treturn fnd.edge ? fnd : null\n}\n\nfunction mouseToDrawing(e: MouseEvent): Point {\n\t// transform event coords to drawing coords\n\tconst b = svg.getBoundingClientRect()\n\tconst z = getZoom()\n\t\n\t// Get current pan transform\n\tconst currentTransform = getCurrentTransform()\n\t\n\t// Convert screen coordinates to drawing coordinates accounting for zoom and pan\n\t// The transform values are in screen coordinates, so we need to divide by zoom and subtract\n\treturn {\n\t\tx: (e.clientX - b.x - currentTransform.x) / z,\n\t\ty: (e.clientY - b.y - currentTransform.y) / z\n\t}\n}\n\ninterface Handle extends Point {\n\tid: string\n\tselected?: boolean\n\tref?: SVGElement\n}\n\n// Custom cursor interaction that prioritizes panning over selection\nfunction addCustomCursorInteraction(svg: SVGSVGElement, conn: {\n\tnodeFromEvent(e: MouseEvent): Handle | null;\n\tsetSelection(handles: Handle[]): void;\n\tsetDragging(dragging: boolean): void;\n\tisSelected(handle: Handle): boolean;\n\tgetSelection(): Handle[];\n\tgetZoom(): number;\n\tmoveNode(h: Handle, x: number, y: number): void;\n\tboxSelection(box: DOMRect, add: boolean): void;\n\tupdatePanning(): void;\n}, dragMode: 'pan' | 'select') {\n\tlet ini: { x: number; y: number; n: Handle }[] = []\n\tlet elastic: any = null\n\tlet isPanning = false\n\tlet panStartX = 0\n\tlet panStartY = 0\n\tlet initialTransform = { x: 0, y: 0 }\n\tlet pendingSelectionChange: { node: Handle; shiftKey: boolean } | null = null\n\tlet hasDragged = false\n\t\n\t// Store event listeners for cleanup\n\tconst eventListeners: Array<{ element: Element | Window, event: string, handler: EventListener }> = []\n\n\t// Simple elastic selection box implementation - use mouseToDrawing for proper coordinate conversion\n\tfunction createElastic() {\n\t\tlet startDrawingX = 0, startDrawingY = 0, rect: SVGRectElement | null = null\n\t\t\n\t\treturn {\n\t\t\tini(e: MouseEvent) {\n\t\t\t\t// Use mouseToDrawing to get proper drawing coordinates (accounts for zoom and pan)\n\t\t\t\tconst pt = mouseToDrawing(e)\n\t\t\t\tstartDrawingX = pt.x\n\t\t\t\tstartDrawingY = pt.y\n\t\t\t\t\n\t\t\t\trect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n\t\t\t\trect.setAttribute('fill', 'rgba(0, 100, 255, 0.1)')\n\t\t\t\trect.setAttribute('stroke', 'rgba(0, 100, 255, 0.5)')\n\t\t\t\trect.setAttribute('stroke-width', '1')\n\t\t\t\trect.setAttribute('stroke-dasharray', '3,3')\n\t\t\t\trect.setAttribute('x', String(startDrawingX))\n\t\t\t\trect.setAttribute('y', String(startDrawingY))\n\t\t\t\trect.setAttribute('width', '0')\n\t\t\t\trect.setAttribute('height', '0')\n\t\t\t\t\n\t\t\t\t// Add to the zoom group so it transforms with the content\n\t\t\t\tconst zoomGroup = svg.querySelector('g.zoom')\n\t\t\t\tif (zoomGroup) {\n\t\t\t\t\tzoomGroup.appendChild(rect)\n\t\t\t\t} else {\n\t\t\t\t\tsvg.appendChild(rect)\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate(e: MouseEvent) {\n\t\t\t\tif (!rect) return\n\t\t\t\t\n\t\t\t\t// Convert current mouse position to drawing coordinates (accounts for zoom and pan)\n\t\t\t\tconst currentPt = mouseToDrawing(e)\n\t\t\t\tconst currentDrawingX = currentPt.x\n\t\t\t\tconst currentDrawingY = currentPt.y\n\t\t\t\t\n\t\t\t\t// Calculate rectangle bounds in drawing coordinates\n\t\t\t\tconst x = Math.min(startDrawingX, currentDrawingX)\n\t\t\t\tconst y = Math.min(startDrawingY, currentDrawingY)\n\t\t\t\tconst width = Math.abs(currentDrawingX - startDrawingX)\n\t\t\t\tconst height = Math.abs(currentDrawingY - startDrawingY)\n\t\t\t\t\n\t\t\t\trect.setAttribute('x', String(x))\n\t\t\t\trect.setAttribute('y', String(y))\n\t\t\t\trect.setAttribute('width', String(width))\n\t\t\t\trect.setAttribute('height', String(height))\n\t\t\t},\n\t\t\tend(): DOMRect | null {\n\t\t\t\tif (!rect) return null\n\t\t\t\t\n\t\t\t\t// Get final rectangle bounds in drawing coordinates\n\t\t\t\tconst x = parseFloat(rect.getAttribute('x') || '0')\n\t\t\t\tconst y = parseFloat(rect.getAttribute('y') || '0')\n\t\t\t\tconst width = parseFloat(rect.getAttribute('width') || '0')\n\t\t\t\tconst height = parseFloat(rect.getAttribute('height') || '0')\n\t\t\t\t\n\t\t\t\trect.remove()\n\t\t\t\trect = null\n\t\t\t\t\n\t\t\t\t// Return drawing coordinates directly for boxSelection since we're now working in the same coordinate system\n\t\t\t\tif (width > 5 && height > 5) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: x, y: y, width: width, height: height,\n\t\t\t\t\t\tleft: x, top: y, right: x + width, bottom: y + height\n\t\t\t\t\t} as DOMRect\n\t\t\t\t}\n\t\t\t\treturn null\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getCurrentTransformLocal() {\n\t\tconst zoomGroup = svg.querySelector('g.zoom') as SVGGElement\n\t\tif (!zoomGroup) return { x: 0, y: 0 }\n\t\t\n\t\tconst transform = zoomGroup.getAttribute('transform') || ''\n\t\tconst translateMatch = transform.match(/translate\\(([^,]+),([^)]+)\\)/)\n\t\tif (translateMatch) {\n\t\t\treturn {\n\t\t\t\tx: parseFloat(translateMatch[1]) || 0,\n\t\t\t\ty: parseFloat(translateMatch[2]) || 0\n\t\t\t}\n\t\t}\n\t\treturn { x: 0, y: 0 }\n\t}\n\n\tfunction setTransform(x: number, y: number) {\n\t\tconst zoomGroup = svg.querySelector('g.zoom') as SVGGElement\n\t\tif (!zoomGroup) return\n\t\t\n\t\tconst zoom = getZoom()\n\t\tzoomGroup.setAttribute('transform', `translate(${x}, ${y}) scale(${zoom})`)\n\t}\n\n\tfunction onMouseDown(e: MouseEvent) {\n\t\te.preventDefault();\n\t\thasDragged = false\n\t\tpendingSelectionChange = null\n\n\t\tconst node = conn.nodeFromEvent(e)\n\t\t\n\t\t// Determine effective mode: invert if shift is held\n\t\tconst effectiveMode = e.shiftKey ? (dragMode === 'pan' ? 'select' : 'pan') : dragMode\n\t\t\n\t\tif (!node) { // Clicked on empty space\n\t\t\tif (effectiveMode === 'pan') {\n\t\t\t\t// Pan mode: pan and deselect\n\t\t\t\tisPanning = true;\n\t\t\t\telastic = null;\n\t\t\t\tpanStartX = e.clientX;\n\t\t\t\tpanStartY = e.clientY;\n\t\t\t\tinitialTransform = getCurrentTransformLocal();\n\t\t\t\tini = [];\n\t\t\t\t// Deselect all elements when clicking empty space in pan mode\n\t\t\t\tconn.setSelection([]);\n\t\t\t} else {\n\t\t\t\t// Select mode: ONLY select, no panning\n\t\t\t\tisPanning = false;\n\t\t\t\telastic = createElastic();\n\t\t\t\tif (elastic) elastic.ini(e);\n\t\t\t\tini = [];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Clicked on a node/vertex - behavior depends on effective mode\n\t\tif (effectiveMode === 'pan') {\n\t\t\t// Pan mode: select the element, don't pan\n\t\t\tisPanning = false;\n\t\t\telastic = null;\n\t\t\t\n\t\t\tconst nodes = conn.getSelection()\n\t\t\tif (conn.isSelected(node)) {\n\t\t\t\t// Clicking on a selected node - prepare to drag all selected elements\n\t\t\t\tini = nodes.map(n => ({ x: n.x, y: n.y, n }))\n\t\t\t\t// No selection change needed since we're clicking on already selected element\n\t\t\t} else {\n\t\t\t\t// Clicking on an unselected node - select only this element\n\t\t\t\tconn.setSelection([node]);\n\t\t\t\tini = [{ x: node.x, y: node.y, n: node }];\n\t\t\t}\n\t\t} else {\n\t\t\t// Select mode: selection/drag logic\n\t\t\tisPanning = false; // Ensure no panning if a node is clicked\n\t\t\telastic = null; // Ensure no selection box if a node is clicked\n\t\t\tconst nodes = conn.getSelection()\n\t\t\t\n\t\t\tif (e.shiftKey && dragMode === 'select') {\n\t\t\t\t// Shift+click in select mode: immediately change selection (no dragging expected)\n\t\t\t\tif (conn.isSelected(node)) {\n\t\t\t\t\tconst index = nodes.findIndex(n => n.id === node.id)\n\t\t\t\t\tif (index >= 0) nodes.splice(index, 1)\n\t\t\t\t} else {\n\t\t\t\t\tnodes.push(node)\n\t\t\t\t}\n\t\t\t\tconn.setSelection(nodes)\n\t\t\t\tini = nodes.map(n => ({ x: n.x, y: n.y, n }))\n\t\t\t} else {\n\t\t\t\t// Regular click: defer selection change until we know if it's a drag or click\n\t\t\t\tif (conn.isSelected(node)) {\n\t\t\t\t\t// Clicking on a selected node - prepare to drag all selected elements\n\t\t\t\t\tini = nodes.map(n => ({ x: n.x, y: n.y, n }))\n\t\t\t\t\t// No pending selection change needed since we're clicking on already selected element\n\t\t\t\t\tpendingSelectionChange = null\n\t\t\t\t} else {\n\t\t\t\t\t// Clicking on an unselected node - defer selection change until we determine if it's a click or drag\n\t\t\t\t\tpendingSelectionChange = { node, shiftKey: e.shiftKey }\n\t\t\t\t\t// For now, prepare to drag just the clicked node (we'll update selection when drag starts)\n\t\t\t\t\tini = [{ x: node.x, y: node.y, n: node }]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction onMouseMove(e: MouseEvent, dx: number, dy: number) {\n\t\t// Check if we've moved enough to consider this a drag\n\t\tconst dragThreshold = 3 // pixels\n\t\tif (!hasDragged && (Math.abs(dx) > dragThreshold || Math.abs(dy) > dragThreshold)) {\n\t\t\thasDragged = true\n\t\t\t\n\t\t\t// If we have a pending selection change and we're now dragging, apply it\n\t\t\tif (pendingSelectionChange) {\n\t\t\t\tconst nodes = conn.getSelection()\n\t\t\t\tnodes.length = 0\n\t\t\t\tnodes.push(pendingSelectionChange.node)\n\t\t\t\tconn.setSelection(nodes)\n\t\t\t\t// Update ini to drag only the newly selected node\n\t\t\t\tini = [{ x: pendingSelectionChange.node.x, y: pendingSelectionChange.node.y, n: pendingSelectionChange.node }]\n\t\t\t\tpendingSelectionChange = null\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (isPanning) {\n\t\t\t// Pan the view - apply mouse delta directly (no zoom division needed)\n\t\t\t// setTransform expects screen coordinates, dx/dy are already screen pixel deltas\n\t\t\tconst newX = initialTransform.x + dx\n\t\t\tconst newY = initialTransform.y + dy\n\t\t\tsetTransform(newX, newY)\n\t\t} else if (ini.length > 0 && hasDragged) {\n\t\t\t// Move selected nodes/vertices (only if we've actually started dragging)\n\t\t\t// dx, dy are screen pixel deltas, convert to drawing coordinate deltas\n\t\t\tconst zoom = conn.getZoom()\n\t\t\tconst drawingDx = dx / zoom\n\t\t\tconst drawingDy = dy / zoom\n\t\t\tini.forEach(item => {\n\t\t\t\t// item.x, item.y are initial drawing coordinates\n\t\t\t\t// Add the drawing coordinate delta to get new position\n\t\t\t\tconn.moveNode(item.n, item.x + drawingDx, item.y + drawingDy)\n\t\t\t})\n\t\t\tconn.setDragging(true)\n\t\t} else if (elastic) {\n\t\t\t// Update selection box\n\t\t\telastic.update(e)\n\t\t\tconn.setDragging(true)\n\t\t}\n\t}\n\n\tfunction onMouseUp(e: MouseEvent) {\n\t\tconn.setDragging(false)\n\t\t\n\t\t// If we have a pending selection change and didn't drag, apply it now (it was just a click)\n\t\tif (pendingSelectionChange && !hasDragged) {\n\t\t\tconst nodes = conn.getSelection()\n\t\t\tnodes.length = 0\n\t\t\tnodes.push(pendingSelectionChange.node)\n\t\t\tconn.setSelection(nodes)\n\t\t}\n\t\t\n\t\tif (elastic) {\n\t\t\tconst box = elastic.end()\n\t\t\tif (box) {\n\t\t\t\tconn.boxSelection(box, e.shiftKey)\n\t\t\t} else if (!ini.length) {\n\t\t\t\t// Deselect if no box was drawn\n\t\t\t\tconn.setSelection([])\n\t\t\t}\n\t\t\telastic = null\n\t\t}\n\t\t\n\t\t// Save view state if user was panning (user-initiated view change)\n\t\tif (isPanning && hasDragged) {\n\t\t\tconst graphData = (svg as any).__data as GraphData\n\t\t\tif (graphData && graphData.id) {\n\t\t\t\tsaveViewState(graphData.id)\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Reset state\n\t\tpendingSelectionChange = null\n\t\thasDragged = false\n\t\tisPanning = false\n\t\tconn.updatePanning()\n\t}\n\n\t// Add drag and drop functionality\n\tfunction addDnd(element: SVGSVGElement) {\n\t\tlet md: { ex: number; ey: number } | null = null\n\n\t\tfunction convertEvent(e: MouseEvent | TouchEvent): MouseEvent {\n\t\t\tif ('changedTouches' in e && e.changedTouches) {\n\t\t\t\treturn e.changedTouches[0] as any\n\t\t\t}\n\t\t\treturn e as MouseEvent\n\t\t}\n\n\t\tfunction onMouseMoveHandler(e: MouseEvent | TouchEvent) {\n\t\t\tif (!md) return\n\t\t\te = convertEvent(e)\n\t\t\tonMouseMove(e, e.clientX - md.ex, e.clientY - md.ey)\n\t\t}\n\n\t\tfunction removeListeners() {\n\t\t\tdocument.removeEventListener('touchmove', onMouseMoveHandler as any)\n\t\t\tdocument.removeEventListener('mousemove', onMouseMoveHandler as any)\n\t\t\tdocument.removeEventListener('mouseup', onMouseUpHandler)\n\t\t\tdocument.removeEventListener('touchend', onMouseUpHandler)\n\t\t}\n\n\t\tfunction onMouseUpHandler(e: MouseEvent | TouchEvent) {\n\t\t\tremoveListeners()\n\t\t\tonMouseUp(convertEvent(e))\n\t\t\tmd = null\n\t\t}\n\n\t\tfunction onMouseDownHandler(e: MouseEvent | TouchEvent) {\n\t\t\te = convertEvent(e)\n\t\t\tmd = { ex: e.clientX, ey: e.clientY }\n\t\t\tonMouseDown(e)\n\t\t\tdocument.addEventListener('touchmove', onMouseMoveHandler as any)\n\t\t\tdocument.addEventListener('mousemove', onMouseMoveHandler as any)\n\t\t\tdocument.addEventListener('mouseup', onMouseUpHandler)\n\t\t\tdocument.addEventListener('touchend', onMouseUpHandler)\n\t\t}\n\n\t\telement.addEventListener('mousedown', onMouseDownHandler as any)\n\t\telement.addEventListener('touchstart', onMouseDownHandler as any)\n\t\t\n\t\t// Track these listeners for cleanup\n\t\teventListeners.push(\n\t\t\t{ element, event: 'mousedown', handler: onMouseDownHandler as any },\n\t\t\t{ element, event: 'touchstart', handler: onMouseDownHandler as any }\n\t\t)\n\t}\n\n\taddDnd(svg)\n\t\n\t// Return cleanup function\n\treturn () => {\n\t\teventListeners.forEach(({ element, event, handler }) => {\n\t\t\telement.removeEventListener(event, handler)\n\t\t})\n\t}\n}\n\nexport function addCursorInteraction(svg: SVGSVGElement, dragMode: 'pan' | 'select') {\n\t// Clean up any existing event listeners to prevent conflicts\n\tconst existingCleanup = (svg as any).__cursorInteractionCleanup\n\tif (existingCleanup) {\n\t\texistingCleanup()\n\t}\n\n\tfunction getData(el: SVGElement) {\n\t\t// @ts-ignore\n\t\treturn el.__data\n\t}\n\n\tconst gd = () => (getData(svg) as GraphData)\n\t\n\t// Store event listeners for cleanup\n\tconst eventListeners: Array<{ element: Element | Window, event: string, handler: EventListener }> = []\n\n\tconst beforeUnloadHandler = (e: BeforeUnloadEvent) => {\n\t\tif (!gd().changed()) return\n\t\te.preventDefault()\n\t\te.returnValue = ''\n\t}\n\twindow.addEventListener(\"beforeunload\", beforeUnloadHandler)\n\teventListeners.push({ element: window, event: 'beforeunload', handler: beforeUnloadHandler })\n\n\tfunction setDotSelected(d: Handle, selected: boolean) {\n\t\td.selected = selected\n\t\tconst dotEl = svg.querySelector('#' + d.id)\n\t\td.selected ? dotEl.classList.add('selected') : dotEl.classList.remove('selected')\n\t}\n\n\t// show moving dot along edge when ALT is pressed\n\tconst mouseMoveHandler = (e: MouseEvent) => {\n\t\tif (!e.altKey) return\n\t\tconst fnd = findClosestSegment(gd(), mouseToDrawing(e))\n\t\tif (fnd) {\n\t\t\tconst {prj} = fnd\n\t\t\tconst parent = svg.querySelector('g.edges')\n\t\t\tlet dot = parent.querySelector('#prj')\n\t\t\tif (!dot) {\n\t\t\t\tdot = create.element('circle', {id: 'prj', cx: prj.x, cy: prj.y, r: 7})\n\t\t\t\tparent.append(dot)\n\t\t\t}\n\t\t\tdot.setAttribute('cx', String(prj.x))\n\t\t\tdot.setAttribute('cy', String(prj.y))\n\t\t} else {\n\t\t\tremovePrjDot()\n\t\t}\n\t}\n\tsvg.addEventListener('mousemove', mouseMoveHandler)\n\teventListeners.push({ element: svg, event: 'mousemove', handler: mouseMoveHandler })\n\n\tconst keyUpHandler = (e: KeyboardEvent) => {\n\t\tconst key = findShortcut(e, true)\n\t\tif (key == ADD_VERTEX || key == ADD_LABEL_VERTEX) return\n\t\tremovePrjDot()\n\t}\n\twindow.addEventListener('keyup', keyUpHandler)\n\teventListeners.push({ element: window, event: 'keyup', handler: keyUpHandler })\n\n\tfunction removePrjDot() {\n\t\tconst el = svg.querySelector('g.edges #prj')\n\t\tel && el.parentElement.removeChild(el)\n\t}\n\n\tconst clickHandler = (e: MouseEvent) => {\n\t\tconst key = findShortcut(e, true)\n\t\tif (key != ADD_LABEL_VERTEX && key != ADD_VERTEX) return\n\t\tconst fnd = findClosestSegment(gd(), mouseToDrawing(e))\n\t\tif (fnd) {\n\t\t\tconst {edge, pos, prj} = fnd\n\t\t\t// depending on keyboard modifier, make it label position\n\t\t\tgd().insertEdgeVertex(edge, prj, pos, key == ADD_LABEL_VERTEX)\n\t\t\tremovePrjDot()\n\t\t}\n\t}\n\tsvg.addEventListener('click', clickHandler)\n\teventListeners.push({ element: svg, event: 'click', handler: clickHandler })\n\n\tconst wheelHandler = (e: WheelEvent) => {\n\t\t// Handle wheel zoom directly without relying on shortcuts\n\t\t// deltaY > 0 means scrolling down (zoom out), deltaY < 0 means scrolling up (zoom in)\n\t\tconst delta = Math.sign(e.deltaY) * 0.1 // Normalize to 0.1 zoom steps\n\t\tconst currentZoom = getZoom()\n\t\tconst newZoom = Math.max(0.1, Math.min(5, currentZoom - delta)) // Clamp zoom between 0.1 and 5\n\t\t\n\t\tif (newZoom !== currentZoom) {\n\t\t\t// Convert absolute screen coordinates to SVG-relative coordinates\n\t\t\tconst rect = svg.getBoundingClientRect()\n\t\t\tconst svgX = e.clientX - rect.left\n\t\t\tconst svgY = e.clientY - rect.top\n\t\t\tsetZoomCentered(newZoom, svgX, svgY)\n\t\t\te.preventDefault()\n\t\t\t\n\t\t\t// Save view state after user wheel zoom\n\t\t\tconst graphData = (svg as any).__data as GraphData\n\t\t\tif (graphData && graphData.id) {\n\t\t\t\tsaveViewState(graphData.id)\n\t\t\t}\n\t\t}\n\t}\n\tsvg.addEventListener('wheel', wheelHandler)\n\teventListeners.push({ element: svg, event: 'wheel', handler: wheelHandler })\n\n\tconst keyDownHandler = (e: KeyboardEvent) => {\n\t\tconst shortcut = findShortcut(e)\n\t\t\n\t\t\n\t\tif (shortcut) {\n\t\t\te.preventDefault() // Prevent browser default for all recognized shortcuts\n\t\t}\n\t\t\n\t\tswitch (shortcut) {\n\t\t\tcase DEL_VERTEX:\n\t\t\t\tconst selectedVertices = Array.from(gd().edgeVertices.values()).filter(v => v.selected);\n\t\t\t\tselectedVertices.forEach(v => {\n\t\t\t\t\tgd().deleteEdgeVertex(v)\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase UNDO:\n\t\t\t\tgd().undo()\n\t\t\t\tbreak\n\t\t\tcase REDO:\n\t\t\t\tgd().redo()\n\t\t\t\tbreak\n\t\t\tcase ZOOM_IN:\n\t\t\t\tconst newZoomIn = Math.min(5, getZoom() * 1.2)\n\t\t\t\t// Center zoom on viewport center like mouse wheel\n\t\t\t\tsetZoomCentered(newZoomIn)\n\t\t\t\tsaveViewState(gd().id) // Save after user keyboard zoom\n\t\t\t\tbreak\n\t\t\tcase ZOOM_OUT:\n\t\t\t\tconst newZoomOut = Math.max(0.1, getZoom() / 1.2)\n\t\t\t\t// Center zoom on viewport center like mouse wheel\n\t\t\t\tsetZoomCentered(newZoomOut)\n\t\t\t\tsaveViewState(gd().id) // Save after user keyboard zoom\n\t\t\t\tbreak\n\t\t\tcase ZOOM_100:\n\t\t\t\t// Center zoom on viewport center like mouse wheel\n\t\t\t\tsetZoomCentered(1)\n\t\t\t\tsaveViewState(gd().id) // Save after user keyboard zoom\n\t\t\t\tbreak\n\t\t\tcase ZOOM_FIT:\n\t\t\t\tgd().fitToView()\n\t\t\t\t// Don't save view state here - fitToView should not be persisted\n\t\t\t\tbreak\n\t\t\tcase SELECT_ALL:\n\t\t\t\tgd().nodes().forEach(n => gd().setNodeSelected(n, true))\n\t\t\t\tgd().edgeVertices.forEach(v => setDotSelected(v, true))\n\t\t\t\tbreak\n\t\t\tcase DESELECT:\n\t\t\t\tgd().nodes().forEach(n => gd().setNodeSelected(n, false))\n\t\t\t\tgd().edgeVertices.forEach(v => setDotSelected(v, false))\n\t\t\t\tbreak\n\t\t}\n\t}\n\twindow.addEventListener('keydown', keyDownHandler)\n\teventListeners.push({ element: window, event: 'keydown', handler: keyDownHandler })\n\n\t// Custom cursor interaction with pan-first behavior\n\tconst customInteractionCleanup = addCustomCursorInteraction(svg, {\n\t\tnodeFromEvent(e: MouseEvent): Handle {\n\t\t\te.preventDefault()\n\t\t\t// node clicked\n\t\t\tlet el = (e.target as SVGElement).closest('g.nodes g.node') as SVGElement\n\t\t\tif (el) return getData(el)\n\t\t\t// vertex dot clicked\n\t\t\tel = (e.target as SVGElement).closest('g.edges g.edge .v-dot') as SVGElement\n\t\t\tif (el) {\n\t\t\t\treturn gd().edgeVertices.get(el.id)\n\t\t\t}\n\t\t\treturn null\n\t\t},\n\t\tsetSelection(handles: Handle[]) {\n\t\t\t// nodes\n\t\t\tgd().nodes().forEach(n => gd().setNodeSelected(n, handles.some(h => h.id == n.id)))\n\t\t\t// dots\n\t\t\tgd().edgeVertices.forEach(d => setDotSelected(d, handles.some(h => h.id == d.id)))\n\t\t\tselectListener(gd().nodes().find(n => n.selected))\n\t\t},\n\t\tsetDragging(d: boolean) {\n\t\t\tdragging = d\n\t\t},\n\t\tisSelected(handle: Handle): boolean {\n\t\t\treturn handle.selected\n\t\t},\n\t\tgetSelection(): Handle[] {\n\t\t\tconst ret: Handle[] = gd().nodes().filter(n => n.selected)\n\t\t\tgd().edgeVertices.forEach(d => d.selected && ret.push(d))\n\t\t\treturn ret\n\t\t},\n\t\tgetZoom: getZoom,\n\t\tmoveNode(h: Handle, x: number, y: number) {\n\t\t\tif (gd().nodesMap.has(h.id))\n\t\t\t\tgd().moveNode(h as Node, x, y)\n\t\t\telse {\n\t\t\t\t(h as EdgeVertex).auto = false\n\t\t\t\tgd().moveEdgeVertex(h as EdgeVertex, x, y)\n\t\t\t}\n\t\t},\n\t\tboxSelection(box: DOMRect, add) {\n\t\t\t// Box is now already in drawing coordinates, no need to scale\n\t\t\t// nodes\n\t\t\tgd().nodesMap.forEach(n => {\n\t\t\t\tconst inBox = boxesOverlap(uncenterBox(n), box)\n\t\t\t\tif (inBox) {\n\t\t\t\t\t// Toggle selection for elements in the box\n\t\t\t\t\tgd().setNodeSelected(n, !n.selected)\n\t\t\t\t} else if (!add) {\n\t\t\t\t\t// If not holding shift and element is outside box, deselect it\n\t\t\t\t\tgd().setNodeSelected(n, false)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// dots\n\t\t\tgd().edgeVertices.forEach(d => {\n\t\t\t\tconst inBox = insideBox(d, box, false)\n\t\t\t\tif (inBox) {\n\t\t\t\t\t// Toggle selection for elements in the box\n\t\t\t\t\tsetDotSelected(d, !d.selected)\n\t\t\t\t} else if (!add) {\n\t\t\t\t\t// If not holding shift and element is outside box, deselect it\n\t\t\t\t\tsetDotSelected(d, false)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tselectListener(gd().nodes().find(n => n.selected))\n\t\t},\n\t\tupdatePanning: updatePanning,\n\t}, dragMode)\n\t\n\t// Store cleanup function on the SVG element for later use\n\tconst cleanup = () => {\n\t\teventListeners.forEach(({ element, event, handler }) => {\n\t\t\telement.removeEventListener(event, handler)\n\t\t})\n\t\tif (customInteractionCleanup) {\n\t\t\tcustomInteractionCleanup()\n\t\t}\n\t}\n\t\n\t// Store cleanup function on SVG element\n\t;(svg as any).__cursorInteractionCleanup = cleanup\n}\n\nexport function getZoom() {\n\tif (!svg) return 1\n\tconst el = svg.querySelector('g.zoom') as SVGGElement\n\tif (!el) return 1\n\t\n\t// Parse zoom from transform attribute to match how we set it\n\tconst transform = el.getAttribute('transform') || ''\n\tconst scaleMatch = transform.match(/scale\\(([^)]+)\\)/)\n\tif (scaleMatch) {\n\t\treturn parseFloat(scaleMatch[1]) || 1\n\t}\n\treturn 1\n}\n\n// svgPadding is now imported as SVG_PADDING from constants.ts\n\nexport function setZoom(zoom: number) {\n\tif (!svg) return\n\tconst el = svg.querySelector('g.zoom') as SVGGElement\n\tif (!el) return\n\t\n\t// Preserve existing translation when setting zoom\n\tconst currentTransform = getCurrentTransform()\n\tel.setAttribute('transform', `translate(${currentTransform.x}, ${currentTransform.y}) scale(${zoom})`)\n\t\n\t// also set panning size\n\tupdatePanning()\n}\n\nexport function setZoomCentered(newZoom: number, centerX?: number, centerY?: number) {\n\tconst el = svg.querySelector('g.zoom') as SVGGElement\n\tconst oldZoom = getZoom()\n\t\n\t// If no center point provided, use viewport center\n\tif (centerX === undefined || centerY === undefined) {\n\t\t// Use the parent container's dimensions for the visible viewport\n\t\t// The SVG might be larger than the visible area due to overflow\n\t\tconst container = svg.parentElement\n\t\tif (container) {\n\t\t\tcenterX = container.clientWidth / 2\n\t\t\tcenterY = container.clientHeight / 2\n\t\t} else {\n\t\t\t// Fallback to SVG dimensions if no parent\n\t\t\tcenterX = svg.clientWidth / 2\n\t\t\tcenterY = svg.clientHeight / 2\n\t\t}\n\t}\n\t\n\t// Get current transform\n\tconst currentTransform = getCurrentTransform()\n\t\n\t// Convert screen coordinates to drawing coordinates\n\t// For transform order translate(tx, ty) scale(s):\n\t// screen_point = (drawing_point * scale) + translation\n\t// So: drawing_point = (screen_point - translation) / scale\n\tconst drawingX = (centerX - currentTransform.x) / oldZoom\n\tconst drawingY = (centerY - currentTransform.y) / oldZoom\n\t\n\t// Calculate new translation to keep the same drawing point at the same screen position\n\t// screen_point = (drawing_point * new_scale) + new_translation\n\t// So: new_translation = screen_point - (drawing_point * new_scale)\n\tconst newTranslateX = centerX - (drawingX * newZoom)\n\tconst newTranslateY = centerY - (drawingY * newZoom)\n\t\n\t// Apply the new transform\n\tel.setAttribute('transform', `translate(${newTranslateX}, ${newTranslateY}) scale(${newZoom})`)\n\t\n\t// Update panning\n\tupdatePanning()\n}\n\nfunction getCurrentTransform() {\n\tif (!svg) return { x: 0, y: 0 }\n\tconst el = svg.querySelector('g.zoom') as SVGGElement\n\tif (!el) return { x: 0, y: 0 }\n\t\n\tconst transform = el.getAttribute('transform') || ''\n\tconst translateMatch = transform.match(/translate\\(([^,]+),([^)]+)\\)/)\n\tif (translateMatch) {\n\t\treturn {\n\t\t\tx: parseFloat(translateMatch[1]) || 0,\n\t\t\ty: parseFloat(translateMatch[2]) || 0\n\t\t}\n\t}\n\treturn { x: 0, y: 0 }\n}\n\nfunction updatePanning() {\n\tif (!svg) return\n\tconst el = svg.querySelector('g.zoom') as SVGGElement\n\tif (!el) return\n\tconst bb = el.getBBox()\n\tconst zoom = getZoom()\n\tif (!svg.parentElement) return\n\tconst w = Math.max(svg.parentElement.clientWidth / zoom, bb.x + bb.width + SVG_PADDING)\n\tconst h = Math.max(svg.parentElement.clientHeight / zoom, bb.y + bb.height + SVG_PADDING)\n\tsvg.setAttribute('width', String(w * zoom))\n\tsvg.setAttribute('height', String(h * zoom))\n\t\n\t// Note: View state saving removed from here to prevent interference with reset/fit functions\n\t// View state is now only saved on user interactions and page unload\n}\n\n// Optimized version that uses pre-calculated content bounds instead of expensive getBBox()\nfunction updatePanningOptimized(graphData: GraphData) {\n\tconst bb = graphData.calculateContentBounds() // Use already calculated bounds\n\tconst zoom = getZoom()\n\tconst w = Math.max(svg.parentElement.clientWidth / zoom, bb.x + bb.width + SVG_PADDING)\n\tconst h = Math.max(svg.parentElement.clientHeight / zoom, bb.y + bb.height + SVG_PADDING)\n\tsvg.setAttribute('width', String(w * zoom))\n\tsvg.setAttribute('height', String(h * zoom))\n}\n\nexport const getZoomAuto = () => {\n\t// Get the graph data to calculate proper content bounds\n\tconst graphData = (svg as any).__data as GraphData\n\tif (!graphData) {\n\t\treturn 1 // Default zoom if no graph data\n\t}\n\t\n\t// Use proper content bounds calculation\n\tconst contentBounds = graphData.calculateContentBounds()\n\tconst viewportWidth = svg.parentElement?.clientWidth || 800\n\tconst viewportHeight = svg.parentElement?.clientHeight || 600\n\t\n\t// Add padding around content\n\tconst padding = 40\n\t\n\t// Calculate zoom to fit content with padding\n\tconst zoomX = (viewportWidth - padding * 2) / contentBounds.width\n\tconst zoomY = (viewportHeight - padding * 2) / contentBounds.height\n\tconst zoom = Math.min(zoomX, zoomY)\n\t\n\t// Clamp zoom between reasonable bounds\n\treturn Math.max(Math.min(zoom, 2), 0.1)\n}\n\nconst setBorderStyle = (el: SVGElement, style: string) => {\n\tif (style == 'Dashed') el.setAttribute('stroke-dasharray', '4')\n\telse if (style == 'Dotted') el.setAttribute('stroke-dasharray', '2')\n}\n\nconst styles = {\n\t//node styles\n\tnodeBorder: {\n\t\t// Don't set fill and stroke here - let tag-specific styles handle colors\n\t\tfilter: 'url(#shadow)',\n\t},\n\tnodeText: {\n\t\t'font-family': 'Arial, sans-serif',\n\t\tstroke: \"none\"\n\t},\n\n\t//edge styles\n\tedgeText: {\n\t\t'font-family': 'Arial, sans-serif',\n\t\tstroke: \"none\"\n\t},\n\n\tedgeRect: {\n\t\tfill: \"none\",\n\t\tstroke: \"none\",\n\t},\n\n\t//group styles\n\tgroupRect: {\n\t\t//fill: \"none\",\n\t\tfill: \"rgba(0, 0, 0, 0.02)\",\n\t\tstroke: \"#666\",\n\t\t'stroke-width': 3,\n\t\t\"stroke-dasharray\": 4,\n\t},\n\tgroupText: {\n\t\t'font-family': 'Arial, sans-serif',\n\t\tfill: \"#666\",\n\t\t\"font-size\": 22,\n\t\t\"font-weight\": \"bold\",\n\t\tcursor: \"default\"\n\t}\n}\n\n// View state persistence - similar to undo cache but for zoom/pan\nconst viewStateCache = new Map<string, { zoom: number; transform: { x: number; y: number } }>();\n\n// Save current view state (zoom and pan)\nexport function saveViewState(graphId: string) {\n\tif (!svg) return;\n\t\n\tconst zoom = getZoom();\n\tconst transform = getCurrentTransform();\n\t\n\tconst state = {\n\t\tzoom,\n\t\ttransform: { x: transform.x, y: transform.y }\n\t};\n\t\n\tviewStateCache.set(graphId, state);\n}\n\n// Restore view state if it exists\nexport function restoreViewState(graphId: string): boolean {\n\tif (!svg || !viewStateCache.has(graphId)) {\n\t\treturn false;\n\t}\n\t\n\tconst state = viewStateCache.get(graphId);\n\tif (!state) {\n\t\treturn false;\n\t}\n\t\n\t// Restore zoom and transform\n\tconst zoomGroup = svg.querySelector('g.zoom') as SVGGElement;\n\tif (zoomGroup) {\n\t\tzoomGroup.setAttribute('transform', `scale(${state.zoom}) translate(${state.transform.x}, ${state.transform.y})`);\n\t\tupdatePanning();\n\t}\n\t\n\treturn true;\n}\n\n// Clear view state for a graph\nexport function clearViewState(graphId: string) {\n\tviewStateCache.delete(graphId);\n}\n\n/**\n * Find the optimal position to insert a label vertex into the routing path\n * to minimize disruption to the existing route\n */\nfunction findOptimalLabelPosition(vertices: Point[], labelPos: Point, fromNode: Point, toNode: Point): number {\n\t// If no existing vertices, insert at the beginning\n\tif (vertices.length === 0) {\n\t\treturn 0;\n\t}\n\t\n\t// Build the full routing path including start/end nodes\n\tconst fullPath = [fromNode, ...vertices, toNode];\n\t\n\t// Find the closest point on the path to the label position\n\tlet minDistance = Infinity;\n\tlet bestSegmentIndex = 0;\n\t\n\tfor (let i = 0; i < fullPath.length - 1; i++) {\n\t\tconst segmentStart = fullPath[i];\n\t\tconst segmentEnd = fullPath[i + 1];\n\t\t\n\t\t// Calculate distance from label position to this segment\n\t\tconst distance = distanceToSegment(labelPos, segmentStart, segmentEnd);\n\t\t\n\t\tif (distance < minDistance) {\n\t\t\tminDistance = distance;\n\t\t\tbestSegmentIndex = i;\n\t\t}\n\t}\n\t\n\t// Convert full path index to vertices array index\n\t// bestSegmentIndex 0 means between fromNode and vertices[0] -> insert at 0\n\t// bestSegmentIndex 1 means between vertices[0] and vertices[1] -> insert at 1\n\t// etc.\n\treturn bestSegmentIndex;\n}\n\n/**\n * Calculate distance from a point to a line segment\n */\nfunction distanceToSegment(point: Point, segmentStart: Point, segmentEnd: Point): number {\n\tconst A = point.x - segmentStart.x;\n\tconst B = point.y - segmentStart.y;\n\tconst C = segmentEnd.x - segmentStart.x;\n\tconst D = segmentEnd.y - segmentStart.y;\n\t\n\tconst dot = A * C + B * D;\n\tconst lenSq = C * C + D * D;\n\t\n\tif (lenSq === 0) {\n\t\t// Segment is actually a point\n\t\treturn Math.sqrt(A * A + B * B);\n\t}\n\t\n\tlet param = dot / lenSq;\n\t\n\tlet xx, yy;\n\t\n\tif (param < 0) {\n\t\txx = segmentStart.x;\n\t\tyy = segmentStart.y;\n\t} else if (param > 1) {\n\t\txx = segmentEnd.x;\n\t\tyy = segmentEnd.y;\n\t} else {\n\t\txx = segmentStart.x + param * C;\n\t\tyy = segmentStart.y + param * D;\n\t}\n\t\n\tconst dx = point.x - xx;\n\tconst dy = point.y - yy;\n\treturn Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Project a label position onto the line segment where it will be inserted\n */\nfunction projectLabelOntoSegment(vertices: Point[], labelPos: Point, insertPos: number, fromNode: Point, toNode: Point): Point {\n\t// Build the full routing path including start/end nodes\n\tconst fullPath = [fromNode, ...vertices, toNode];\n\t\n\t// The segment where we're inserting is between fullPath[insertPos] and fullPath[insertPos + 1]\n\tconst segmentStart = fullPath[insertPos];\n\tconst segmentEnd = fullPath[insertPos + 1];\n\t\n\t// Project the label position onto this line segment\n\treturn projectPointOntoSegment(labelPos, segmentStart, segmentEnd);\n}\n\n/**\n * Project a point onto a line segment (closest point on the segment)\n */\nfunction projectPointOntoSegment(point: Point, segmentStart: Point, segmentEnd: Point): Point {\n\tconst A = point.x - segmentStart.x;\n\tconst B = point.y - segmentStart.y;\n\tconst C = segmentEnd.x - segmentStart.x;\n\tconst D = segmentEnd.y - segmentStart.y;\n\t\n\tconst dot = A * C + B * D;\n\tconst lenSq = C * C + D * D;\n\t\n\tif (lenSq === 0) {\n\t\t// Segment is actually a point, return that point\n\t\treturn { x: segmentStart.x, y: segmentStart.y };\n\t}\n\t\n\tlet param = dot / lenSq;\n\t\n\t// Clamp to segment (don't extend beyond endpoints)\n\tparam = Math.max(0, Math.min(1, param));\n\t\n\treturn {\n\t\tx: segmentStart.x + param * C,\n\t\ty: segmentStart.y + param * D\n\t};\n}","export const defs = `\n<defs>\n\t<marker id=\"arrow\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" \n\t\tmarkerWidth=\"8\" markerHeight=\"8\" orient=\"auto\" markerUnits=\"strokeWidth\">\n\t\t<path fill=\"context-stroke\" stroke=\"none\" d=\"M0,0 L10,5 L0,10 Z\" class=\"arrowHead\"/>\n\t</marker>\n\t<g id=\"icon-circle\" transform=\"translate(0,-12)\" class=\"icon\">\n\t\t<circle cx=\"7\" cy=\"7\" r=\"7\"/>\n\t</g>\n\t<g id=\"icon-cube\" transform=\"translate(0, -14)\" class=\"icon\">\n\t\t<path d=\"M 5 0 h 10 v 10 l -5 5 h -10 v -10 l 5 -5 M 0 5 h 10 v 10 M 15 0 l -5 5\"/>\n\t</g>\n\t<filter id=\"shadow\">\n\t\t<feDropShadow dx=\"3\" dy=\"3\" stdDeviation=\"5\" flood-color=\"#00000030\" flood-opacity=\"1\"></feDropShadow>\n\t</filter>\n</defs>`\n","import { Point, BBox, calculateDistance } from './constants';\nimport { intersectPolylineBox, Segment } from './intersect';\n\n// Define interfaces locally since they're not exported from graph.ts\ninterface NodeStyle {\n\tbackground?: string;\n\tstroke?: string;\n\topacity?: number;\n\tfontSize?: number;\n\tshape?: string;\n\tborder?: string;\n}\n\ninterface Node extends Point {\n\tid: string;\n\ttitle: string;\n\tsub: string;\n\tdescription: string;\n\twidth: number;\n\theight: number;\n\tref?: SVGGElement;\n\tselected?: boolean;\n\tintersect: (p: Point) => Point;\n\tstyle: NodeStyle;\n}\n\ninterface EdgeVertex extends Point {\n\tid: string;\n\tselected?: boolean;\n\tref?: SVGElement;\n\tlabel?: boolean;\n\tauto?: boolean;\n}\n\ninterface EdgeStyle {\n\tcolor?: string;\n\tthickness?: number;\n\tfontSize?: number;\n\tposition?: number;\n\tdashed?: boolean;\n}\n\ninterface Edge {\n\tid: string;\n\tlabel: string;\n\tfrom: Node;\n\tto: Node;\n\tvertices?: EdgeVertex[];\n\tref?: SVGGElement;\n\tstyle: EdgeStyle;\n\tinitVertex: (p: Point) => EdgeVertex;\n\tuserDeletedVertices?: boolean; // Track if user explicitly deleted vertices\n}\n\ninterface GraphData {\n\tid: string;\n\tname: string;\n\tnodesMap: Map<string, Node>;\n\tedges: Edge[];\n\tedgeVertices: Map<string, EdgeVertex>;\n\tgroupsMap: Map<string, any>;\n\tmetadata: any;\n}\n\n/**\n * Calculate edge vertices, handling multi-edge scenarios and auto-vertices\n */\nexport function calculateEdgeVertices(edge: Edge, data: GraphData): Point[] {\n\tconst n1 = edge.from, n2 = edge.to;\n\t\n\t\n\t// if vertices exists, follow them\n\tlet vertices: Point[] = edge.vertices ? edge.vertices.concat() : [];\n\t// Don't remove label vertices - they should be preserved for rendering\n\t// (The autoLayout process handles replacing old ones with new ones)\n\tconst tmp = (vertices as EdgeVertex[]);\n\n\tif (vertices.length == 0 && !edge.userDeletedVertices) {\n\t\t// Only create auto vertices if user hasn't explicitly deleted them\n\t\t// for edges with same \"from\" and \"to\", we must spread the labels so they don't overlap\n\t\t// lookup the other \"same\" edges\n\t\tconst sameEdges = data.edges.filter(e => e.from == edge.from && e.to == edge.to)\n\t\tlet spreadPos = 0\n\t\tif (sameEdges.length > 1) {\n\t\t\tconst idx = sameEdges.indexOf(edge) // my index in the list of same edges\n\t\t\tspreadPos = idx - (sameEdges.length - 1) / 2\n\n\t\t\tlet spreadX = 0, spreadY = 0;\n\t\t\tif (Math.abs(n1.x - n2.x) > Math.abs(n1.y - n2.y)) {\n\t\t\t\tspreadY = spreadPos * 70\n\t\t\t} else {\n\t\t\t\tspreadX = spreadPos * 200\n\t\t\t}\n\t\t\tconst v = edge.initVertex({\n\t\t\t\tx: (n1.x + n2.x) / 2 + spreadX,\n\t\t\t\ty: (n1.y + n2.y) / 2 + spreadY\n\t\t\t})\n\t\t\tv.label = true\n\t\t\tv.auto = true\n\t\t\tvertices.push(v)\n\t\t} else {\n\t\t\t// If there are no user-defined vertices and not a multi-edge scenario,\n\t\t\t// we don't create any auto-vertices here. AutoLayout will provide them.\n\t\t\t// The path will be a straight line between n1 and n2 (after intersection points are calculated).\n\t\t\t// ELK/autoLayout is responsible for providing bend points for non-straight lines.\n\t\t}\n\t}\n\n\tvertices.unshift(n1)\n\tvertices.push(n2)\n\n\t// Calculate intersection points with node boundaries\n\t// Find first non-label vertex for start intersection\n\tlet firstRoutingVertex = vertices[vertices.length - 1]; // Default to end node\n\tfor (let i = 1; i < vertices.length - 1; i++) {\n\t\tif (!(vertices[i] as any).label) {\n\t\t\tfirstRoutingVertex = vertices[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\t// Find last non-label vertex for end intersection  \n\tlet lastRoutingVertex = vertices[0]; // Default to start node\n\tfor (let i = vertices.length - 2; i > 0; i--) {\n\t\tif (!(vertices[i] as any).label) {\n\t\t\tlastRoutingVertex = vertices[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\t// For connections without routing vertices, ensure we have proper direction\n\t// The defaults are already correct: firstRoutingVertex = n2, lastRoutingVertex = n1\n\t\n\t\n\t// Calculate proper node boundary intersection\n\tconst calculateNodeIntersection = (node: any, targetPoint: Point): Point => {\n\t\tconst nodeShape = node.style?.shape?.toLowerCase() || 'box';\n\t\tconst dx = targetPoint.x - node.x;\n\t\tconst dy = targetPoint.y - node.y;\n\t\tconst nodeCenter = { x: node.x, y: node.y };\n\t\t\n\t\t// If target is at center, default to right edge\n\t\tif (Math.abs(dx) < 0.01 && Math.abs(dy) < 0.01) {\n\t\t\treturn { x: node.x + node.width / 2, y: node.y };\n\t\t}\n\t\t\n\t\tif (nodeShape === 'cylinder') {\n\t\t\t// Cylinder shape intersection (same as shapes.ts)\n\t\t\tconst w = node.width;\n\t\t\tconst rx = w / 2;\n\t\t\tconst ry = rx / (5.5 + w / 70);\n\t\t\tconst halfHeight = node.height / 2;\n\t\t\t\n\t\t\t// First calculate rectangular bounds intersection\n\t\t\tconst angle = Math.atan2(dy, dx);\n\t\t\tconst cos = Math.cos(angle);\n\t\t\tconst sin = Math.sin(angle);\n\t\t\t\n\t\t\t// Check intersection with rectangular bounds\n\t\t\tlet t = Infinity;\n\t\t\tif (Math.abs(cos) > 0.01) {\n\t\t\t\tt = Math.min(t, Math.abs(rx / cos));\n\t\t\t}\n\t\t\tif (Math.abs(sin) > 0.01) {\n\t\t\t\tt = Math.min(t, Math.abs(halfHeight / sin));\n\t\t\t}\n\t\t\t\n\t\t\tconst rectX = node.x + cos * t;\n\t\t\tconst rectY = node.y + sin * t;\n\t\t\t\n\t\t\t// Check if we need elliptical intersection for top/bottom curves\n\t\t\tconst topCurveY = node.y - halfHeight + ry;\n\t\t\tconst bottomCurveY = node.y + halfHeight - ry;\n\t\t\t\n\t\t\tif (rectY < topCurveY || rectY > bottomCurveY) {\n\t\t\t\t// Use ellipse intersection for curved parts\n\t\t\t\tconst ellipseY = rectY < topCurveY ? node.y - halfHeight + ry : node.y + halfHeight - ry;\n\t\t\t\t// Solve for ellipse intersection\n\t\t\t\tconst a = 1 / (rx * rx);\n\t\t\t\tconst b = -2 * node.x / (rx * rx);\n\t\t\t\tconst c = (node.x * node.x) / (rx * rx) + ((ellipseY - node.y) * (ellipseY - node.y)) / (ry * ry) - 1;\n\t\t\t\t\n\t\t\t\tconst discriminant = b * b - 4 * a * c;\n\t\t\t\tif (discriminant >= 0) {\n\t\t\t\t\tconst sqrt_d = Math.sqrt(discriminant);\n\t\t\t\t\tconst x1 = (-b + sqrt_d) / (2 * a);\n\t\t\t\t\tconst x2 = (-b - sqrt_d) / (2 * a);\n\t\t\t\t\t\n\t\t\t\t\t// Choose the intersection in the direction of the target\n\t\t\t\t\tconst intersectX = dx > 0 ? Math.max(x1, x2) : Math.min(x1, x2);\n\t\t\t\t\treturn { x: intersectX, y: ellipseY };\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn { x: rectX, y: rectY };\n\t\t\t\n\t\t} else if (nodeShape === 'circle') {\n\t\t\tconst radius = node.width / 2;\n\t\t\tconst angle = Math.atan2(dy, dx);\n\t\t\treturn {\n\t\t\t\tx: node.x + Math.cos(angle) * radius,\n\t\t\t\ty: node.y + Math.sin(angle) * radius\n\t\t\t};\n\t\t\t\n\t\t} else if (nodeShape === 'ellipse') {\n\t\t\tconst rx = node.width * 0.55;\n\t\t\tconst ry = node.width * 0.45;\n\t\t\tconst angle = Math.atan2(dy, dx);\n\t\t\tconst cos = Math.cos(angle);\n\t\t\tconst sin = Math.sin(angle);\n\t\t\t\n\t\t\t// Parametric ellipse intersection\n\t\t\tconst t = Math.sqrt((rx * rx * sin * sin) + (ry * ry * cos * cos));\n\t\t\treturn {\n\t\t\t\tx: node.x + (rx * cos * ry) / t,\n\t\t\t\ty: node.y + (ry * sin * rx) / t\n\t\t\t};\n\t\t\t\n\t\t} else {\n\t\t\t// Default rectangular intersection\n\t\t\tconst halfWidth = node.width / 2;\n\t\t\tconst halfHeight = node.height / 2;\n\t\t\tconst angle = Math.atan2(dy, dx);\n\t\t\tconst cos = Math.cos(angle);\n\t\t\tconst sin = Math.sin(angle);\n\t\t\t\n\t\t\t// Calculate which edge we hit first\n\t\t\tlet t = Infinity;\n\t\t\tif (Math.abs(cos) > 0.01) {\n\t\t\t\tt = Math.min(t, Math.abs(halfWidth / cos));\n\t\t\t}\n\t\t\tif (Math.abs(sin) > 0.01) {\n\t\t\t\tt = Math.min(t, Math.abs(halfHeight / sin));\n\t\t\t}\n\t\t\t\n\t\t\treturn {\n\t\t\t\tx: node.x + cos * t,\n\t\t\t\ty: node.y + sin * t\n\t\t\t};\n\t\t}\n\t};\n\t\n\t// Calculate intersections, but use the direction from center to NEXT vertex in sequence\n\t// This ensures the line exits the node in the direction it needs to go\n\t\n\t// For start intersection: use direction from node center to first routing vertex\n\tlet startIntersection = calculateNodeIntersection(n1, firstRoutingVertex);\n\t\n\t// For end intersection: use direction from node center to last routing vertex  \n\tlet endIntersection = calculateNodeIntersection(n2, lastRoutingVertex);\n\t\n\t// Start intersection: NO offset needed - intersection already gives perfect boundary point\n\t// End intersection: NO offset needed - the arrow marker now has refX=\"0\" so the tip is at the endpoint\n\t\n\tvertices[0] = startIntersection;\n\tvertices[vertices.length - 1] = endIntersection;\n\t\n\treturn vertices;\n}\n\n/**\n * Calculate the position for edge label along the edge path\n */\nexport function calculateLabelPosition(vertices: Point[], position: number, fallback: Point, edge?: any): Point {\n\t// where along the edge is the label?\n\t// position of label\n\tlet pLabel: Point = vertices.find(v => (v as any).label)\n\tif (!pLabel) {\n\t\tlet sum = 0 // total length of the edge, sum of segments\n\t\tfor (let i = 1; i < vertices.length; i++) {\n\t\t\tsum += calculateDistance(vertices[i - 1], vertices[i])\n\t\t}\n\t\tpLabel = {x: fallback.x, y: fallback.y} // fallback for corner cases\n\t\tlet acc = 0\n\t\tfor (let i = 1; i < vertices.length; i++) {\n\t\t\tconst d = calculateDistance(vertices[i - 1], vertices[i])\n\t\t\tif (acc + d > sum * position) {\n\t\t\t\tconst pos = (sum * position - acc) / d\n\t\t\t\tpLabel = {\n\t\t\t\t\tx: vertices[i - 1].x + (vertices[i].x - vertices[i - 1].x) * pos,\n\t\t\t\t\ty: vertices[i - 1].y + (vertices[i].y - vertices[i - 1].y) * pos\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tacc += d\n\t\t}\n\t}\n\treturn pLabel;\n}\n\n/**\n * Create edge segments and generate SVG path\n */\nexport function createEdgeSegments(vertices: Point[], bbox: BBox, n1: Point, n2: Point): { segments: Segment[], path: string } {\n\tconst segments: Segment[] = []\n\tfor (let i = 1; i < vertices.length; i++) {\n\t\tsegments.push({p: vertices[i - 1], q: vertices[i]})\n\t}\n\t\n\t// Debug the final segment that will have the arrow\n\tif (segments.length > 0) {\n\t\tconst lastSegment = segments[segments.length - 1];\n\t}\n\t// splice edge over label box\n\tintersectPolylineBox(segments, bbox)\n\n\t// Generate path based on routing style - SIMPLIFIED\n\tlet path: string\n\t\n\t// Always draw a polyline through the segments.\n\t// If segments.length is 1 (meaning direct connection or only label vertex), it will be a straight line.\n\t// If autoLayout provided bend points, those will be in `segments`.\n\tif (segments.length > 0) {\n\t\tpath = `M${segments[0].p.x},${segments[0].p.y}`\n\t\tfor (let i = 0; i < segments.length; i++) {\n\t\t\tconst s = segments[i]\n\t\t\t// For polylines, we just draw line segments to each vertex point.\n\t\t\t// The ELK 'POLYLINE' routing should give us the necessary bend points.\n\t\t\tpath += ` L${s.q.x},${s.q.y}`\n\t\t}\n\t} else {\n\t\t// Fallback for edges with no segments (should ideally not happen if n1 and n2 are defined)\n\t\t// Draw a straight line between n1 and n2 directly if no vertices/segments exist.\n\t\t// Note: Intersection points are calculated before this, so n1/n2 are already adjusted.\n\t\tpath = `M${n1.x},${n1.y} L${n2.x},${n2.y}`\n\t}\n\t\n\treturn { segments, path };\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/.pnpm/css-loader@7.1.2_webpack@5.103.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/.pnpm/css-loader@7.1.2_webpack@5.103.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `html, body, #root {\n    height: 100%;\n}\n\nbody {\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    color: #666;\n    margin: 0;\n}\n\n#root {\n    display: flex;\n    flex-direction: column;\n}\n#root > div.graph {\n    flex: 1;\n    overflow: auto;\n    position: relative;\n}\n\n.toolbar {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 4px 10px;\n    background-color: #f0f0f0;\n    border-bottom: 1px solid #cccccc;\n}\n\n.toolbar > div {\n    display: flex;\n    align-items: center;\n}\n\n.toolbar button {\n    padding: 5px 8px;\n    margin: 0 2px;\n    cursor: pointer;\n}\n\n.toolbar button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n/* Drag mode toggle button styles */\n.toolbar button.mode-toggle {\n    position: relative;\n    border: 1px solid #8f9fc9;\n    width: 40px;\n    min-height: 28px;\n    background: linear-gradient(to bottom, #abb8db, #8f9fc9);\n    border-color: #8f9fc9;\n    color: white;\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, .2);\n}\n\n.toolbar button.mode-toggle:hover {\n    background: linear-gradient(to bottom, #bcc7e0, #abb8db);\n    border-color: #abb8db;\n}\n\n.toolbar button.mode-toggle.select-mode:active {\n    background: linear-gradient(to bottom, #8f9fc9, #7a8bb5);\n}\n\n/* Pan mode and active toggle - darker blue */\n.toolbar button.mode-toggle.pan-mode,\n.toolbar button.active-toggle {\n    background: linear-gradient(to bottom, #4a90e2, #357abd);\n    border-color: #2968a3;\n    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);\n}\n\n.toolbar button.mode-toggle.pan-mode:hover,\n.toolbar button.active-toggle:hover {\n    background: linear-gradient(to bottom, #5ba0f2, #4585c7);\n}\n\n.toolbar button.mode-toggle.pan-mode:active {\n    background: linear-gradient(to bottom, #357abd, #2968a3);\n    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);\n}\n\n/* Toggle buttons when inactive - gray styling */\n.toolbar button.inactive-toggle {\n    background: #c1c1c1;\n    color: #999;\n    border-color: #c1c1c1;\n    box-shadow: none;\n}\n\n.toolbar button.inactive-toggle:hover {\n    background: #b1b1b1;\n}\n\n.toolbar button.inactive-toggle:active {\n    background: #a1a1a1;\n}\n\n/* Toggle buttons when disabled and not active - gray like other disabled buttons */\n.toolbar button.mode-toggle:disabled:not(.pan-mode):not(.active-toggle),\n.toolbar button.active-toggle:disabled:not(.active-toggle) {\n    background: #c1c1c1;\n    color: #999;\n    border-color: #c1c1c1;\n    box-shadow: none;\n}\n\n/* Ensure Font Awesome icons are sized appropriately if not already handled */\n.toolbar button .fas {\n    font-size: 1em;\n    vertical-align: middle;\n}\n\n/* Zoom percentage display */\n.toolbar button.zoom-display {\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n    font-size: 11px;\n    font-weight: 600;\n    font-variant-numeric: tabular-nums;\n    min-width: 50px;  /* Wider to prevent size change between 99% and 100% */\n    padding: 6px 8px;\n    text-align: center;\n}\n\n.toolbar-group {\n    display: flex;\n    align-items: center;\n    margin-right: 25px; /* Large space between groups */\n}\n\n.toolbar-group:last-child {\n    margin-right: 0; /* Remove right margin from the last group (help button) */\n}\n\nbutton {\n    border: none;\n    background: linear-gradient(to bottom, #4a90e2, #357abd);\n    border-color: #2968a3;\n    border-radius: 3px;\n    padding: 6px 10px;\n    color: #fff;\n    outline: none;\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, .2);\n    margin-right: 5px;\n    min-width: 32px;\n    min-height: 28px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 14px;\n    line-height: 1;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    position: relative;\n}\n\nbutton:hover {\n    background: linear-gradient(to bottom, #5ba0f2, #4585c7);\n}\n\nbutton:active {\n    background: linear-gradient(to bottom, #357abd, #2968a3);\n}\n\nbutton:last-child {\n    margin-right: 0;\n}\n\n/* Save button when no changes - gray */\nbutton.action {\n    background: #c1c1c1;\n    color: #999;\n}\n\nbutton.action:active {\n    background: #b1b1b1;\n}\n\n/* Save button when there are changes - orange */\nbutton.grp {\n    background: linear-gradient(to bottom, #ee9564, #de7d48);\n    margin-right: 0;\n}\n\nbutton.grp:active {\n    background: #d67540;\n}\n\n/* Auto-arrange button with AI purple to blue gradient */\nbutton.auto-arrange {\n    background: linear-gradient(135deg, #6A4C93, #4a90e2);\n    border-color: #4a4c93;\n}\n\nbutton.auto-arrange:hover {\n    background: linear-gradient(135deg, #7B5DAD, #5ba0f2);\n    border-color: #5a5ca3;\n}\n\nbutton.auto-arrange:active {\n    background: linear-gradient(135deg, #593B83, #357abd);\n    border-color: #3a3c83;\n}\n\nselect {\n    border: 1px solid #ccc;\n    background: white;\n    border-radius: 3px;\n    padding: 3px 7px;\n    color: #666;\n    outline: none;\n    margin-right: 5px;\n    font-size: 12px;\n}\n\nselect:disabled {\n    background: #f5f5f5;\n    color: #999;\n}\n\nbutton:disabled {\n    background: #c1c1c1;\n    color: #999;\n}\n\n#root > div > svg {\n    position: absolute;\n    user-select: none;\n}\n\n\n.node.selected .nodeBorder, .edge.selected path, .edge.selected rect {\n    stroke: #29c229;\n}\n.edge .v-dot {\n    fill: transparent;\n    stroke: transparent;\n    stroke-width: 3px;\n    cursor: pointer;\n    transition: stroke 0.15s ease;\n}\n.edge .v-dot:hover {\n    stroke: #999;\n    fill: rgba(153, 153, 153, 0.1);\n}\n.edge .v-dot.selected {\n    stroke: #29c229;\n    fill: rgba(41, 194, 41, 0.1);\n}\n.edge .v-dot.selected:hover {\n    stroke: #29c229;\n    fill: rgba(41, 194, 41, 0.2);\n}\n.edge .v-dot.auto.selected {\n    stroke: #777;\n    fill: rgba(119, 119, 119, 0.1);\n}\n.edge .v-dot.auto.selected:hover {\n    stroke: #777;\n    fill: rgba(119, 119, 119, 0.2);\n}\ncircle#prj {\n    fill: none;\n    stroke: #777;\n}\n\n.nodeShadow {\n    fill: none;\n    stroke-width: 4px;\n    stroke: rgba(0, 0, 0, 0.13);\n}\n\ng.node {\n    user-select: none;\n    cursor: default;\n}\n\ng.node text {\n    pointer-events: none;\n}\n\n.icon {\n    fill: #aaa;\n    stroke: #fff;\n}\n#icon-cube {\n    fill: #aaa;\n}\n\n/* Ensure all button icons are uncolored */\nbutton .icon,\nbutton svg,\nbutton path {\n    fill: currentColor !important;\n    stroke: none !important;\n}\n\n/* Font Awesome icon styling in buttons */\nbutton i {\n    font-size: 12px;\n    color: inherit;\n}\n\nrect.elastic {\n    pointer-events: none;\n    stroke: none;\n    fill: #3bd8281f;\n    display: none;\n}\nrect.elastic.on {\n    display: block;\n}\n\n.popover {\n    position: absolute;\n    top: 50px;\n    bottom: 10px;\n    overflow: auto;\n    right: 10px;\n    background: ghostwhite;\n    padding: 30px;\n    box-shadow: 3px 3px 5px rgba(0,0,0, .2);\n    border: solid 1px #eee;\n}\n\n.popover th {\n    text-align: left;\n    padding: 20px 0px 10px;\n}\n.popover td {\n    padding-right: 20px;\n    font-size: 14px;\n}\n\n/* Simple tooltip system with smart positioning */\n[data-tooltip] {\n    position: relative;\n}\n\n[data-tooltip]:hover::after {\n    content: attr(data-tooltip);\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    background: rgba(0, 0, 0, 0.9);\n    color: white;\n    padding: 6px 12px;\n    border-radius: 4px;\n    font-size: 12px !important;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;\n    font-weight: normal !important;\n    white-space: nowrap;\n    z-index: 1000;\n    pointer-events: none;\n    margin-top: 5px;\n    animation: tooltip-appear 0.1s ease-out;\n    min-width: 120px;\n    max-width: calc(100vw - 20px);\n    box-sizing: border-box;\n}\n\n[data-tooltip]:hover::before {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    border: 4px solid transparent;\n    border-bottom-color: rgba(0, 0, 0, 0.9);\n    z-index: 1000;\n    pointer-events: none;\n    margin-top: 1px;\n    animation: tooltip-appear 0.1s ease-out;\n}\n\n/* Special handling for rightmost elements that might overflow */\n.toolbar-group:nth-last-child(-n+2) button[data-tooltip]:hover::after {\n    /* Apply to last 2 toolbar groups (save and help buttons) */\n    left: auto;\n    right: 0;\n    transform: none;\n}\n\n.toolbar-group:nth-last-child(-n+2) button[data-tooltip]:hover::before {\n    /* Apply to last 2 toolbar groups (save and help buttons) */\n    left: auto;\n    right: 16px;\n    transform: none;\n}\n\n@keyframes tooltip-appear {\n    from {\n        opacity: 0;\n        transform: translateX(-50%) translateY(-5px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(-50%) translateY(0);\n    }\n}\n\nselect {\n    position: relative;\n}\n\n/* Robot shape internal elements - inherit stroke from parent node */\n.node .robot-eye-socket {\n    fill: none;\n    stroke: inherit;\n    stroke-width: 2;\n}\n\n.node .robot-eye {\n    fill: currentColor;\n    stroke: none;\n}\n\n.node .robot-mouth {\n    stroke: inherit;\n}\n\n.node .robot-antenna {\n    stroke: inherit;\n}\n\n.node .robot-antenna-ball {\n    fill: currentColor;\n    stroke: inherit;\n    stroke-width: 1.5;\n}\n\n.node .robot-panel {\n    stroke: inherit;\n}\n\n.node .robot-indicator {\n    fill: currentColor;\n    stroke: none;\n}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/style.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"html, body, #root {\\n    height: 100%;\\n}\\n\\nbody {\\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\\n    color: #666;\\n    margin: 0;\\n}\\n\\n#root {\\n    display: flex;\\n    flex-direction: column;\\n}\\n#root > div.graph {\\n    flex: 1;\\n    overflow: auto;\\n    position: relative;\\n}\\n\\n.toolbar {\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n    padding: 4px 10px;\\n    background-color: #f0f0f0;\\n    border-bottom: 1px solid #cccccc;\\n}\\n\\n.toolbar > div {\\n    display: flex;\\n    align-items: center;\\n}\\n\\n.toolbar button {\\n    padding: 5px 8px;\\n    margin: 0 2px;\\n    cursor: pointer;\\n}\\n\\n.toolbar button:disabled {\\n    opacity: 0.5;\\n    cursor: not-allowed;\\n}\\n\\n/* Drag mode toggle button styles */\\n.toolbar button.mode-toggle {\\n    position: relative;\\n    border: 1px solid #8f9fc9;\\n    width: 40px;\\n    min-height: 28px;\\n    background: linear-gradient(to bottom, #abb8db, #8f9fc9);\\n    border-color: #8f9fc9;\\n    color: white;\\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, .2);\\n}\\n\\n.toolbar button.mode-toggle:hover {\\n    background: linear-gradient(to bottom, #bcc7e0, #abb8db);\\n    border-color: #abb8db;\\n}\\n\\n.toolbar button.mode-toggle.select-mode:active {\\n    background: linear-gradient(to bottom, #8f9fc9, #7a8bb5);\\n}\\n\\n/* Pan mode and active toggle - darker blue */\\n.toolbar button.mode-toggle.pan-mode,\\n.toolbar button.active-toggle {\\n    background: linear-gradient(to bottom, #4a90e2, #357abd);\\n    border-color: #2968a3;\\n    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);\\n}\\n\\n.toolbar button.mode-toggle.pan-mode:hover,\\n.toolbar button.active-toggle:hover {\\n    background: linear-gradient(to bottom, #5ba0f2, #4585c7);\\n}\\n\\n.toolbar button.mode-toggle.pan-mode:active {\\n    background: linear-gradient(to bottom, #357abd, #2968a3);\\n    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);\\n}\\n\\n/* Toggle buttons when inactive - gray styling */\\n.toolbar button.inactive-toggle {\\n    background: #c1c1c1;\\n    color: #999;\\n    border-color: #c1c1c1;\\n    box-shadow: none;\\n}\\n\\n.toolbar button.inactive-toggle:hover {\\n    background: #b1b1b1;\\n}\\n\\n.toolbar button.inactive-toggle:active {\\n    background: #a1a1a1;\\n}\\n\\n/* Toggle buttons when disabled and not active - gray like other disabled buttons */\\n.toolbar button.mode-toggle:disabled:not(.pan-mode):not(.active-toggle),\\n.toolbar button.active-toggle:disabled:not(.active-toggle) {\\n    background: #c1c1c1;\\n    color: #999;\\n    border-color: #c1c1c1;\\n    box-shadow: none;\\n}\\n\\n/* Ensure Font Awesome icons are sized appropriately if not already handled */\\n.toolbar button .fas {\\n    font-size: 1em;\\n    vertical-align: middle;\\n}\\n\\n/* Zoom percentage display */\\n.toolbar button.zoom-display {\\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\\n    font-size: 11px;\\n    font-weight: 600;\\n    font-variant-numeric: tabular-nums;\\n    min-width: 50px;  /* Wider to prevent size change between 99% and 100% */\\n    padding: 6px 8px;\\n    text-align: center;\\n}\\n\\n.toolbar-group {\\n    display: flex;\\n    align-items: center;\\n    margin-right: 25px; /* Large space between groups */\\n}\\n\\n.toolbar-group:last-child {\\n    margin-right: 0; /* Remove right margin from the last group (help button) */\\n}\\n\\nbutton {\\n    border: none;\\n    background: linear-gradient(to bottom, #4a90e2, #357abd);\\n    border-color: #2968a3;\\n    border-radius: 3px;\\n    padding: 6px 10px;\\n    color: #fff;\\n    outline: none;\\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, .2);\\n    margin-right: 5px;\\n    min-width: 32px;\\n    min-height: 28px;\\n    display: inline-flex;\\n    align-items: center;\\n    justify-content: center;\\n    font-size: 14px;\\n    line-height: 1;\\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\\n    position: relative;\\n}\\n\\nbutton:hover {\\n    background: linear-gradient(to bottom, #5ba0f2, #4585c7);\\n}\\n\\nbutton:active {\\n    background: linear-gradient(to bottom, #357abd, #2968a3);\\n}\\n\\nbutton:last-child {\\n    margin-right: 0;\\n}\\n\\n/* Save button when no changes - gray */\\nbutton.action {\\n    background: #c1c1c1;\\n    color: #999;\\n}\\n\\nbutton.action:active {\\n    background: #b1b1b1;\\n}\\n\\n/* Save button when there are changes - orange */\\nbutton.grp {\\n    background: linear-gradient(to bottom, #ee9564, #de7d48);\\n    margin-right: 0;\\n}\\n\\nbutton.grp:active {\\n    background: #d67540;\\n}\\n\\n/* Auto-arrange button with AI purple to blue gradient */\\nbutton.auto-arrange {\\n    background: linear-gradient(135deg, #6A4C93, #4a90e2);\\n    border-color: #4a4c93;\\n}\\n\\nbutton.auto-arrange:hover {\\n    background: linear-gradient(135deg, #7B5DAD, #5ba0f2);\\n    border-color: #5a5ca3;\\n}\\n\\nbutton.auto-arrange:active {\\n    background: linear-gradient(135deg, #593B83, #357abd);\\n    border-color: #3a3c83;\\n}\\n\\nselect {\\n    border: 1px solid #ccc;\\n    background: white;\\n    border-radius: 3px;\\n    padding: 3px 7px;\\n    color: #666;\\n    outline: none;\\n    margin-right: 5px;\\n    font-size: 12px;\\n}\\n\\nselect:disabled {\\n    background: #f5f5f5;\\n    color: #999;\\n}\\n\\nbutton:disabled {\\n    background: #c1c1c1;\\n    color: #999;\\n}\\n\\n#root > div > svg {\\n    position: absolute;\\n    user-select: none;\\n}\\n\\n\\n.node.selected .nodeBorder, .edge.selected path, .edge.selected rect {\\n    stroke: #29c229;\\n}\\n.edge .v-dot {\\n    fill: transparent;\\n    stroke: transparent;\\n    stroke-width: 3px;\\n    cursor: pointer;\\n    transition: stroke 0.15s ease;\\n}\\n.edge .v-dot:hover {\\n    stroke: #999;\\n    fill: rgba(153, 153, 153, 0.1);\\n}\\n.edge .v-dot.selected {\\n    stroke: #29c229;\\n    fill: rgba(41, 194, 41, 0.1);\\n}\\n.edge .v-dot.selected:hover {\\n    stroke: #29c229;\\n    fill: rgba(41, 194, 41, 0.2);\\n}\\n.edge .v-dot.auto.selected {\\n    stroke: #777;\\n    fill: rgba(119, 119, 119, 0.1);\\n}\\n.edge .v-dot.auto.selected:hover {\\n    stroke: #777;\\n    fill: rgba(119, 119, 119, 0.2);\\n}\\ncircle#prj {\\n    fill: none;\\n    stroke: #777;\\n}\\n\\n.nodeShadow {\\n    fill: none;\\n    stroke-width: 4px;\\n    stroke: rgba(0, 0, 0, 0.13);\\n}\\n\\ng.node {\\n    user-select: none;\\n    cursor: default;\\n}\\n\\ng.node text {\\n    pointer-events: none;\\n}\\n\\n.icon {\\n    fill: #aaa;\\n    stroke: #fff;\\n}\\n#icon-cube {\\n    fill: #aaa;\\n}\\n\\n/* Ensure all button icons are uncolored */\\nbutton .icon,\\nbutton svg,\\nbutton path {\\n    fill: currentColor !important;\\n    stroke: none !important;\\n}\\n\\n/* Font Awesome icon styling in buttons */\\nbutton i {\\n    font-size: 12px;\\n    color: inherit;\\n}\\n\\nrect.elastic {\\n    pointer-events: none;\\n    stroke: none;\\n    fill: #3bd8281f;\\n    display: none;\\n}\\nrect.elastic.on {\\n    display: block;\\n}\\n\\n.popover {\\n    position: absolute;\\n    top: 50px;\\n    bottom: 10px;\\n    overflow: auto;\\n    right: 10px;\\n    background: ghostwhite;\\n    padding: 30px;\\n    box-shadow: 3px 3px 5px rgba(0,0,0, .2);\\n    border: solid 1px #eee;\\n}\\n\\n.popover th {\\n    text-align: left;\\n    padding: 20px 0px 10px;\\n}\\n.popover td {\\n    padding-right: 20px;\\n    font-size: 14px;\\n}\\n\\n/* Simple tooltip system with smart positioning */\\n[data-tooltip] {\\n    position: relative;\\n}\\n\\n[data-tooltip]:hover::after {\\n    content: attr(data-tooltip);\\n    position: absolute;\\n    top: 100%;\\n    left: 50%;\\n    transform: translateX(-50%);\\n    background: rgba(0, 0, 0, 0.9);\\n    color: white;\\n    padding: 6px 12px;\\n    border-radius: 4px;\\n    font-size: 12px !important;\\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;\\n    font-weight: normal !important;\\n    white-space: nowrap;\\n    z-index: 1000;\\n    pointer-events: none;\\n    margin-top: 5px;\\n    animation: tooltip-appear 0.1s ease-out;\\n    min-width: 120px;\\n    max-width: calc(100vw - 20px);\\n    box-sizing: border-box;\\n}\\n\\n[data-tooltip]:hover::before {\\n    content: '';\\n    position: absolute;\\n    top: 100%;\\n    left: 50%;\\n    transform: translateX(-50%);\\n    border: 4px solid transparent;\\n    border-bottom-color: rgba(0, 0, 0, 0.9);\\n    z-index: 1000;\\n    pointer-events: none;\\n    margin-top: 1px;\\n    animation: tooltip-appear 0.1s ease-out;\\n}\\n\\n/* Special handling for rightmost elements that might overflow */\\n.toolbar-group:nth-last-child(-n+2) button[data-tooltip]:hover::after {\\n    /* Apply to last 2 toolbar groups (save and help buttons) */\\n    left: auto;\\n    right: 0;\\n    transform: none;\\n}\\n\\n.toolbar-group:nth-last-child(-n+2) button[data-tooltip]:hover::before {\\n    /* Apply to last 2 toolbar groups (save and help buttons) */\\n    left: auto;\\n    right: 16px;\\n    transform: none;\\n}\\n\\n@keyframes tooltip-appear {\\n    from {\\n        opacity: 0;\\n        transform: translateX(-50%) translateY(-5px);\\n    }\\n    to {\\n        opacity: 1;\\n        transform: translateX(-50%) translateY(0);\\n    }\\n}\\n\\nselect {\\n    position: relative;\\n}\\n\\n/* Robot shape internal elements - inherit stroke from parent node */\\n.node .robot-eye-socket {\\n    fill: none;\\n    stroke: inherit;\\n    stroke-width: 2;\\n}\\n\\n.node .robot-eye {\\n    fill: currentColor;\\n    stroke: none;\\n}\\n\\n.node .robot-mouth {\\n    stroke: inherit;\\n}\\n\\n.node .robot-antenna {\\n    stroke: inherit;\\n}\\n\\n.node .robot-antenna-ball {\\n    fill: currentColor;\\n    stroke: inherit;\\n    stroke-width: 1.5;\\n}\\n\\n.node .robot-panel {\\n    stroke: inherit;\\n}\\n\\n.node .robot-indicator {\\n    fill: currentColor;\\n    stroke: none;\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import React, {FC} from \"react\";\nimport { isMac, getModifierKeyName, getModifierKeyProperty } from './utils/platform';\n\ninterface Combination {\n\tctrl?: boolean;\n\tshift?: boolean;\n\talt?: boolean;\n\twheel?: boolean\n\tkey?: string;\n\tclick?: boolean;\n}\n\ninterface Shortcut {\n\tid: string,\n\thelp: string,\n\tcombinations: Combination[]\n}\n\nexport const SAVE = 'save'\n\nexport const UNDO = 'undo'\nexport const REDO = 'redo'\nexport const ADD_VERTEX = 'add-vertex'\nexport const ADD_LABEL_VERTEX = 'add-label-vertex'\nexport const DEL_VERTEX = 'del-vertex'\n\nexport const ZOOM_IN = 'zoom-in'\nexport const ZOOM_OUT = 'zoom-out'\nexport const ZOOM_FIT = 'zoom-fit'\nexport const ZOOM_100 = 'zoom-100'\n\nexport const SELECT_ALL = 'select-all'\nexport const DESELECT = 'deselect'\n\nexport const MOVE_LEFT = 'move-left'\nexport const MOVE_RIGHT = 'move-right'\nexport const MOVE_UP = 'move-up'\nexport const MOVE_DOWN = 'move-down'\nexport const MOVE_LEFT_FINE = 'move-left-fine'\nexport const MOVE_RIGHT_FINE = 'move-right-fine'\nexport const MOVE_UP_FINE = 'move-up-fine'\nexport const MOVE_DOWN_FINE = 'move-down-fine'\n\nexport const PAN_VIEW = 'pan-view'\nexport const SELECT_ELEMENT = 'select-element'\nexport const MULTI_SELECT = 'multi-select'\nexport const BOX_SELECT = 'box-select'\nexport const MOVE_ELEMENTS = 'move-elements'\n\nexport const HELP = 'help'\n\n// New shortcuts for toolbar buttons\nexport const TOGGLE_DRAG_MODE = 'toggle_drag_mode'\nexport const ALIGN_HORIZONTAL = 'align_horizontal'\nexport const ALIGN_VERTICAL = 'align_vertical'\nexport const DISTRIBUTE_HORIZONTAL = 'distribute_horizontal'\nexport const DISTRIBUTE_VERTICAL = 'distribute_vertical'\nexport const AUTO_LAYOUT = 'auto_layout'\nexport const RESET_POSITION = 'reset_position'\nexport const TOGGLE_GRID = 'toggle_grid'\nexport const TOGGLE_SNAP_TO_GRID = 'toggle_snap_to_grid'\nexport const SNAP_ALL_TO_GRID = 'snap_all_to_grid'\n\nconst shortcuts: { name: string; list: Shortcut[] }[] = [\n\t{\n\t\tname: 'Help',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: HELP,\n\t\t\t\thelp: 'Show/hide this help',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{key: '?', shift: true},\n\t\t\t\t\t{key: 'F1', shift: true}\n\t\t\t\t]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'File',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: SAVE,\n\t\t\t\thelp: 'Save',\n\t\t\t\tcombinations: [{key: 's', ctrl: true}]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'History',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: UNDO,\n\t\t\t\thelp: 'Undo',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{ctrl: true, key: 'z'},\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: REDO,\n\t\t\t\thelp: 'Redo',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{ctrl: true, shift: true, key: 'z'},\n\t\t\t\t\t{ctrl: true, key: 'y'},\n\t\t\t\t]\n\t\t\t}\n\n\t\t],\n\t},\n\t{\n\t\tname: 'Relationship editing',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: ADD_VERTEX,\n\t\t\t\thelp: 'Add relationship vertex',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{alt: true, click: true},\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ADD_LABEL_VERTEX,\n\t\t\t\thelp: 'Add label anchor relationship vertex',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{alt: true, shift: true, click: true},\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: DEL_VERTEX,\n\t\t\t\thelp: 'Remove relationship vertex',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{key: 'DELETE'},\n\t\t\t\t\t{key: 'BACKSPACE'}\n\t\t\t\t]\n\t\t\t},\n\t\t]\n\t},\n\t{\n\t\tname: 'Zoom',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: ZOOM_IN,\n\t\t\t\thelp: 'Zoom in',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{ctrl: true, key: '='}\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ZOOM_OUT,\n\t\t\t\thelp: 'Zoom out',\n\t\t\t\tcombinations: [\n\t\t\t\t\t{ctrl: true, key: '-'}\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ZOOM_FIT,\n\t\t\t\thelp: 'Zoom - fit',\n\t\t\t\tcombinations: [{ctrl: true, key: '9'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ZOOM_100,\n\t\t\t\thelp: 'Zoom 100%',\n\t\t\t\tcombinations: [{ctrl: true, key: '0'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'wheel_zoom',\n\t\t\t\thelp: 'Zoom in/out with mouse wheel',\n\t\t\t\tcombinations: [{wheel: true}]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'Mouse Interactions',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: PAN_VIEW,\n\t\t\t\thelp: 'Pan view (drag empty space)',\n\t\t\t\tcombinations: [{click: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: SELECT_ELEMENT,\n\t\t\t\thelp: 'Select element',\n\t\t\t\tcombinations: [{click: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MULTI_SELECT,\n\t\t\t\thelp: 'Add/remove from selection',\n\t\t\t\tcombinations: [{shift: true, click: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: BOX_SELECT,\n\t\t\t\thelp: 'Box selection (drag empty space)',\n\t\t\t\tcombinations: [{shift: true, click: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_ELEMENTS,\n\t\t\t\thelp: 'Move selected elements',\n\t\t\t\tcombinations: [{click: true}]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'Select',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: SELECT_ALL,\n\t\t\t\thelp: 'Select All',\n\t\t\t\tcombinations: [{ctrl: true, key: 'a'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: DESELECT,\n\t\t\t\thelp: 'Deselect',\n\t\t\t\tcombinations: [{key: 'ESC'}]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'Move',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: MOVE_UP,\n\t\t\t\thelp: 'Move up (grid increment)',\n\t\t\t\tcombinations: [{key: 'UP'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_UP_FINE,\n\t\t\t\thelp: 'Move up (1 pixel)',\n\t\t\t\tcombinations: [{key: 'UP', shift: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_RIGHT,\n\t\t\t\thelp: 'Move right (grid increment)',\n\t\t\t\tcombinations: [{key: 'RIGHT'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_RIGHT_FINE,\n\t\t\t\thelp: 'Move right (1 pixel)',\n\t\t\t\tcombinations: [{key: 'RIGHT', shift: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_DOWN,\n\t\t\t\thelp: 'Move down (grid increment)',\n\t\t\t\tcombinations: [{key: 'DOWN'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_DOWN_FINE,\n\t\t\t\thelp: 'Move down (1 pixel)',\n\t\t\t\tcombinations: [{key: 'DOWN', shift: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_LEFT,\n\t\t\t\thelp: 'Move left (grid increment)',\n\t\t\t\tcombinations: [{key: 'LEFT'}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MOVE_LEFT_FINE,\n\t\t\t\thelp: 'Move left (1 pixel)',\n\t\t\t\tcombinations: [{key: 'LEFT', shift: true}]\n\t\t\t},\n\t\t]\n\t},\n\t\t\t{\n\t\t\tname: 'View',\n\t\t\tlist: [\n\t\t\t\t{\n\t\t\t\t\tid: TOGGLE_DRAG_MODE,\n\t\t\t\t\thelp: 'Toggle between pan and select mode',\n\t\t\t\t\tcombinations: [{key: 't'}]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: RESET_POSITION,\n\t\t\t\t\thelp: 'Reset position and view',\n\t\t\t\t\tcombinations: [{key: 'Home', ctrl: true}]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t{\n\t\tname: 'Alignment',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: ALIGN_HORIZONTAL,\n\t\t\t\thelp: 'Align selected elements horizontally',\n\t\t\t\tcombinations: [{key: 'h', ctrl: true, shift: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ALIGN_VERTICAL,\n\t\t\t\thelp: 'Align selected elements vertically',\n\t\t\t\tcombinations: [{key: 'a', ctrl: true, shift: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: DISTRIBUTE_HORIZONTAL,\n\t\t\t\thelp: 'Distribute selected elements horizontally',\n\t\t\t\tcombinations: [{key: 'h', ctrl: true, alt: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: DISTRIBUTE_VERTICAL,\n\t\t\t\thelp: 'Distribute selected elements vertically',\n\t\t\t\tcombinations: [{key: 'v', ctrl: true, alt: true}]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'Layout',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: AUTO_LAYOUT,\n\t\t\t\thelp: 'Auto layout all elements',\n\t\t\t\tcombinations: [{key: 'l', ctrl: true}]\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: 'Grid',\n\t\tlist: [\n\t\t\t{\n\t\t\t\tid: TOGGLE_GRID,\n\t\t\t\thelp: 'Toggle grid visibility',\n\t\t\t\tcombinations: [{key: 'g', ctrl: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: TOGGLE_SNAP_TO_GRID,\n\t\t\t\thelp: 'Toggle snap to grid',\n\t\t\t\tcombinations: [{key: 'g', ctrl: true, shift: true}]\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: SNAP_ALL_TO_GRID,\n\t\t\t\thelp: 'Snap all elements to grid',\n\t\t\t\tcombinations: [{key: 'g', ctrl: true, alt: true}]\n\t\t\t}\n\t\t]\n\t}\n]\n\nconst shortcutMap = shortcuts\n\t.reduce((lst, s) => lst.concat(s.list), [] as Shortcut[])\n\t.reduce<{ [k: string]: Shortcut }>((map, s) => {\n\t\tmap[s.id] = s;\n\t\treturn map\n\t}, {})\n\nconst checkKey = (e: KeyboardEvent | MouseEvent, shortcut: Shortcut, click: boolean, wheel: boolean) => {\n\treturn shortcut.combinations.some(c => {\n\t\tif (Boolean(c.shift) != e.shiftKey) return false\n\t\t// Use platform-appropriate modifier key\n\t\tif (c.ctrl) {\n\t\t\tconst modifierKey = getModifierKeyProperty(e as KeyboardEvent);\n\t\t\tif (!modifierKey) return false;\n\t\t}\n\t\tif (Boolean(c.alt) != e.altKey) return false\n\t\tif (click) return c.click\n\t\tif (wheel) return c.wheel\n\t\tif (c.key) {\n\t\t\tconst ke = e as KeyboardEvent\n\t\t\tif (c.key == 'DELETE') return ke.key == 'Delete'\n\t\t\tif (c.key == 'BACKSPACE') return ke.key == 'Backspace'\n\t\t\tif (c.key == 'ESC') return ke.key == 'Escape'\n\t\t\tif (c.key == 'UP') return ke.key == 'ArrowUp'\n\t\t\tif (c.key == 'DOWN') return ke.key == 'ArrowDown'\n\t\t\tif (c.key == 'LEFT') return ke.key == 'ArrowLeft'\n\t\t\tif (c.key == 'RIGHT') return ke.key == 'ArrowRight'\n\t\t\treturn c.key && ke.key && c.key.toLowerCase() == ke.key.toLowerCase()\n\t\t}\n\t\treturn false\n\t})\n}\n\nexport const findShortcut = (e: KeyboardEvent | MouseEvent, click = false, wheel = false) => {\n\t// Find all matching shortcuts\n\tconst matches = Object.keys(shortcutMap).filter(k => checkKey(e, shortcutMap[k], click, wheel))\n\t\n\tif (matches.length === 0) return undefined\n\tif (matches.length === 1) return matches[0]\n\t\n\t// If multiple matches, prefer the one with more specific modifiers\n\t// Sort by number of modifiers (shift, ctrl, alt) in descending order\n\tconst sortedMatches = matches.sort((a, b) => {\n\t\tconst aShortcut = shortcutMap[a]\n\t\tconst bShortcut = shortcutMap[b]\n\t\t\n\t\tconst aModifiers = aShortcut.combinations[0]\n\t\tconst bModifiers = bShortcut.combinations[0]\n\t\t\n\t\tconst aCount = (aModifiers.shift ? 1 : 0) + (aModifiers.ctrl ? 1 : 0) + (aModifiers.alt ? 1 : 0)\n\t\tconst bCount = (bModifiers.shift ? 1 : 0) + (bModifiers.ctrl ? 1 : 0) + (bModifiers.alt ? 1 : 0)\n\t\t\n\t\treturn bCount - aCount // Descending order (more modifiers first)\n\t})\n\t\n\treturn sortedMatches[0]\n}\n\nconst comboText = (c: Combination) => {\n\treturn [\n\t\tc.ctrl && getModifierKeyName().toUpperCase(),\n\t\tc.shift && 'SHIFT',\n\t\tc.alt && 'ALT',\n\t\tc.key && (c.key.length > 1 ? c.key : `\"${c.key.toUpperCase()}\"`),\n\t\tc.click && 'CLICK',\n\t\tc.wheel && 'WHEEL'\n\t].filter(Boolean).join(' + ')\n}\n\nexport const Help: FC = () => {\n\treturn <div className=\"popover\">\n\t\t<h1>Shortcuts</h1>\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t{\n\t\t\t\tshortcuts.map(section => <>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th colSpan={2}>{section.name}</th>\n\t\t\t\t\t</tr>\n\t\t\t\t\t{section.list.map(item => <tr>\n\t\t\t\t\t\t<td>{item.combinations.map(comboText).join(', ')}</td>\n\t\t\t\t\t\t<td>{item.help}</td>\n\t\t\t\t\t</tr>)}\n\t\t\t\t</>)\n\t\t\t}\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n}\n","\n      import API from \"!../node_modules/.pnpm/style-loader@4.0.0_webpack@5.103.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/.pnpm/style-loader@4.0.0_webpack@5.103.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/.pnpm/style-loader@4.0.0_webpack@5.103.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/.pnpm/style-loader@4.0.0_webpack@5.103.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/.pnpm/style-loader@4.0.0_webpack@5.103.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/.pnpm/style-loader@4.0.0_webpack@5.103.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/.pnpm/css-loader@7.1.2_webpack@5.103.0/node_modules/css-loader/dist/cjs.js!./style.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/.pnpm/css-loader@7.1.2_webpack@5.103.0/node_modules/css-loader/dist/cjs.js!./style.css\";\n       export default content && content.locals ? content.locals : undefined;\n","interface LiveReloadOptions {\n\tminDelay: number;\n\tmaxDelay: number;\n\thandshakeTimeout: number;\n}\n\ninterface LiveReloadMessage {\n\tcommand: string;\n\tprotocols?: string[];\n\tver?: string;\n\tpath?: string;\n}\n\nclass Timer {\n\tprivate readonly callback: () => void;\n\tprivate readonly handler: () => void;\n\tprivate running: boolean = false;\n\tprivate timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n\tconstructor(callback: () => void) {\n\t\tthis.callback = callback;\n\t\tthis.handler = () => {\n\t\t\tthis.running = false;\n\t\t\tthis.timeoutId = null;\n\t\t\tthis.callback();\n\t\t};\n\t}\n\n\tstart(timeout: number): void {\n\t\tif (this.running) {\n\t\t\tthis.stop();\n\t\t}\n\t\tthis.timeoutId = setTimeout(this.handler, timeout);\n\t\tthis.running = true;\n\t}\n\n\tstop(): void {\n\t\tif (this.running && this.timeoutId !== null) {\n\t\t\tclearTimeout(this.timeoutId);\n\t\t\tthis.running = false;\n\t\t\tthis.timeoutId = null;\n\t\t}\n\t}\n\n\tisRunning(): boolean {\n\t\treturn this.running;\n\t}\n}\n\n/**\n * RefreshConnector implements the livereload protocol to listen for file changes via WebSocket\n */\nexport class RefreshConnector {\n\tprivate static readonly DEFAULT_OPTIONS: LiveReloadOptions = {\n\t\tminDelay: 1000,\n\t\tmaxDelay: 60000,\n\t\thandshakeTimeout: 5000\n\t};\n\n\tprivate static readonly LIVERELOAD_PROTOCOLS = [\n\t\t'http://livereload.com/protocols/official-9',\n\t\t'http://livereload.com/protocols/2.x-remote-control'\n\t];\n\n\tprivate readonly uri: string;\n\tprivate readonly options: LiveReloadOptions;\n\tprivate readonly fileChangeHandler: (path: string) => void;\n\t\n\tprivate socket: WebSocket | null = null;\n\tprivate nextDelay: number;\n\tprivate connectionDesired: boolean = false;\n\tprivate disconnectionReason: string = '';\n\t\n\tprivate readonly handshakeTimeout: Timer;\n\tprivate readonly reconnectTimer: Timer;\n\n\tconstructor(fileChangeHandler: (file: string) => void, options?: Partial<LiveReloadOptions>) {\n\t\tthis.fileChangeHandler = fileChangeHandler;\n\t\tthis.options = { ...RefreshConnector.DEFAULT_OPTIONS, ...options };\n\t\tthis.uri = 'ws://localhost:35729/livereload';\n\t\tthis.nextDelay = this.options.minDelay;\n\n\t\tthis.handshakeTimeout = new Timer(() => this.handleHandshakeTimeout());\n\t\tthis.reconnectTimer = new Timer(() => this.attemptReconnection());\n\t}\n\n\tconnect(): void {\n\t\tthis.connectionDesired = true;\n\n\t\tif (this.isSocketConnected()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.prepareForConnection();\n\t\tthis.createWebSocket();\n\t}\n\n\tdisconnect(): void {\n\t\tthis.connectionDesired = false;\n\t\tthis.reconnectTimer.stop();\n\n\t\tif (this.isSocketConnected()) {\n\t\t\tthis.disconnectionReason = 'manual';\n\t\t\tthis.socket!.close();\n\t\t}\n\t}\n\n\tprivate isSocketConnected(): boolean {\n\t\treturn this.socket !== null && this.socket.readyState === WebSocket.OPEN;\n\t}\n\n\tprivate prepareForConnection(): void {\n\t\tthis.reconnectTimer.stop();\n\t\tthis.disconnectionReason = 'cannot-connect';\n\t}\n\n\tprivate createWebSocket(): void {\n\t\tthis.socket = new WebSocket(this.uri);\n\t\tthis.socket.onopen = () => this.handleOpen();\n\t\tthis.socket.onclose = () => this.handleClose();\n\t\tthis.socket.onmessage = (event) => this.handleMessage(event);\n\t\tthis.socket.onerror = () => this.handleError();\n\t}\n\n\tprivate handleOpen(): void {\n\t\tthis.disconnectionReason = 'handshake-failed';\n\t\tthis.startHandshake();\n\t}\n\n\tprivate handleClose(): void {\n\t\tconsole.log(`WebSocket disconnected: ${this.disconnectionReason}. Retry in ${this.nextDelay}ms`);\n\t\tthis.scheduleReconnection();\n\t}\n\n\tprivate handleMessage(event: MessageEvent): void {\n\t\ttry {\n\t\t\tconst message: LiveReloadMessage = JSON.parse(event.data);\n\t\t\tthis.processMessage(message);\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to parse WebSocket message:', error);\n\t\t}\n\t}\n\n\tprivate handleError(): void {\n\t\t// Error handling is done in onclose\n\t}\n\n\tprivate processMessage(message: LiveReloadMessage): void {\n\t\tswitch (message.command) {\n\t\t\tcase 'hello':\n\t\t\t\tthis.handleHelloMessage();\n\t\t\t\tbreak;\n\t\t\tcase 'reload':\n\t\t\t\tthis.handleReloadMessage(message);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.log('Unknown WebSocket message received:', message);\n\t\t}\n\t}\n\n\tprivate handleHelloMessage(): void {\n\t\tthis.handshakeTimeout.stop();\n\t\tthis.nextDelay = this.options.minDelay;\n\t}\n\n\tprivate handleReloadMessage(message: LiveReloadMessage): void {\n\t\t// The livereload server closes connection after sending reload\n\t\t// We must reconnect\n\t\tthis.reconnectTimer.stop();\n\t\tthis.connect();\n\n\t\tif (message.path) {\n\t\t\tthis.fileChangeHandler(message.path);\n\t\t}\n\t}\n\n\tprivate startHandshake(): void {\n\t\tconst helloMessage: LiveReloadMessage = {\n\t\t\tcommand: 'hello',\n\t\t\tprotocols: RefreshConnector.LIVERELOAD_PROTOCOLS,\n\t\t\tver: '3.3.1'\n\t\t};\n\t\t\n\t\tthis.sendCommand(helloMessage);\n\t\tthis.handshakeTimeout.start(this.options.handshakeTimeout);\n\t}\n\n\tprivate handleHandshakeTimeout(): void {\n\t\tif (this.isSocketConnected()) {\n\t\t\tthis.disconnectionReason = 'handshake-timeout';\n\t\t\tthis.socket!.close();\n\t\t}\n\t}\n\n\tprivate attemptReconnection(): void {\n\t\tif (this.connectionDesired) {\n\t\t\tthis.connect();\n\t\t}\n\t}\n\n\tprivate scheduleReconnection(): void {\n\t\tif (!this.connectionDesired) {\n\t\t\treturn; // Don't reconnect after manual disconnection\n\t\t}\n\n\t\tif (!this.reconnectTimer.isRunning()) {\n\t\t\tthis.reconnectTimer.start(this.nextDelay);\n\t\t\tthis.nextDelay = Math.min(this.options.maxDelay, this.nextDelay * 2);\n\t\t}\n\t}\n\n\tprivate sendCommand(command: LiveReloadMessage): void {\n\t\tif (this.isSocketConnected()) {\n\t\t\tthis.socket!.send(JSON.stringify(command));\n\t\t}\n\t}\n}","import { createRoot } from 'react-dom/client';\nimport React, { Suspense, lazy, useEffect, useState } from 'react';\nimport { refreshGraph } from \"./Root\";\nimport './style.css';\nimport '@fortawesome/fontawesome-free/css/all.css';\nimport { RefreshConnector } from \"./websocket\";\n\nconst Root = lazy(() => import('./Root').then(module => ({ default: module.Root })));\n\ninterface ModelData {\n\tmodel: any;\n\tlayout: any;\n}\n\ninterface AppState {\n\tdata: ModelData | null;\n\terror: string | null;\n\tloading: boolean;\n}\n\nconst App: React.FC = () => {\n\tconst [state, setState] = useState<AppState>({\n\t\tdata: null,\n\t\terror: null,\n\t\tloading: true\n\t});\n\n\tconst loadData = async () => {\n\t\tsetState(prev => ({ ...prev, loading: true, error: null }));\n\t\t\n\t\ttry {\n\t\t\tconst [modelResponse, layoutResponse] = await Promise.all([\n\t\t\t\tfetch('data/model.json'),\n\t\t\t\tfetch('data/layout.json')\n\t\t\t]);\n\n\t\t\tif (!modelResponse.ok) {\n\t\t\t\tthrow new Error(`Failed to fetch model: ${modelResponse.statusText}`);\n\t\t\t}\n\t\t\t\n\t\t\tif (!layoutResponse.ok) {\n\t\t\t\tthrow new Error(`Failed to fetch layout: ${layoutResponse.statusText}`);\n\t\t\t}\n\n\t\t\tconst [model, layout] = await Promise.all([\n\t\t\t\tmodelResponse.json(),\n\t\t\t\tlayoutResponse.json()\n\t\t\t]);\n\n\t\t\tsetState({\n\t\t\t\tdata: { model, layout },\n\t\t\t\terror: null,\n\t\t\t\tloading: false\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to load data:', error);\n\t\t\tsetState({\n\t\t\t\tdata: null,\n\t\t\t\terror: error instanceof Error ? error.message : 'Unknown error occurred',\n\t\t\t\tloading: false\n\t\t\t});\n\t\t}\n\t};\n\n\tconst handleFileChange = (path: string) => {\n\t\tif (path.endsWith('.svg')) {\n\t\t\treturn; // Ignore SVG changes to avoid infinite loops\n\t\t}\n\t\t\n\t\tconsole.log('File changed:', path);\n\t\trefreshGraph();\n\t\tloadData();\n\t};\n\n\tuseEffect(() => {\n\t\t// Setup refresh connector\n\t\tconst refreshConnector = new RefreshConnector(handleFileChange);\n\t\trefreshConnector.connect();\n\n\t\t// Initial data load\n\t\tloadData();\n\n\t\t// Cleanup function\n\t\treturn () => {\n\t\t\t// RefreshConnector cleanup would go here if it had a disconnect method\n\t\t};\n\t}, []);\n\n\tif (state.loading) {\n\t\treturn <LoadingScreen />;\n\t}\n\n\tif (state.error) {\n\t\treturn <ErrorScreen error={state.error} onRetry={loadData} />;\n\t}\n\n\tif (!state.data) {\n\t\treturn <ErrorScreen error=\"No data available\" onRetry={loadData} />;\n\t}\n\n\treturn (\n\t\t<Suspense fallback={<LoadingScreen />}>\n\t\t\t<Root model={state.data.model} layout={state.data.layout} />\n\t\t</Suspense>\n\t);\n};\n\nconst LoadingScreen: React.FC = () => (\n\t<div style={{\n\t\tdisplay: 'flex',\n\t\tjustifyContent: 'center',\n\t\talignItems: 'center',\n\t\theight: '100vh',\n\t\tfontFamily: 'Arial, sans-serif'\n\t}}>\n\t\t<div>Loading...</div>\n\t</div>\n);\n\nconst ErrorScreen: React.FC<{ error: string; onRetry: () => void }> = ({ error, onRetry }) => (\n\t<div style={{\n\t\tpadding: '20px',\n\t\tcolor: 'red',\n\t\tfontFamily: 'monospace',\n\t\twhiteSpace: 'pre-wrap',\n\t\tdisplay: 'flex',\n\t\tflexDirection: 'column',\n\t\talignItems: 'center',\n\t\tjustifyContent: 'center',\n\t\theight: '100vh'\n\t}}>\n\t\t<h2>Error loading application</h2>\n\t\t<p>{error}</p>\n\t\t<button \n\t\t\tonClick={onRetry}\n\t\t\tstyle={{\n\t\t\t\tpadding: '10px 20px',\n\t\t\t\tfontSize: '16px',\n\t\t\t\tcursor: 'pointer',\n\t\t\t\tbackgroundColor: '#007bff',\n\t\t\t\tcolor: 'white',\n\t\t\t\tborder: 'none',\n\t\t\t\tborderRadius: '4px'\n\t\t\t}}\n\t\t>\n\t\t\tRetry\n\t\t</button>\n\t</div>\n);\n\n// Initialize the application\nconst container = document.getElementById('root');\nif (!container) {\n\tthrow new Error('Root container not found');\n}\n\nconst root = createRoot(container);\nroot.render(<App />);","import {GraphData} from \"./graph-view/graph\";\n\n\ninterface Model {\n\tname: string\n\tdescription: string\n\tversion: string\n\tmodel: {\n\t\tenterprise: {\n\t\t\tname: string\n\t\t}\n\t\tpeople: Element[]\n\t\tsoftwareSystems: Element[]\n\t\tdeploymentNodes: Element[]\n\t}\n\tviews: {\n\t\tsystemLandscapeViews: View[]\n\t\tcontainerViews: View[]\n\t\tcomponentViews: View[]\n\t\tdynamicViews: View[]\n\t\tdeploymentViews: View[]\n\t\tstyles: {\n\t\t\telements: {\n\t\t\t\t[key: string]: string\n\t\t\t}[];\n\t\t\trelationships: {\n\t\t\t\t[key: string]: string\n\t\t\t}[]\n\t\t}\n\t}\n}\n\ninterface Layouts {\n\t[key: string]: { // keyed by view key\n\t\t[key: string]: { x: number; y: number } // keyed by element id\n\t}\n}\n\ninterface Element {\n\tid: string;\n\tname: string;\n\ttechnology?: string;\n\tdescription?: string;\n\tparent?: Element;\n\ttags?: string;\n\tlocation?: string;\n\tcontainers?: Element[];\n\tcomponents?: Element[];\n\trelationships?: Relation[];\n\tproperties?: { [key: string]: string }\n\tchildren?: Element[];\n\tinfrastructureNodes?: Element[];\n}\n\ninterface Relation {\n\tid: string;\n\tdescription: string;\n\ttags: string;\n\tsourceId: string;\n\tdestinationId: string;\n\ttechnology: string;\n\tinteractionStyle: string;\n}\n\ninterface View {\n\tkey: string;\n\ttitle: string;\n\tdescription: string\n\telements: {\n\t\tid: string\n\t}[];\n\trelationships: {\n\t\tid: string;\n\t\tvertices: { x: number; y: number }[];\n\t\trouting: string; // takes priority over style\n\t}[];\n\tsoftwareSystemId: string;\n}\n\ninterface Metadata {\n\tname: string\n\tdescription: string\n\tversion: string\n\telements: {\n\t\tid: string\n\t\ttags?: string;\n\t\tlocation?: string;\n\t\tproperties?: { [key: string]: string };\n\t\telementViewKey?: string;\n\t\ttechnology?: string;\n\t}[]\n}\n\nexport type ViewsList = {\n\tkey: string;\n\ttitle: string;\n\tsection: string;\n}[]\n\nexport const parseView = (model: Model, layouts: Layouts, viewKey: string) => {\n\n\tconst elements = new Map<string, Element>();\n\tconst relations = new Map<string, Relation>();\n\n\tconst collectRels = (el: Element) => {\n\t\tif (Array.isArray(el.relationships)) {\n\t\t\tel.relationships.forEach(rel => {\n\t\t\t\trelations.set(rel.id, rel)\n\t\t\t})\n\t\t}\n\t}\n\n\t// People\n\tmodel.model.people && model.model.people.forEach((el: Element) => {\n\t\telements.set(el.id, el)\n\t\tif (Array.isArray(el.relationships)) {\n\t\t\tel.relationships.forEach(rel => {\n\t\t\t\trelations.set(rel.id, rel)\n\t\t\t})\n\t\t}\n\t})\n\t// Software Systems\n\tmodel.model.softwareSystems && model.model.softwareSystems.forEach((el: Element) => {\n\t\telements.set(el.id, el)\n\t\tcollectRels(el)\n\n\t\tif (Array.isArray(el.containers)) {\n\t\t\tel.containers.forEach((el1: Element) => {\n\t\t\t\tel1.parent = el;\n\t\t\t\telements.set(el1.id, el1)\n\t\t\t\tcollectRels(el1)\n\t\t\t\tif (Array.isArray(el1.components)) {\n\t\t\t\t\tel1.components.forEach((el2: Element) => {\n\t\t\t\t\t\tel2.parent = el1;\n\t\t\t\t\t\telements.set(el2.id, el2)\n\t\t\t\t\t\tcollectRels(el2)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t})\n\n\t// Deployment Nodes\n\tif (model.model.deploymentNodes) {\n\t\tconst containerInstances = (el: any) => {\n\t\t\tel.containerInstances && el.containerInstances.forEach((item: any) => {\n\t\t\t\tconst el1 = {...elements.get(item.containerId), id: item.id}\n\t\t\t\telements.set(el1.id, el1)\n\t\t\t\tel1.parent = el\n\t\t\t\tcollectRels(item)\n\t\t\t})\n\t\t}\n\n\t\tconst recAddNodes = (el: Element, parent: Element) => {\n\t\t\tel.parent = parent;\n\t\t\telements.set(el.id, el)\n\t\t\tcollectRels(el)\n\t\t\tcontainerInstances(el)\n\t\t\tel.children && el.children.forEach((el1: Element) => recAddNodes(el1, el))\n\t\t\tel.infrastructureNodes && el.infrastructureNodes.forEach((el1: Element) => recAddNodes(el1, el))\n\t\t}\n\n\t\tmodel.model.deploymentNodes.forEach((el: Element) => recAddNodes(el, null))\n\t}\n\n\t// Create graph from selected view\n\tconst {view, section} = getView(model, viewKey)\n\n\tif (!view) return null\n\n\tconst graph = new GraphData(view.key, view.title || view.key)\n\tconst metadata: Metadata = {name: graph.name, description: view.description, version: model.version, elements: []}\n\tgraph.metadata = metadata\n\n\tif (!view.elements) return graph\n\n\t//grouping rules - elements that are groups will not be nodes\n\tconst groupingIDs: { [key: string]: boolean } = {}\n\tif (section == 'deploymentViews' || section == 'containerViews') {\n\t\tview.elements.forEach(ref => {\n\t\t\tconst el = elements.get(ref.id)\n\t\t\tif (el?.parent) {\n\t\t\t\tgroupingIDs[el.parent.id] = true\n\t\t\t}\n\t\t})\n\t} else if (view.softwareSystemId) {\n\t\t//don't show grouping if the element is listed in the view\n\t\tif (!view.elements.find(ref => ref.id == view.softwareSystemId))\n\t\t\tgroupingIDs[view.softwareSystemId] = true\n\t} else if (section == 'systemLandscapeViews') {\n\t\t// create a virtual parent element from enterprise\n\t\tconst p: Element = {id: '__enterprise__', ...model.model.enterprise}\n\t\telements.set(p.id, p)\n\t\tif (model.model.people) model.model.people.filter(el => el.location != 'External').forEach(el => el.parent = p)\n\t\tif (model.model.softwareSystems) model.model.softwareSystems.filter(el => el.location != 'External').forEach(el => el.parent = p)\n\t\tgroupingIDs[p.id] = true\n\t}\n\n\tconst styles = model.views.styles\n\n\t// Build color-to-variable mapping for CSS custom properties theming\n\tconst cssClassName = (tag: string) => tag.toLowerCase().replace(/[^a-z0-9-]/g, '-')\n\t\n\tif (styles?.elements) {\n\t\tstyles.elements.forEach(s => {\n\t\t\tif (s.tag) {\n\t\t\t\tconst varPrefix = `--mdl-${cssClassName(s.tag)}`\n\t\t\t\tif (s.background) graph.colorToVarMap.set(s.background as string, `${varPrefix}-bg`)\n\t\t\t\tif (s.color) graph.colorToVarMap.set(s.color as string, `${varPrefix}-color`)\n\t\t\t\tif (s.stroke) graph.colorToVarMap.set(s.stroke as string, `${varPrefix}-stroke`)\n\t\t\t}\n\t\t})\n\t}\n\n\tif (styles?.relationships) {\n\t\tstyles.relationships.forEach(s => {\n\t\t\tif (s.tag) {\n\t\t\t\tconst varPrefix = `--mdl-rel-${cssClassName(s.tag)}`\n\t\t\t\tif (s.color) graph.colorToVarMap.set(s.color as string, `${varPrefix}-color`)\n\t\t\t}\n\t\t})\n\t}\n\n\t//nodes\n\tview.elements.forEach((ref) => {\n\t\t// except grouping elements\n\t\tif (groupingIDs[ref.id]) return\n\n\t\tconst el = elements.get(ref.id)\n\n\t\tlet sub = ''\n\t\tlet style = {}\n\t\tif (el) {\n\t\t\tconst tags = el.tags.split(',')\n\t\t\tsub = tags[tags.length - 1] // subtitle is [<last tag>]\n\t\t\tif (el.technology)\n\t\t\t\tsub += ': ' + el.technology // or [<technology>: <last tag>]\n\n\t\t\ttags.forEach(tag => {\n\t\t\t\tconst s = styles && styles.elements && styles.elements.find(s => s.tag == tag)\n\t\t\t\ts && (style = {...style, ...s})\n\t\t\t})\n\t\t}\n\n\t\tgraph.addNode(\n\t\t\tref.id,\n\t\t\tel ? (el.name || ref.id) : ref.id,\n\t\t\tsub,\n\t\t\t(el && el.description) ? el.description : '',\n\t\t\tstyle\n\t\t)\n\t\tel && metadata.elements.push({\n\t\t\tid: el.id,\n\t\t\ttags: el.tags,\n\t\t\tlocation: el.location,\n\t\t\tproperties: el.properties,\n\t\t\telementViewKey: lookupElementKeyView(model, el.id),\n\t\t\ttechnology: el.technology\n\t\t})\n\t})\n\t//edges\n\tif (Array.isArray(view.relationships)) {\n\t\tview.relationships.forEach(ref => {\n\t\t\tconst rel = relations.get(ref.id)\n\t\t\tif (!rel) return;\n\n\t\t\tif (!graph.nodesMap.has(rel.sourceId)) {\n\t\t\t\tif (elements.has(rel.sourceId)) {\n\t\t\t\t\tconst el = elements.get(rel.sourceId)\n\t\t\t\t\tconsole.warn('Element not found in this view: ', el.id, el.name)\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn('Element not found: ', rel.sourceId)\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!graph.nodesMap.has(rel.destinationId)) {\n\t\t\t\tif (elements.has(rel.destinationId)) {\n\t\t\t\t\tconst el = elements.get(rel.destinationId)\n\t\t\t\t\tconsole.warn('Element not found in this view: ', el.id, el.name)\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn('Element not found: ', rel.destinationId)\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet style: any = {}\n\t\t\trel.tags.split(',').forEach(tag => {\n\t\t\t\tconst s = styles && styles.relationships && styles.relationships.find(s => s.tag == tag)\n\t\t\t\ts && (style = {...style, ...s})\n\t\t\t})\n\t\t\tif (ref.routing) style.routing = ref.routing\n\n\t\t\tgraph.addEdge(rel.id, rel.sourceId, rel.destinationId, rel.description, ref.vertices, style)\n\t\t})\n\t}\n\n\t//groups\n\t//sort by depth to solve dependency\n\tconst level = (el: Element) => {\n\t\tlet i = 0\n\t\tfor (let p = el.parent; p; p = p.parent) i++;\n\t\treturn i\n\t}\n\tconst gElements = Object.keys(groupingIDs)\n\t\t.map(id => elements.get(id))\n\t\t.sort((a, b) => level(a) > level(b) ? -1 : 1)\n\n\tgElements.forEach(parent => {\n\t\tlet style = {}\n\t\tif (section == 'deploymentViews') {\n\t\t\tconst el = elements.get(parent.id)\n\t\t\tconst tags = el.tags.split(',')\n\t\t\ttags.forEach(tag => {\n\t\t\t\tconst s = styles && styles.elements && styles.elements.find(s => s.tag == tag)\n\t\t\t\ts && (style = {...style, ...s})\n\t\t\t})\n\t\t}\n\t\t\n\t\t// Filter group members more carefully to respect boundaries\n\t\tconst groupMembers = view.elements\n\t\t\t.map(ref => elements.get(ref.id))\n\t\t\t.filter(el => {\n\t\t\t\tif (!el || el.parent !== parent) return false;\n\t\t\t\t\n\t\t\t\t// For system landscape views, respect the location-based grouping\n\t\t\t\tif (section === 'systemLandscapeViews' && parent.id === '__enterprise__') {\n\t\t\t\t\t// Only include elements that are explicitly non-external\n\t\t\t\t\treturn el.location !== 'External';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// For other view types, include if parent matches\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.map(el => el.id);\n\t\t\n\t\t// Only create group if it has members\n\t\tif (groupMembers.length > 0) {\n\t\t\tgraph.addGroup(\n\t\t\t\tparent.id,\n\t\t\t\tparent.name,\n\t\t\t\tgroupMembers,\n\t\t\t\tstyle\n\t\t\t)\n\t\t}\n\t})\n\n\t//layout if any and init graph\n\tgraph.init(layouts[graph.id])\n\treturn graph\n}\n\n// lookup the view in all Views sections in the model. return the view and the section\nfunction getView(model: Model, viewKey: string) {\n\tlet view: View = null, section: string = ''\n\tObject.keys(model.views).filter(s => s.endsWith('Views')).some((s: string) => {\n\t\treturn ((model.views as any)[s]).some((v: View) => {\n\t\t\tif (v.key == viewKey) {\n\t\t\t\tview = v\n\t\t\t\tsection = s\n\t\t\t\treturn true\n\t\t\t}\n\t\t})\n\t})\n\treturn {view, section}\n}\n\n\nfunction lookupElementKeyView(model: any, softwareSystemId: string) {\n\tlet key: string = undefined\n\tObject.keys(model.views).filter(s => s.endsWith('Views')).some((s: string) => {\n\t\treturn ((model.views as any)[s]).some((v: View) => {\n\t\t\tif (v.softwareSystemId == softwareSystemId) {\n\t\t\t\tkey = v.key\n\t\t\t\treturn true\n\t\t\t}\n\t\t})\n\t})\n\treturn key\n}\n\nexport const listViews = (model: any) => {\n\tconst viewsList: ViewsList = []\n\tconst sections = Object.keys(model.views).filter(section => section.endsWith('Views'))\n\tsections.forEach(s => {\n\t\tmodel.views[s].forEach((v: View) => {\n\t\t\tviewsList.push({key: v.key, title: v.title || v.key, section: s})\n\t\t})\n\t})\n\treturn viewsList;\n}\n","import { useState, useCallback, useEffect } from 'react';\nimport { GraphData } from './graph-view/graph';\nimport { parseView } from './parseModel';\nimport { LayoutOptions } from './graph-view/layout';\nimport { \n  findShortcut, \n  HELP, \n  SAVE, \n  TOGGLE_DRAG_MODE,\n  ALIGN_HORIZONTAL,\n  ALIGN_VERTICAL,\n  DISTRIBUTE_HORIZONTAL,\n  DISTRIBUTE_VERTICAL,\n  AUTO_LAYOUT,\n  RESET_POSITION,\n  TOGGLE_GRID,\n  TOGGLE_SNAP_TO_GRID,\n  SNAP_ALL_TO_GRID,\n  MOVE_LEFT,\n  MOVE_RIGHT,\n  MOVE_UP,\n  MOVE_DOWN,\n  MOVE_LEFT_FINE,\n  MOVE_RIGHT_FINE,\n  MOVE_UP_FINE,\n  MOVE_DOWN_FINE\n} from './shortcuts';\n\n// Global state for graphs to preserve edits\nconst graphs: { [key: string]: GraphData } = {};\n\n// Custom hook for graph management\nexport const useGraph = (model: any, layouts: any, currentID: string): GraphData | null => {\n  if (graphs[currentID]) {\n    return graphs[currentID];\n  }\n  \n  const graph = parseView(model, layouts, currentID);\n  if (graph) {\n    graphs[currentID] = graph;\n  }\n  \n  return graph;\n};\n\n// Custom hook for auto layout functionality\nexport const useAutoLayout = (graph: GraphData) => {\n  const [layouting, setLayouting] = useState(false);\n\n  const handleAutoLayout = useCallback(async (opts?: LayoutOptions) => {\n    setLayouting(true);\n    try {\n      const options: LayoutOptions = {\n        direction: 'DOWN',\n        ...(opts || {})\n      };\n      await graph.autoLayout(options);\n    } catch (error) {\n      console.error('Layout failed:', error);\n      alert('Layout failed. See console for details.');\n    } finally {\n      setLayouting(false);\n    }\n  }, [graph]);\n\n  return { layouting, handleAutoLayout };\n};\n\n// Custom hook for save functionality\nexport const useSave = (graph: GraphData, currentID: string) => {\n  const [saving, setSaving] = useState(false);\n\n  const handleSave = useCallback(async () => {\n    setSaving(true);\n    \n    try {\n      const response = await fetch('data/save?id=' + encodeURIComponent(currentID), {\n        method: 'post',\n        body: graph.exportSVG()\n      });\n      \n      if (response.status !== 202) {\n        alert('Error saving\\nSee terminal output.');\n      } else {\n        graph.setSaved();\n      }\n    } catch (error) {\n      console.error('Save failed:', error);\n      alert('Save failed. See console for details.');\n    } finally {\n      setSaving(false);\n    }\n  }, [graph, currentID]);\n\n  return { saving, handleSave };\n};\n\n// Custom hook for keyboard shortcuts\nexport const useKeyboardShortcuts = (\n  toggleHelp: () => void,\n  saveLayout: () => void,\n  graph?: GraphData,\n  dragMode?: 'pan' | 'select',\n  setDragMode?: (mode: 'pan' | 'select') => void,\n  onAutoLayout?: () => void\n) => {\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      const shortcut = findShortcut(e);\n      \n      // Prevent browser default for all recognized shortcuts\n      if (shortcut) {\n        e.preventDefault();\n      }\n      \n      if (shortcut === HELP) {\n        toggleHelp();\n      } else if (shortcut === SAVE) {\n        saveLayout();\n      } else if (shortcut === TOGGLE_DRAG_MODE && setDragMode && dragMode) {\n        setDragMode(dragMode === 'pan' ? 'select' : 'pan');\n      } else if (graph) {\n        // Graph-dependent shortcuts\n        if (shortcut === ALIGN_HORIZONTAL) {\n          graph.alignSelectionH();\n        } else if (shortcut === ALIGN_VERTICAL) {\n          graph.alignSelectionV();\n        } else if (shortcut === DISTRIBUTE_HORIZONTAL) {\n          graph.distributeSelectionH();\n        } else if (shortcut === DISTRIBUTE_VERTICAL) {\n          graph.distributeSelectionV();\n        } else if (shortcut === AUTO_LAYOUT && onAutoLayout) {\n          onAutoLayout();\n        } else if (shortcut === RESET_POSITION) {\n          graph.resetView();\n        } else if (shortcut === TOGGLE_GRID) {\n          graph.toggleGrid();\n        } else if (shortcut === TOGGLE_SNAP_TO_GRID) {\n          graph.toggleSnapToGrid();\n        } else if (shortcut === SNAP_ALL_TO_GRID) {\n          graph.snapAllToGrid();\n        } else if (shortcut === MOVE_LEFT) {\n          graph.moveSelected(-graph.getGridSize(), 0);\n        } else if (shortcut === MOVE_LEFT_FINE) {\n          graph.moveSelected(-1, 0, true); // Disable snap for fine movement\n        } else if (shortcut === MOVE_RIGHT) {\n          graph.moveSelected(graph.getGridSize(), 0);\n        } else if (shortcut === MOVE_RIGHT_FINE) {\n          graph.moveSelected(1, 0, true); // Disable snap for fine movement\n        } else if (shortcut === MOVE_UP) {\n          graph.moveSelected(0, -graph.getGridSize());\n        } else if (shortcut === MOVE_UP_FINE) {\n          graph.moveSelected(0, -1, true); // Disable snap for fine movement\n        } else if (shortcut === MOVE_DOWN) {\n          graph.moveSelected(0, graph.getGridSize());\n        } else if (shortcut === MOVE_DOWN_FINE) {\n          graph.moveSelected(0, 1, true); // Disable snap for fine movement\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [toggleHelp, saveLayout, graph, dragMode, setDragMode, onAutoLayout]);\n};\n\n// Utility function to clear graph cache\nexport const clearGraphCache = (currentID?: string) => {\n  if (currentID) {\n    delete graphs[currentID];\n  } else {\n    Object.keys(graphs).forEach(key => delete graphs[key]);\n  }\n};","// Helper functions for the application\n\nexport function removeEmptyProps(obj: any) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function camelToWords(camel: string) {\n  const split = camel.replace(/([A-Z])/g, \" $1\");\n  return split.charAt(0).toUpperCase() + split.slice(1);\n}\n\nexport function getCurrentViewID() {\n  const params = new URLSearchParams(document.location.search);\n  return params.get('id') || '';\n} ","import React, { FC, useState, useEffect } from 'react';\nimport { getZoomAuto, GraphData, setZoom, getZoom, setZoomCentered } from '../graph-view/graph';\nimport { listViews } from '../parseModel';\nimport { camelToWords } from '../utils';\nimport { getModifierKeyName } from '../utils/platform';\n\n// Types\ninterface ToolbarProps {\n  model: any;\n  currentID: string;\n  onViewChange: (id: string) => void;\n  graph: GraphData;\n  onAutoLayout: () => void;\n  onSave: () => void;\n  onToggleHelp: () => void;\n  saving: boolean;\n  layouting: boolean;\n  dragMode: 'pan' | 'select';\n  setDragMode: (mode: 'pan' | 'select') => void;\n}\n\nexport const Toolbar: FC<ToolbarProps> = ({\n  model, currentID, onViewChange, graph, \n  onAutoLayout, onSave, onToggleHelp, saving, layouting,\n  dragMode, setDragMode\n}) => {\n  const views = listViews(model);\n  \n  return (\n    <div className=\"toolbar\">\n      <ViewSelector \n        views={views}\n        currentID={currentID}\n        onViewChange={onViewChange}\n      />\n      <ToolbarActions\n        graph={graph}\n        onAutoLayout={onAutoLayout}\n        onSave={onSave}\n        onToggleHelp={onToggleHelp}\n        saving={saving}\n        layouting={layouting}\n        dragMode={dragMode}\n        setDragMode={setDragMode}\n      />\n    </div>\n  );\n};\n\nconst ViewSelector: FC<{\n  views: any[];\n  currentID: string;\n  onViewChange: (id: string) => void;\n}> = ({ views, currentID, onViewChange }) => (\n  <div>\n    View:\n    {views.length > 1 ? (\n      <select onChange={e => onViewChange(e.target.value)} value={currentID}>\n        <option disabled value=\"\" hidden>...</option>\n        {views.map(view => (\n          <option key={view.key} value={view.key}>\n            {camelToWords(view.section) + ': ' + view.title}\n          </option>\n        ))}\n      </select>\n    ) : (\n      <span style={{ marginLeft: '8px', fontWeight: 'bold' }}>\n        {views[0] ? camelToWords(views[0].section) + ': ' + views[0].title : 'No views available'}\n      </span>\n    )}\n  </div>\n);\n\nconst ToolbarActions: FC<{\n  graph: GraphData;\n  onAutoLayout: () => void;\n  onSave: () => void;\n  onToggleHelp: () => void;\n  saving: boolean;\n  layouting: boolean;\n  dragMode: 'pan' | 'select';\n  setDragMode: (mode: 'pan' | 'select') => void;\n}> = ({\n  graph, onAutoLayout, onSave, onToggleHelp, saving, layouting,\n  dragMode, setDragMode\n}) => (\n  <div style={{ display: 'flex', alignItems: 'center' }}>\n    <div className=\"toolbar-group\">\n      <DragModeButton dragMode={dragMode} setDragMode={setDragMode} />\n    </div>\n    <div className=\"toolbar-group\">\n      <UndoRedoButtons graph={graph} />\n    </div>\n    <div className=\"toolbar-group\">\n      <AlignmentButtons graph={graph} />\n    </div>\n    <div className=\"toolbar-group\">\n      <LayoutControls onAutoLayout={onAutoLayout} layouting={layouting} />\n    </div>\n    <div className=\"toolbar-group\">\n      <GridControls graph={graph} />\n    </div>\n    <div className=\"toolbar-group\">\n      <ZoomControls graph={graph} />\n    </div>\n    <div className=\"toolbar-group\">\n      <SaveButton onSave={onSave} saving={saving} graph={graph} />\n    </div>\n    <div className=\"toolbar-group\">\n      <HelpButton onToggleHelp={onToggleHelp} />\n    </div>\n  </div>\n);\n\nconst DragModeButton: FC<{\n  dragMode: 'pan' | 'select';\n  setDragMode: (mode: 'pan' | 'select') => void;\n}> = ({ dragMode, setDragMode }) => (\n  <button \n    className={`mode-toggle ${dragMode === 'select' ? 'select-mode' : 'pan-mode'}`}\n    onClick={() => setDragMode(dragMode === 'pan' ? 'select' : 'pan')} \n    data-tooltip={dragMode === 'pan' ? \"Pan Mode: Drag to pan the view (T)\" : \"Select Mode: Drag to select elements, Shift+click to add/remove selection (T)\"}\n  >\n    {dragMode === 'pan' ? <i className=\"fas fa-hand-paper\"></i> : <i className=\"fas fa-mouse-pointer\"></i>}\n  </button>\n);\n\nconst UndoRedoButtons: FC<{ graph: GraphData }> = ({ graph }) => {\n  const modKey = getModifierKeyName();\n  return (\n    <>\n      <button onClick={() => graph.undo()} data-tooltip={`Undo the last change made to the diagram (${modKey}+Z)`}>\n        <i className=\"fas fa-undo\"></i>\n      </button>\n      <button onClick={() => graph.redo()} data-tooltip={`Redo the last undone action (${modKey}+Shift+Z / ${modKey}+Y)`}>\n        <i className=\"fas fa-redo\"></i>\n      </button>\n    </>\n  );\n};\n\nconst AlignmentButtons: FC<{ graph: GraphData }> = ({ graph }) => {\n  const modKey = getModifierKeyName();\n  return (\n    <>\n      <button onClick={() => graph.alignSelectionH()} data-tooltip={`Align all selected elements horizontally (left edges) (${modKey}+Shift+H)`}>\n        <i className=\"fas fa-align-left\"></i>\n      </button>\n      <button onClick={() => graph.alignSelectionV()} data-tooltip={`Align all selected elements vertically (top edges) (${modKey}+Shift+A)`}>\n        <i className=\"fas fa-align-left\" style={{transform: 'rotate(90deg)'}}></i>\n      </button>\n      <button onClick={() => graph.distributeSelectionH()} data-tooltip={`Distribute selected elements evenly horizontally (equal spacing) (${modKey}+Alt+H)`}>\n        <i className=\"fas fa-ellipsis-h\"></i>\n      </button>\n      <button onClick={() => graph.distributeSelectionV()} data-tooltip={`Distribute selected elements evenly vertically (equal spacing) (${modKey}+Alt+V)`}>\n        <i className=\"fas fa-ellipsis-v\"></i>\n      </button>\n    </>\n  );\n};\n\nconst LayoutControls: FC<{\n  onAutoLayout: () => void;\n  layouting: boolean;\n}> = ({ onAutoLayout, layouting }) => {\n  const modKey = getModifierKeyName();\n  return (\n    <button \n      className=\"auto-arrange\"\n      onClick={onAutoLayout} \n      disabled={layouting} \n      data-tooltip={`Automatically arrange all elements using the Layered algorithm (${modKey}+L)`}\n    >\n      {layouting ? <i className=\"fas fa-spinner fa-spin\"></i> : <i className=\"fas fa-magic\"></i>}\n    </button>\n  );\n};\n\nconst GridControls: FC<{ graph: GraphData }> = ({ graph }) => {\n  const [gridVisible, setGridVisible] = useState(graph.isGridVisible());\n  const [snapToGrid, setSnapToGrid] = useState(graph.isSnapToGrid());\n  const modKey = getModifierKeyName();\n  \n  // Update state when graph changes or when grid state changes via shortcuts\n  React.useEffect(() => {\n    const updateGridState = () => {\n      setGridVisible(graph.isGridVisible());\n      setSnapToGrid(graph.isSnapToGrid());\n    };\n    \n    // Initial update\n    updateGridState();\n    \n    // Listen for grid state changes from keyboard shortcuts\n    window.addEventListener('gridStateChanged', updateGridState);\n    \n    return () => {\n      window.removeEventListener('gridStateChanged', updateGridState);\n    };\n  }, [graph]);\n  \n  const handleToggleGrid = () => {\n    graph.toggleGrid();\n    setGridVisible(graph.isGridVisible());\n  };\n  \n  const handleToggleSnap = () => {\n    graph.toggleSnapToGrid();\n    setSnapToGrid(graph.isSnapToGrid());\n  };\n  \n  const handleSnapAll = () => {\n    graph.snapAllToGrid();\n  };\n  \n  return (\n    <>\n      <button \n        className={gridVisible ? 'active-toggle' : 'inactive-toggle'}\n        onClick={handleToggleGrid} \n        data-tooltip={`Toggle grid visibility (${modKey}+G)`}\n      >\n        <i className=\"fas fa-th\"></i>\n      </button>\n      <button \n        className={snapToGrid ? 'active-toggle' : 'inactive-toggle'}\n        onClick={handleToggleSnap} \n        data-tooltip={`Toggle snap to grid (${modKey}+Shift+G)`}\n      >\n        <i className=\"fas fa-magnet\"></i>\n      </button>\n      <button \n        onClick={handleSnapAll} \n        disabled={!snapToGrid}\n        data-tooltip={`Snap all elements to grid (${modKey}+Alt+G)`}\n      >\n        <i className=\"fas fa-border-all\"></i>\n      </button>\n    </>\n  );\n};\n\nconst ZoomDisplay: FC = () => {\n  const [zoom, setZoomState] = useState(100);\n\n  useEffect(() => {\n    const updateZoom = () => {\n      const currentZoom = Math.round(getZoom() * 100);\n      setZoomState(currentZoom);\n    };\n\n    // Update zoom initially\n    updateZoom();\n\n    // Update zoom every 100ms to catch changes from wheel/keyboard/etc\n    const interval = setInterval(updateZoom, 100);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  return (\n    <button \n      onClick={() => setZoomCentered(1)} \n      className=\"zoom-display\"\n      data-tooltip=\"Click to reset zoom to 100%\"\n    >\n      {zoom}%\n    </button>\n  );\n};\n\nconst ZoomControls: FC<{ graph: GraphData }> = ({ graph }) => {\n  const modKey = getModifierKeyName();\n  return (\n    <>\n      <button onClick={() => {\n        setZoomCentered(Math.max(0.1, getZoom() / 1.2));\n      }} data-tooltip={`Zoom out to see more of the diagram (${modKey}+-)`}>\n        <i className=\"fas fa-search-minus\"></i>\n      </button>\n      <ZoomDisplay />\n      <button onClick={() => {\n        setZoomCentered(Math.min(5, getZoom() * 1.2));\n      }} data-tooltip={`Zoom in to see details more clearly (${modKey}+=)`}>\n        <i className=\"fas fa-search-plus\"></i>\n      </button>\n      <button onClick={() => { graph.fitToView(); }} data-tooltip={`Fit diagram to view (${modKey}+9)`}>\n        <i className=\"fas fa-expand\"></i>\n      </button>\n    </>\n  );\n};\n\nconst SaveButton: FC<{\n  onSave: () => void;\n  saving: boolean;\n  graph: GraphData;\n}> = ({ onSave, saving, graph }) => {\n  const [hasChanges, setHasChanges] = useState(false);\n  const modKey = getModifierKeyName();\n  \n  // Check for changes periodically\n  useEffect(() => {\n    const checkChanges = () => {\n      setHasChanges(graph.changed());\n    };\n    \n    // Initial check\n    checkChanges();\n    \n    // Check every 100ms for changes\n    const interval = setInterval(checkChanges, 100);\n    \n    return () => clearInterval(interval);\n  }, [graph]);\n  \n  return (\n    <button \n      className={hasChanges ? \"grp\" : \"action\"} \n      disabled={saving} \n      onClick={onSave} \n      data-tooltip={`Save the current diagram layout (${modKey}+S)`}\n    >\n      {saving ? <i className=\"fas fa-spinner fa-spin\"></i> : <i className=\"fas fa-save\"></i>}\n    </button>\n  );\n};\n\nconst HelpButton: FC<{\n  onToggleHelp: () => void;\n}> = ({ onToggleHelp }) => {\n  return (\n    <button onClick={onToggleHelp} data-tooltip=\"Show keyboard shortcuts and help information (Shift+? / Shift+F1)\">\n      <i className=\"fas fa-question-circle\"></i>\n    </button>\n  );\n};","import React, { FC, useState, useCallback, useEffect, Suspense, lazy } from \"react\";\nimport { GraphData } from \"./graph-view/graph\";\nimport { BrowserRouter as Router, Routes, Route, useSearchParams } from 'react-router-dom';\nimport { listViews } from \"./parseModel\";\nimport { useGraph, useAutoLayout, useSave, useKeyboardShortcuts, clearGraphCache } from \"./hooks\";\nimport { Toolbar } from \"./components/Toolbar\";\nimport { removeEmptyProps, getCurrentViewID } from \"./utils\";\n\nconst Help = lazy(() => import(\"./shortcuts\").then(module => ({ default: module.Help })));\nconst Graph = lazy(() => import(\"./graph-view/graph-react\").then(module => ({ default: module.Graph })));\n\n// Types\ninterface ModelData {\n  model: any;\n  layout: any;\n}\n\nexport const Root: FC<ModelData> = ({ model, layout }) => (\n  <Router>\n    <Routes>\n      <Route path=\"/\" element={<ModelPane model={model} layouts={layout} />} />\n    </Routes>\n  </Router>\n);\n\nexport const refreshGraph = () => {\n  const currentID = getCurrentViewID();\n  clearGraphCache(currentID);\n};\n\nconst ModelPane: FC<{ model: any; layouts: any }> = ({ model, layouts }) => {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const currentID = decodeURI(searchParams.get('id') || '');\n  \n  // UI State\n  const [helpVisible, setHelpVisible] = useState(false);\n  const [dragMode, setDragMode] = useState<'pan' | 'select'>('pan');\n  \n  // Get or create graph for current view\n  const graph = useGraph(model, layouts, currentID);\n  \n  // Custom hooks for functionality\n  const { layouting, handleAutoLayout } = useAutoLayout(graph || ({} as GraphData));\n  const { saving, handleSave } = useSave(graph || ({} as GraphData), currentID);\n  \n  if (!graph) {\n    return <ViewRedirect model={model} />;\n  }\n\n  const handleToggleHelp = useCallback(() => {\n    setHelpVisible(!helpVisible);\n  }, [helpVisible]);\n\n  // Update document title when view changes\n  useEffect(() => {\n    if (graph && graph.name) {\n      document.title = `${graph.name} - Model`;\n    }\n  }, [graph]);\n\n  // Headless automation: support query params to auto-layout and save\n  useEffect(() => {\n    // Only run when graph changes to avoid duplicate actions\n    const params = Object.fromEntries(searchParams.entries());\n    const auto = params['auto'] === '1' || params['auto'] === 'true';\n    const save = params['save'] === '1' || params['save'] === 'true';\n    const direction = (params['direction'] || '').toUpperCase();\n    const compact = params['compact'] === '1' || params['compact'] === 'true';\n\n    const validDirections = ['UP', 'DOWN', 'LEFT', 'RIGHT'];\n    const layoutOpts: any = {};\n    if (validDirections.includes(direction)) {\n      layoutOpts.direction = direction as any;\n    }\n    if (compact) {\n      layoutOpts.compactLayout = true;\n    }\n\n    let cancelled = false;\n    (async () => {\n      try {\n        if (auto) {\n          await handleAutoLayout(layoutOpts);\n        }\n        if (save) {\n          await handleSave();\n        }\n      } catch (e) {\n        console.error('automation error', e);\n      }\n    })();\n\n    return () => { cancelled = true; };\n  }, [graph, handleAutoLayout, handleSave, searchParams]);\n\n  // Setup keyboard shortcuts\n  useKeyboardShortcuts(handleToggleHelp, handleSave, graph, dragMode, setDragMode, handleAutoLayout);\n\n  const handleViewChange = useCallback((id: string) => {\n    setSearchParams({ id: encodeURIComponent(id) });\n  }, [setSearchParams]);\n\n  const handleSelect = useCallback((id: string | null) => {\n    if (id) {\n      const element = graph.metadata.elements.find((m: any) => m.id === id);\n      console.log(removeEmptyProps(element));\n    }\n  }, [graph]);\n\n\treturn (\n\t\t<>\n\t\t\t<Toolbar\n\t\t\t\tmodel={model}\n\t\t\t\tcurrentID={currentID}\n\t\t\t\tonViewChange={handleViewChange}\n\t\t\t\tgraph={graph}\n\t\t\t\tonAutoLayout={handleAutoLayout}\n\t\t\t\tonSave={handleSave}\n\t\t\t\tonToggleHelp={handleToggleHelp}\n\t\t\t\tsaving={saving}\n\t\t\t\tlayouting={layouting}\n\t\t\t\tdragMode={dragMode}\n\t\t\t\tsetDragMode={setDragMode}\n\t\t\t/>\n\t\t\t<Suspense fallback={<div>Loading graph...</div>}>\n\t\t\t\t<Graph \n\t\t\t\t\tkey={currentID}\n\t\t\t\t\tdata={graph}\n\t\t\t\t\tonSelect={handleSelect}\n\t\t\t\t\tdragMode={dragMode}\n\t\t\t\t/>\n\t\t\t</Suspense>\n\t\t\t{helpVisible && (\n\t\t\t\t<Suspense fallback={<div>Loading help...</div>}>\n\t\t\t\t\t<Help />\n\t\t\t\t</Suspense>\n\t\t\t)}\n\t\t</>\n\t);\n};\n\nconst ViewRedirect: FC<{ model: any }> = ({ model }) => {\n  const views = listViews(model);\n  \n  React.useEffect(() => {\n    // Set default title when no view is selected\n    document.title = 'Model - Architecture Diagrams as Code';\n    \n    if (views.length > 0) {\n      document.location.href = '?id=' + views[0].key;\n    }\n  }, [views]);\n\n  if (views.length > 0) {\n    return <>Redirecting to {views[0].title}</>;\n  }\n  return <>No views available</>;\n};\n\n"],"names":["isMac","navigator","userAgentData","platform","toLowerCase","includes","userAgent","undefined","KeyboardEvent","metaKey","test","e","getModifierKeyName","getModifierKeyProperty","event","ctrlKey","svgTextWrap","text","width","attrs","mt","svg","document","createElementNS","body","appendChild","measure","node","attr","setAttribute","createTextNode","_node$getBBox","getBBox","height","removeChild","clean","textMeasure","maxW","ret","trim","split","map","words","lines","currentLine","forEach","word","length","push","join","brokenParts","maxWidth","parts","currentPart","i","testPart","breakLongWord","Math","max","newLine","concat","size","reduce","a","v","create","element","type","arguments","className","el","Object","entries","_ref","_ref2","k","String","classList","add","use","id","this","setAttributeNS","path","_objectSpread","d","t","textContent","textArea","fontSize","bold","_this","x","y","anchor","_svgTextWrap","txt","line","span","dy","append","rect","r","rx","ry","icon","expand","expanded","g","transform","setPosition","insideBox","p","b","intersectRectFull","p1","p2","box","w","h","q","s","q1","q2","denominator","numerator1","numerator2","result","onLine1","onLine2","segmentIntersection","filter","intersectRect","intersectEllipse","ellCenter","nodeCenter","point","si","c","radicand_sqrt","sqrt","pos","project","atob","len","dot","min","cabDistance","abs","D3Element","_classCallCheck","_el","key","value","name","insertBefore","querySelector","parent","bbox","rounded","shapeSvg","insert","intersect","_ellipse","mobiledeviceportrait","shapes","roundedbox","component","dx","cylinder","shape","cy","person","circle","ellipse","hexagon","sz","n","folder","mobiledevicelandscape","mobiledevice","pipe","robot","headSize","headR","antennaH","antennaR","eyeR","eyeSpacing","earW","earH","bodyW","bodyTop","bodyH","labelOffsetY","headTop","eyeY","mouthY","mouthW","webbrowser","Symbol","iterator","o","toStringTag","prototype","Generator","u","_regeneratorDefine2","f","G","bind","l","TypeError","call","done","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","m","defineProperty","_invoke","enumerable","configurable","writable","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","toString","slice","constructor","_unsupportedIterableToArray","_nonIterableSpread","asyncGeneratorStep","Promise","resolve","then","getEffectiveSpacing","_userOptions$nodeSpac","_userOptions$layerSpa","userOptions","isGroup","effectiveConfig","nodeSpacing","layerSpacing","componentSpacing","padding","groupMultiplier","getELKOptions","spacing","_userOptions$directio","direction","_userOptions$compactL","compactLayout","baseOptions","autoLayout","_x","_autoLayout","apply","_callee","graph","options","ELK","elk","rootSpacing","elkGraph","nodeMap","layoutedGraph","nodes","edges","_extractNodes","_processEdgesFromELK","minX","minY","offsetX","offsetY","_t","_args","_context","module","layoutOptions","children","Map","nodesMap","set","nodeWidth","nodeHeight","arrowPadding","edge","_edge$from","_edge$to","to","has","labelWidth","label","elkEdge","sources","targets","labels","console","warn","Error","layout","extractNodes","container","_container$children","child","processEdgesFromELK","_container$edges","_container$children2","vertices","sections","section","startPoint","bendPoints","bp","endPoint","originalEdge","find","elkLabel","midIndex","floor","v1","v2","vertex","createFallbackLayout","_next","_throw","maxCols","ceil","col","Undo","exportDoc","importDoc","func","timeout","_defineProperty","change","saveNow","context","clearTimeout","setTimeout","tmpPreviousState","deepClone","versions","splice","doc","structuredClone","JSON","parse","stringify","lastSavedPos","SVG_PADDING","applyStyle","style","keys","setProperty","calculateDistance","_slicedToArray","_arrayWithHoles","next","_iterableToArrayLimit","_nonIterableRest","ownKeys","getOwnPropertySymbols","getOwnPropertyDescriptor","getOwnPropertyDescriptors","defineProperties","_defineProperties","_toPropertyKey","_typeof","toPrimitive","_toPrimitive","clickListener","defaultEdgeStyle","thickness","color","opacity","dashed","defaultNodeStyle","background","stroke","GraphData","edgeVertices","groupsMap","_undo","exportLayout","lo","importLayout","window","_this2","currentState","beforeChange","sub","description","isPersonShape","cleanStyle","title","values","fromNode","toNode","_this3","get","initVertex","round","random","userDeletedVertices","nodesOrGroups","_this4","error","group","Boolean","selected","ref","remove","updateEdgesSel","disableSnap","skipUndo","_snapToGrid","snapped","snapToGrid","redrawEdges","redrawGroups","redrawEdge","_this5","moveNode","moveEdgeVertex","isLabel","index","indexOf","changed","undo","redo","_this6","contentBounds","calculateContentBounds","_skipAutoFit","bb","zoom","currentZoom","getZoom","zoomGroup","parentElement","clientWidth","clientHeight","clearViewState","updatePanning","_this7","buildEdge","buildGroup","originalSvg","exportSvg","cloneNode","exportElastic","exportWidth","exportHeight","exportZoomGroup","convertStylesToCustomProperties","script","createElement","metadata","replace","firstChild","outerHTML","_this8","colorToVarMap","querySelectorAll","fill","getAttribute","Infinity","maxX","maxY","left","right","top","bottom","centerX","centerY","approxLabelSize","full","lst","auto","setSaved","_this9","rerender","coordinates","startsWith","_ref3","_ref4","endsWith","normalizedPoint","assign","edgeId","_this0","an","ae","labelVertex","insertPos","findOptimalLabelPosition","projectedPos","projectLabelOntoSegment","fitToView","_autoLayout2","_this1","_this10","_this11","selectedNodes","selectedVertices","allElements","sort","newX","_this12","newY","setNodeSelected","_svg$parentElement","_svg$parentElement2","viewportWidth","viewportHeight","zoomX","zoomY","optimalZoom","finalZoom","translateX","translateY","saveViewState","state","_gridVisible","_gridSize","updateGridDisplay","dispatchEvent","CustomEvent","_this13","snappedX","snappedY","existingGrid","existingGridRect","defs","pattern","addEventListener","selectListener","buildGraph","data","onNodeSelect","dragMode","innerHTML","__data","_buildGraph","elasticEl","addCursorInteraction","setZoom","zoomG","nodesG","edgesG","groupsG","gdata","shapeType","styles","nodeBorder","setBorderStyle","border","tg","Number","maxTextWidth","textPadding","_create$textArea2","nodeText","_create$textArea3","buildNode","n1","n2","position","sameEdges","spreadPos","spreadX","spreadY","unshift","firstRoutingVertex","lastRoutingVertex","calculateNodeIntersection","targetPoint","_node$style","nodeShape","halfHeight","angle","atan2","cos","sin","rectX","rectY","topCurveY","bottomCurveY","ellipseY","discriminant","sqrt_d","x1","x2","radius","halfWidth","startIntersection","endIntersection","calculateEdgeVertices","pLabel","fallback","sum","acc","calculateLabelPosition","_buildEdgeLabel","_create$textArea","edgeText","bg","edgeRect","buildEdgeLabel","_createEdgeSegments","segments","reverse","s2","intersectPolylineBox","createEdgeSegments","cx","p0","_style","topExtension","bottomExtension","hexHeight","pad","groupRect","groupText","findClosestSegment","fnd","dst","POSITIVE_INFINITY","prj","pts","mouseToDrawing","getBoundingClientRect","z","currentTransform","getCurrentTransform","clientX","clientY","addCustomCursorInteraction","conn","ini","elastic","isPanning","initialTransform","pendingSelectionChange","hasDragged","eventListeners","md","convertEvent","changedTouches","onMouseMoveHandler","getSelection","setSelection","setTransform","drawingDx","drawingDy","item","setDragging","update","onMouseMove","ex","ey","onMouseUpHandler","removeEventListener","end","boxSelection","shiftKey","graphData","onMouseUp","onMouseDownHandler","preventDefault","nodeFromEvent","effectiveMode","isSelected","findIndex","translateMatch","match","parseFloat","getCurrentTransformLocal","startDrawingX","startDrawingY","pt","currentPt","currentDrawingX","currentDrawingY","createElastic","onMouseDown","handler","addDnd","_ref5","existingCleanup","__cursorInteractionCleanup","getData","gd","beforeUnloadHandler","returnValue","setDotSelected","dotEl","mouseMoveHandler","altKey","removePrjDot","keyUpHandler","findShortcut","ADD_VERTEX","ADD_LABEL_VERTEX","clickHandler","insertEdgeVertex","wheelHandler","delta","sign","deltaY","newZoom","setZoomCentered","keyDownHandler","shortcut","DEL_VERTEX","deleteEdgeVertex","UNDO","REDO","ZOOM_IN","ZOOM_OUT","ZOOM_100","ZOOM_FIT","SELECT_ALL","DESELECT","customInteractionCleanup","target","closest","handles","some","handle","b1","b2","_ref6","scaleMatch","oldZoom","newTranslateX","newTranslateY","cursor","viewStateCache","graphId","restoreViewState","labelPos","fullPath","minDistance","bestSegmentIndex","distance","distanceToSegment","segmentStart","segmentEnd","A","B","C","D","lenSq","xx","yy","param","projectPointOntoSegment","___CSS_LOADER_EXPORT___","SAVE","MOVE_LEFT","MOVE_RIGHT","MOVE_UP","MOVE_DOWN","MOVE_LEFT_FINE","MOVE_RIGHT_FINE","MOVE_UP_FINE","MOVE_DOWN_FINE","HELP","TOGGLE_DRAG_MODE","ALIGN_HORIZONTAL","ALIGN_VERTICAL","DISTRIBUTE_HORIZONTAL","DISTRIBUTE_VERTICAL","AUTO_LAYOUT","RESET_POSITION","TOGGLE_GRID","TOGGLE_SNAP_TO_GRID","SNAP_ALL_TO_GRID","shortcuts","list","help","combinations","shift","ctrl","alt","click","wheel","shortcutMap","matches","ke","checkKey","aShortcut","bShortcut","aModifiers","bModifiers","aCount","comboText","toUpperCase","Help","React","colSpan","styleTagTransform","setAttributes","domAPI","insertStyleElement","locals","Timer","_createClass","callback","running","timeoutId","stop","RefreshConnector","fileChangeHandler","DEFAULT_OPTIONS","uri","nextDelay","minDelay","handshakeTimeout","handleHandshakeTimeout","reconnectTimer","attemptReconnection","connectionDesired","isSocketConnected","prepareForConnection","createWebSocket","disconnectionReason","socket","close","readyState","WebSocket","OPEN","onopen","handleOpen","onclose","handleClose","onmessage","handleMessage","onerror","handleError","startHandshake","log","scheduleReconnection","message","processMessage","command","handleHelloMessage","handleReloadMessage","connect","helloMessage","protocols","LIVERELOAD_PROTOCOLS","ver","sendCommand","start","isRunning","maxDelay","send","Root","lazy","default","App","_useState2","useState","loading","setState","loadData","_yield$Promise$all","_yield$Promise$all2","modelResponse","layoutResponse","_yield$Promise$all3","_yield$Promise$all4","model","prev","all","fetch","ok","statusText","json","handleFileChange","refreshGraph","useEffect","LoadingScreen","ErrorScreen","onRetry","Suspense","display","justifyContent","alignItems","fontFamily","whiteSpace","flexDirection","onClick","backgroundColor","borderRadius","getElementById","createRoot","render","lookupElementKeyView","softwareSystemId","views","listViews","viewsList","_asyncToGenerator","graphs","camelToWords","camel","charAt","Toolbar","currentID","onViewChange","onAutoLayout","onSave","onToggleHelp","saving","layouting","setDragMode","ViewSelector","ToolbarActions","onChange","disabled","hidden","view","marginLeft","fontWeight","DragModeButton","UndoRedoButtons","AlignmentButtons","LayoutControls","GridControls","ZoomControls","SaveButton","HelpButton","modKey","alignSelectionH","alignSelectionV","distributeSelectionH","distributeSelectionV","_ref7","_ref8","isGridVisible","gridVisible","setGridVisible","_useState4","isSnapToGrid","setSnapToGrid","updateGridState","toggleGrid","toggleSnapToGrid","snapAllToGrid","ZoomDisplay","_useState6","setZoomState","updateZoom","interval","setInterval","clearInterval","_ref9","_ref0","_useState8","hasChanges","setHasChanges","checkChanges","_ref1","Graph","Router","Routes","Route","ModelPane","layouts","URLSearchParams","location","search","_useSearchParams2","useSearchParams","searchParams","setSearchParams","decodeURI","helpVisible","setHelpVisible","viewKey","elements","relations","collectRels","relationships","rel","people","softwareSystems","containers","el1","components","el2","deploymentNodes","recAddNodes","containerInstances","containerId","infrastructureNodes","_getView","getView","version","groupingIDs","enterprise","cssClassName","tag","varPrefix","tags","technology","addNode","properties","elementViewKey","sourceId","destinationId","routing","addEdge","level","groupMembers","addGroup","init","parseView","useGraph","_useAutoLayout","setLayouting","handleAutoLayout","useCallback","opts","alert","useAutoLayout","_useSave","setSaving","handleSave","_callee2","_t2","_context2","encodeURIComponent","method","exportSVG","status","useSave","ViewRedirect","handleToggleHelp","params","fromEntries","save","compact","layoutOpts","toggleHelp","saveLayout","handleKeyDown","resetView","moveSelected","getGridSize","useKeyboardShortcuts","handleViewChange","handleSelect","obj","onSelect","href"],"ignoreList":[],"sourceRoot":""}